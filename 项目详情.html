<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>项目详情 - 数据资产管理系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .tab-button { 
      cursor: pointer; 
      transition: all 0.3s ease; 
      position: relative;
      color: #374151;
      border-bottom: 2px solid transparent;
    }
    
    .tab-button:hover {
      color: #3b82f6;
      border-bottom-color: #dbeafe;
    }
    
    .tab-button.active { 
      color: #3b82f6; 
      border-bottom-color: #3b82f6;
      font-weight: 600;
    }
    
    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: #3b82f6;
      animation: slideIn 0.3s ease;
    }
    
    /* 子标签页样式 */
    .sub-tab-button {
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      color: #6b7280;
      border-bottom: 2px solid transparent;
    }
    
    .sub-tab-button:hover {
      color: #3b82f6;
      background-color: #f3f4f6;
    }
    
    .sub-tab-button.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
      background-color: #eff6ff;
      font-weight: 500;
    }
    
    .sub-tab-content {
      display: none;
    }
    
    .sub-tab-content.active {
      display: block;
    }
    
    @keyframes slideIn {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }
    
    .tab-content { 
      display: none; 
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active { 
      display: block; 
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fixed {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
    
    .fixed:not(.hidden) {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* 返回按钮特殊样式 */
    .back-button {
      position: relative;
      overflow: hidden;
    }
    
    .back-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .back-button:hover::before {
      left: 100%;
    }
    
    .back-button:active {
      transform: scale(0.95);
    }
    
    /* 页面显示优化 */
    body {
      overflow-x: auto;
    }
    
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .table-container table {
      min-width: 100%;
    }
    
    /* 响应式表格 */
    @media (max-width: 768px) {
      .table-container {
        font-size: 0.875rem;
      }
      
      .table-container th,
      .table-container td {
        padding: 0.5rem 0.25rem;
      }
    }
    
    /* 弹窗优化 */
    .modal-container {
      height: 90vh;
      max-height: 90vh;
      overflow: hidden;
    }
    
    .modal-content {
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: #cbd5e0 #f7fafc;
    }
    
    .modal-content::-webkit-scrollbar {
      width: 6px;
    }
    
    .modal-content::-webkit-scrollbar-track {
      background: #f7fafc;
      border-radius: 3px;
    }
    
    .modal-content::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 3px;
    }
    
    .modal-content::-webkit-scrollbar-thumb:hover {
      background: #a0aec0;
    }
    
    /* 移动端弹窗优化 */
    @media (max-width: 640px) {
      .modal-container {
        height: 95vh;
        max-height: 95vh;
        margin: 0;
        border-radius: 0;
      }
      
      .modal-content {
        padding: 1rem;
        max-height: calc(95vh - 100px);
      }
      
      .modal-header,
      .modal-footer {
        padding: 1rem;
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50">
  <!-- 顶部导航栏 -->
  <header class="bg-gradient-to-r from-red-900 via-red-800 to-red-900 shadow flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16 sticky top-0 z-20">
    <div class="flex items-center space-x-4">
      <img src="https://img1.imgtp.com/2023/07/21/0Qw6Qk4n.png" alt="LOGO" class="h-10 w-10 rounded-full border-2 border-red-400 shadow bg-white object-contain">
      <span class="text-xl font-bold text-white tracking-wide">数据资产管理系统</span>
    </div>
    <div class="flex items-center space-x-4">
      <a href="首页.html" class="text-red-100 hover:text-red-400 font-medium px-3 py-1 rounded border border-red-400 hover:bg-red-700 transition">
        <i class="fas fa-home mr-2"></i>返回首页
      </a>
      <div class="relative" id="user-dropdown">
        <div class="flex items-center space-x-2 cursor-pointer hover:bg-red-700 px-2 py-1 rounded-lg transition" onclick="toggleUserDropdown()">
          <img src="https://i.pravatar.cc/32?img=3" class="rounded-full w-8 h-8 border-2 border-red-200" alt="用户头像">
          <span class="text-red-100 text-sm">张三</span>
          <i class="fas fa-chevron-down text-xs text-red-300 transition-transform" id="dropdown-arrow"></i>
        </div>
        <div id="user-dropdown-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 py-2 hidden z-50">
          <a href="个人中心.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
            <i class="fas fa-user-circle mr-3 text-red-500"></i>
            个人中心
          </a>
          <a href="#" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
            <i class="fas fa-cog mr-3 text-red-500"></i>
            系统管理
          </a>
          <div class="border-t border-gray-200 my-1"></div>
          <a href="#" class="flex items-center px-4 py-2 text-red-600 hover:bg-red-50 transition">
            <i class="fas fa-sign-out-alt mr-3"></i>
            退出
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- 主内容区域 -->
  <main class="p-4 sm:p-6 max-w-7xl mx-auto">
    <!-- 面包屑导航 -->
    <div class="mb-6">
      <nav class="flex" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
          <li class="inline-flex items-center">
            <a href="首页.html" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
              <i class="fas fa-home mr-2"></i>首页
            </a>
          </li>
          <li>
            <div class="flex items-center">
              <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
              <a href="资产开发管理.html" class="text-sm font-medium text-gray-700 hover:text-blue-600">资产开发管理</a>
            </div>
          </li>
          <li aria-current="page">
            <div class="flex items-center">
              <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
              <span class="text-sm font-medium text-gray-500">项目详情</span>
            </div>
          </li>
        </ol>
      </nav>
    </div>

    <!-- 项目详情内容 -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-900">项目详情</h1>
        <div class="flex space-x-3">
          <button onclick="showProjectBasicInfo()" class="px-4 py-2 bg-green-600 text-white border border-green-600 rounded-lg hover:bg-green-700 hover:shadow-md active:scale-95 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2" title="查看项目基本信息">
            <i class="fas fa-info-circle mr-2"></i>项目基本信息
          </button>
          <button onclick="goBack()" class="back-button px-4 py-2 bg-white text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-600 hover:text-white hover:shadow-md active:scale-95 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" title="返回上一页 (ESC)">
            <i class="fas fa-arrow-left mr-2"></i>返回
          </button>
        </div>
      </div>
      
      <!-- 页签导航 -->
      <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex space-x-6 overflow-x-auto" aria-label="Tabs">
          <button onclick="showTab('research-phase')" class="tab-button py-2 px-1 text-sm font-medium text-blue-600 whitespace-nowrap active" data-tab="research-phase">
            研究环节
          </button>
          <button onclick="showTab('development-phase')" class="tab-button py-2 px-1 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="development-phase">
            开发环节
          </button>
          <button onclick="showTab('asset-phase')" class="tab-button py-2 px-1 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="asset-phase">
            资产形成环节
          </button>
        </nav>
      </div>
      
      <!-- 页签内容 -->
      <div class="mt-6">
        <!-- 研究环节大页签 -->
        <div id="research-phase-tab" class="tab-content active">
          <!-- 子标签导航 -->
          <div class="mb-4 bg-gray-50 border border-gray-200 rounded-lg p-2">
            <nav class="flex space-x-2">
              <button onclick="showSubTab('research-phase', 'feasibility')" class="sub-tab-button px-4 py-2 text-sm rounded-md active" data-subtab="feasibility">
                可行性研究环节
              </button>
              <button onclick="showSubTab('research-phase', 'project-approval')" class="sub-tab-button px-4 py-2 text-sm rounded-md" data-subtab="project-approval">
                立项环节
              </button>
            </nav>
          </div>

          <!-- 可行性研究子页签 -->
          <div id="research-phase-feasibility" class="sub-tab-content active">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="请填写可行性研究结论">项目技术可行，建议立项开发。通过预研分析，确认了技术架构的合理性，预计开发周期6个月。</textarea>
            </div>
            
            <!-- 可行性研究报告（信息类项目需填写项目需填写项目需填写项目需填写） -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">可行性研究报告（信息类项目需填写项目需填写项目需填写）</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <div class="space-y-2">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600">
                    <label for="feasibility-report" class="cursor-pointer text-blue-600 hover:text-blue-800">
                      点击上传
                    </label>
                    或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500">支持 PDF、DOC、DOCX 格式</p>
                  <input type="file" id="feasibility-report" class="hidden" accept=".pdf,.doc,.docx">
                </div>
                <!-- 已上传文件列表 -->
                <div class="mt-4 space-y-2">
                  <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                    <div class="flex items-center space-x-2 text-sm text-blue-600">
                      <i class="fas fa-file-pdf"></i>
                      <span>技术可行性分析报告.pdf</span>
                    </div>
                    <button class="text-red-500 hover:text-red-700">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 立项建议书 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">立项建议书</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <div class="space-y-2">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600">
                    <label for="project-proposal" class="cursor-pointer text-blue-600 hover:text-blue-800">
                      点击上传
                    </label>
                    或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500">支持 PDF、DOC、DOCX 格式</p>
                  <input type="file" id="project-proposal" class="hidden" accept=".pdf,.doc,.docx">
                </div>
                <!-- 已上传文件列表 -->
                <div class="mt-4 space-y-2">
                  <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                    <div class="flex items-center space-x-2 text-sm text-blue-600">
                      <i class="fas fa-file-word"></i>
                      <span>立项建议书.docx</span>
                    </div>
                    <button class="text-red-500 hover:text-red-700">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </div>
        
          <!-- 立项环节子页签 -->
          <div id="research-phase-project-approval" class="sub-tab-content">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="请填写立项结论">立项申请已批准，项目正式启动。预计开发周期6个月，预算200万元。</textarea>
            </div>
            
            <!-- 立项批复文件 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">立项批复文件</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <div class="space-y-2">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600">
                    <label for="approval-document" class="cursor-pointer text-blue-600 hover:text-blue-800">
                      点击上传
                    </label>
                    或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500">支持 PDF、DOC、DOCX 格式</p>
                  <input type="file" id="approval-document" class="hidden" accept=".pdf,.doc,.docx">
                </div>
                <!-- 已上传文件列表 -->
                <div class="mt-4 space-y-2">
                  <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                    <div class="flex items-center space-x-2 text-sm text-blue-600">
                      <i class="fas fa-file-pdf"></i>
                      <span>项目立项批复文件.pdf</span>
                    </div>
                    <button class="text-red-500 hover:text-red-700">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 项目编码 -->
            <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-barcode mr-2 text-blue-600"></i>
                项目编码 <span class="text-red-500">*</span>
              </label>
              <input type="text" id="project-code-input" class="w-full px-3 py-2 border-2 border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入唯一的项目编码，如：PRJ-2024-001" value="PRJ-2024-001">
              <p class="text-xs text-gray-600 mt-2">
                <i class="fas fa-info-circle mr-1"></i>
                说明：请填写唯一的项目编码，该编码将在资产形成环节自动带出且不可更改。
              </p>
            </div>
            
            <!-- 资产声明 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">资产声明</label>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：请填写数据资产的基本信息，包括名称、持有目的、所属部门、业务归属、所属行业和详细描述。可以添加多个资产。
                </div>
                
                <!-- 资产管理 -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                  <div class="flex items-center justify-between mb-4">
                    <h4 class="text-md font-medium text-gray-800">资产声明</h4>
                    <button type="button" onclick="addNewAsset()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                      <i class="fas fa-plus mr-2"></i>新增资产
                    </button>
                  </div>
                  
                  <!-- 资产列表 -->
                  <div id="assets-container" class="space-y-4">
                    <!-- 默认资产1示例 -->
                    <div class="asset-item border border-gray-200 rounded-lg p-4" data-asset-id="asset_1">
                      <div class="flex items-center justify-between mb-4">
                        <h5 class="text-sm font-medium text-gray-700">资产 1</h5>
                        <button onclick="removeAsset(this)" class="text-red-500 hover:text-red-700 text-sm">
                          删除资产
                        </button>
                      </div>
                      
                      <!-- 基本信息表单 -->
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- 资产名称 -->
                        <div class="col-span-2">
                          <label class="block text-sm font-medium text-gray-700 mb-1">资产名称 *</label>
                          <input type="text" class="asset-name w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="采购专题分析数据集" placeholder="请输入数据资产名称" required>
                        </div>
                        
                        <!-- 持有目的 -->
                        <div >
                          <label class="block text-sm font-medium text-gray-700 mb-1">持有目的 *</label>
                          <select class="holding-purpose w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择持有目的</option>
                            <option value="自用" selected>自用</option>
                            <option value="对外服务">对外服务</option>
                            <option value="自用+对外服务">自用+对外服务</option>
                            <option value="出售">出售</option>
                          </select>
                        </div>
                        
                        <!-- 所属部门 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">所属部门 *</label>
                          <select class="department w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择所属部门</option>
                            <option value="信息技术部">信息技术部</option>
                            <option value="数据管理部" selected>数据管理部</option>
                            <option value="业务发展部">业务发展部</option>
                            <option value="风险管理部">风险管理部</option>
                            <option value="客户服务部">客户服务部</option>
                            <option value="产品研发部">产品研发部</option>
                            <option value="合规管理部">合规管理部</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>
                        
                        <!-- 业务归属 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">业务归属 *</label>
                          <select class="business-ownership w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择业务归属</option>
                            <option value="零售业务" selected>零售业务</option>
                            <option value="公司业务">公司业务</option>
                            <option value="投资银行业务">投资银行业务</option>
                            <option value="资产管理业务">资产管理业务</option>
                            <option value="金融市场业务">金融市场业务</option>
                            <option value="风险管理">风险管理</option>
                            <option value="运营管理">运营管理</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>
                        
                        <!-- 所属行业 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">所属行业 *</label>
                          <select class="industry w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择所属行业</option>
                            <option value="银行业" selected>银行业</option>
                            <option value="保险业">保险业</option>
                            <option value="证券业">证券业</option>
                            <option value="基金业">基金业</option>
                            <option value="信托业">信托业</option>
                            <option value="租赁业">租赁业</option>
                            <option value="金融科技">金融科技</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>

                        <!-- 详细描述 -->
                        <div class="col-span-2">
                          <label class="block text-sm font-medium text-gray-700 mb-1">详细描述 *</label>
                          <textarea class="description w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="请详细描述数据资产的内容、用途、价值、数据来源等信息" required>该数据库包含银行所有客户的基础信息，包括客户身份信息、联系方式、账户信息、交易记录等。主要用于客户关系管理、风险评估、营销推广等业务场景。数据来源于核心银行系统，每日更新，是银行最重要的数据资产之一。</textarea>
                        </div>
                      </div>
                      
                    </div>
                    
                    <!-- 默认资产2示例 -->
                    <div class="asset-item border border-gray-200 rounded-lg p-4" data-asset-id="asset_2">
                      <div class="flex items-center justify-between mb-4">
                        <h5 class="text-sm font-medium text-gray-700">资产 2</h5>
                        <button onclick="removeAsset(this)" class="text-red-500 hover:text-red-700 text-sm">
                          删除资产
                        </button>
                      </div>
                      
                      <!-- 基本信息表单 -->
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- 资产名称 -->
                        <div class="col-span-2">
                          <label class="block text-sm font-medium text-gray-700 mb-1">资产名称 *</label>
                          <input type="text" class="asset-name w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="成交分析数据集" placeholder="请输入数据资产名称" required>
                        </div>
                        
                        <!-- 持有目的 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">持有目的 *</label>
                          <select class="holding-purpose w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择持有目的</option>
                            <option value="自用">自用</option>
                            <option value="对外服务">对外服务</option>
                            <option value="自用+对外服务" selected>自用+对外服务</option>
                            <option value="出售">出售</option>
                          </select>
                        </div>
                        
                        <!-- 所属部门 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">所属部门 *</label>
                          <select class="department w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择所属部门</option>
                            <option value="信息技术部">信息技术部</option>
                            <option value="数据管理部">数据管理部</option>
                            <option value="业务发展部">业务发展部</option>
                            <option value="风险管理部">风险管理部</option>
                            <option value="客户服务部">客户服务部</option>
                            <option value="产品研发部">产品研发部</option>
                            <option value="合规管理部">合规管理部</option>
                            <option value="数据分析部" selected>数据分析部</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>
                        
                        <!-- 业务归属 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">业务归属 *</label>
                          <select class="business-ownership w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择业务归属</option>
                            <option value="零售业务">零售业务</option>
                            <option value="公司业务">公司业务</option>
                            <option value="投资银行业务">投资银行业务</option>
                            <option value="资产管理业务">资产管理业务</option>
                            <option value="金融市场业务">金融市场业务</option>
                            <option value="风险管理">风险管理</option>
                            <option value="运营管理">运营管理</option>
                            <option value="交易业务" selected>交易业务</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>
                        
                        <!-- 所属行业 -->
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-1">所属行业 *</label>
                          <select class="industry w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">请选择所属行业</option>
                            <option value="银行业">银行业</option>
                            <option value="保险业">保险业</option>
                            <option value="证券业">证券业</option>
                            <option value="基金业">基金业</option>
                            <option value="信托业">信托业</option>
                            <option value="租赁业">租赁业</option>
                            <option value="金融科技">金融科技</option>
                            <option value="金融业" selected>金融业</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>

                        <!-- 详细描述 -->
                        <div class="col-span-2">
                          <label class="block text-sm font-medium text-gray-700 mb-1">详细描述 *</label>
                          <textarea class="description w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="请详细描述数据资产的内容、用途、价值、数据来源等信息" required>该数据集包含交易成交相关的分析数据，包括成交价格、成交量、成交时间、交易对手信息等关键指标。主要用于交易策略分析、市场趋势预测、风险控制等业务场景。数据来源于交易系统，实时更新，是交易分析的重要数据资产。</textarea>
                        </div>
                      </div>
                      
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <!-- 总体预算 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">总体预算</label>
              <div class="space-y-3">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：业务人员需要填写详细的预算信息，包括直接费、间接费等各项费用明细。
                </div>
                
                <!-- 预算表格 -->
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">取费说明</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">预算费用(单位:元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                      </tr>
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          <div class="grid grid-cols-3 gap-1">
                            <span class="text-xs">2024年</span>
                            <span class="text-xs">2025年</span>
                            <span class="text-xs">合计</span>
                          </div>
                        </th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      <!-- 直接费 -->
                      <tr class="bg-orange-50">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">I</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">直接费</td>
                        <td class="px-3 py-2 text-sm text-gray-500"></td>
                        <td class="px-3 py-2">
                          <div class="grid grid-cols-3 gap-1">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                          </div>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-500"></td>
                      </tr>
                      
                      <!-- 人员费 -->
                      <tr class="bg-orange-50">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">1</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">人员费</td>
                        <td class="px-3 py-2 text-sm text-gray-500"></td>
                        <td class="px-3 py-2">
                          <div class="grid grid-cols-3 gap-1">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                          </div>
                        </td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">150,000</td>
                      </tr>
                      
                      <!-- 设备费 -->
                      <tr class="bg-orange-50">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">2</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">设备费</td>
                        <td class="px-3 py-2 text-sm text-gray-500"></td>
                        <td class="px-3 py-2">
                          <div class="grid grid-cols-3 gap-1">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                          </div>
                        </td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">80,000</td>
                      </tr>
                      
                      <!-- 材料费 -->
                      <tr class="bg-orange-50">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">3</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">材料费</td>
                        <td class="px-3 py-2 text-sm text-gray-500"></td>
                        <td class="px-3 py-2">
                          <div class="grid grid-cols-3 gap-1">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                            <input type="number" class="w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0">
                          </div>
                        </td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">30,000</td>
                      </tr>
                      
                      <tr class="bg-gray-50">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">合计</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900"></td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900"></td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">260,000</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        
          <!-- 审批历史 -->
          <div class="mt-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">审批历史</label>
            <div class="space-y-3">
              <!-- 审批流程表格 -->
              <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批步骤</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批人</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批结果</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批时间</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批意见</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                      <td class="px-4 py-3 text-sm font-medium text-gray-900">1. 研究环节审批</td>
                      <td class="px-4 py-3 text-sm text-gray-600">王总监</td>
                      <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          通过
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-600">2024-12-20 10:30</td>
                      <td class="px-4 py-3 text-sm text-gray-600">研究方案完善，同意立项</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 开发环节大页签 -->
        <div id="development-phase-tab" class="tab-content">
          <!-- 子标签导航 -->
          <div class="mb-4 bg-gray-50 border border-gray-200 rounded-lg p-2">
            <nav class="flex space-x-2 flex-wrap">
              <button onclick="showSubTab('development-phase', 'requirement')" class="sub-tab-button px-4 py-2 text-sm rounded-md active" data-subtab="requirement">
                需求确认环节
              </button>
              <button onclick="showSubTab('development-phase', 'design')" class="sub-tab-button px-4 py-2 text-sm rounded-md" data-subtab="design">
                详细设计环节
              </button>
              <button onclick="showSubTab('development-phase', 'development')" class="sub-tab-button px-4 py-2 text-sm rounded-md" data-subtab="development">
                开发环节
              </button>
              <button onclick="showSubTab('development-phase', 'acceptance')" class="sub-tab-button px-4 py-2 text-sm rounded-md" data-subtab="acceptance">
                验收环节
              </button>
            </nav>
          </div>
          
          <!-- 需求确认子页签 -->
          <div id="development-phase-requirement" class="sub-tab-content active">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="请填写需求确认结论">需求已确认，包含核心功能模块和数据处理流程。</textarea>
            </div>
            
            <!-- 需求规格说明书 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">需求规格说明书</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="requirement-spec" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="requirement-spec" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>需求规格说明书.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 评审意见 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">评审意见</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="requirement-review" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="requirement-review" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>评审意见.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
          </div>
          </div>
        
          <!-- 详细设计子页签 -->
          <div id="development-phase-design" class="sub-tab-content">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="请填写详细设计结论">详细设计已完成，系统架构清晰，技术方案可行，准备进入开发阶段。</textarea>
            </div>
            
            <!-- 详细设计说明书 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">详细设计说明书</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="design-spec" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="design-spec" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>详细设计说明书.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 评审意见 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">评审意见</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="design-review" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="design-review" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>评审意见.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
          </div>
          </div>
        
          <!-- 开发子页签 -->
          <div id="development-phase-development" class="sub-tab-content">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="请填写开发结论">开发已完成，功能测试通过，性能测试达标，准备上线部署。</textarea>
            </div>
            
            <!-- 开发文档 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">开发文档</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="dev-doc" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="dev-doc" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>开发文档.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 测试报告 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">测试报告</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="test-report" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="test-report" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>测试报告.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 上线报告 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">上线报告</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="deploy-report" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="deploy-report" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>上线报告.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
          </div>
          </div>
        
          <!-- 验收子页签 -->
          <div id="development-phase-acceptance" class="sub-tab-content">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="请填写验收结论">项目验收合格，各项指标达到预期要求，具备上线条件。</textarea>
            </div>
            
            <!-- 验收报告 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">验收报告</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="acceptance-report" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="acceptance-report" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>验收报告.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>

            <!-- 料工费填写 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">料工费填写</label>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：请填写项目所需的材料费用、工时和服务费，并设置相应的分摊比例。
                </div>
                
                <!-- 料工费表格 -->
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                  <table class="min-w-full divide-y divide-gray-200" id="acceptance-cost-table">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用类型</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单位</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单价(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小计(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊比例(%)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊金额(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="cost-tbody">
                      <!-- 材料费用 -->
                      <tr class="cost-row" data-type="材料费用">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">1</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">材料费用</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入材料名称" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>个</option>
                            <option>套</option>
                            <option>台</option>
                            <option>件</option>
                            <option>米</option>
                            <option>千克</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 工时 -->
                      <tr class="cost-row" data-type="工时">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">2</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">工时</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入工作内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>小时</option>
                            <option>天</option>
                            <option>月</option>
                            <option>人天</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 服务费 -->
                      <tr class="cost-row" data-type="服务费">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">3</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">服务费</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入服务内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>次</option>
                            <option>项</option>
                            <option>月</option>
                            <option>年</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex justify-between items-center">
                  <div class="flex space-x-3">
                    <button type="button" onclick="addCostRow()" class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      添加费用项
                    </button>
                  </div>
                  <div class="flex space-x-3">
                    <button type="button" onclick="exportCosts()" class="px-4 py-2 bg-orange-600 text-white text-sm rounded-md hover:bg-orange-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      导出费用
                    </button>
                  </div>
                </div>
                
                <!-- 费用汇总 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h4 class="text-lg font-medium text-gray-800 mb-4">费用汇总</h4>
                  <div class="grid grid-cols-4 gap-4">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-blue-600" id="material-total">0.00</div>
                      <div class="text-sm text-gray-600">材料费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-600" id="labor-total">0.00</div>
                      <div class="text-sm text-gray-600">工时费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-orange-600" id="service-total">0.00</div>
                      <div class="text-sm text-gray-600">服务费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-purple-600" id="grand-total">0.00</div>
                      <div class="text-sm text-gray-600">总费用</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
          <!-- 开发子页签 -->
          <div id="development-phase-development" class="sub-tab-content">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="请填写开发结论">开发已完成，功能测试通过，性能测试达标，准备上线部署。</textarea>
            </div>
            
            <!-- 开发文档 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">开发文档</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="dev-doc" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="dev-doc" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>开发文档.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 测试报告 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">测试报告</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="test-report" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="test-report" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>测试报告.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 上线报告 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">上线报告</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="deploy-report" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="deploy-report" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>上线报告.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 以下是原有的料工费内容，保留不变 -->
            <!-- 料工费填写 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">料工费填写</label>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：请填写项目所需的材料费用、工时和服务费，并设置相应的分摊比例。
                </div>
                
                <!-- 料工费表格 -->
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                  <table class="min-w-full divide-y divide-gray-200" id="design-cost-table">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用类型</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单位</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单价(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小计(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊比例(%)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊金额(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="design-cost-tbody">
                      <!-- 材料费用 -->
                      <tr class="cost-row" data-type="材料费用">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">1</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">材料费用</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入材料名称" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>个</option>
                            <option>套</option>
                            <option>台</option>
                            <option>件</option>
                            <option>米</option>
                            <option>千克</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 工时 -->
                      <tr class="cost-row" data-type="工时">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">2</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">工时</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入工作内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>小时</option>
                            <option>天</option>
                            <option>月</option>
                            <option>人天</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 服务费 -->
                      <tr class="cost-row" data-type="服务费">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">3</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">服务费</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入服务内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>次</option>
                            <option>项</option>
                            <option>月</option>
                            <option>年</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex justify-between items-center">
                  <div class="flex space-x-3">
                    <button type="button" onclick="addCostRow('design-cost-tbody')" class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      添加费用项
                    </button>
                  </div>
                  <div class="flex space-x-3">
                    <button type="button" onclick="exportCosts('design-cost-table')" class="px-4 py-2 bg-orange-600 text-white text-sm rounded-md hover:bg-orange-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      导出费用
                    </button>
                  </div>
                </div>
                
                <!-- 费用汇总 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h4 class="text-lg font-medium text-gray-800 mb-4">费用汇总</h4>
                  <div class="grid grid-cols-4 gap-4">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-blue-600" id="design-material-total">0.00</div>
                      <div class="text-sm text-gray-600">材料费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-600" id="design-labor-total">0.00</div>
                      <div class="text-sm text-gray-600">工时费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-orange-600" id="design-service-total">0.00</div>
                      <div class="text-sm text-gray-600">服务费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-purple-600" id="design-grand-total">0.00</div>
                      <div class="text-sm text-gray-600">总费用</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 开发环节页签 -->
        <div id="development-tab" class="tab-content">
          <div class="space-y-6">
            <!-- 开发结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">开发结论</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[100px]">
                核心功能开发完成，正在进行功能测试和性能优化。
              </div>
            </div>
            
            <!-- 开发附件 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">开发附件</label>
              <div class="space-y-2">
                <div class="flex items-center space-x-2 text-sm text-blue-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>系统架构设计文档.pdf</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-blue-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>数据库设计文档.pdf</span>
                </div>
              </div>
            </div>
            
            <!-- 料工费填写 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">料工费填写</label>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：请填写项目所需的材料费用、工时和服务费，并设置相应的分摊比例。
                </div>
                
                <!-- 料工费表格 -->
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                  <table class="min-w-full divide-y divide-gray-200" id="development-cost-table">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用类型</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单位</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单价(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小计(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊比例(%)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊金额(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="development-cost-tbody">
                      <!-- 材料费用 -->
                      <tr class="cost-row" data-type="材料费用">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">1</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">材料费用</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入材料名称" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>个</option>
                            <option>套</option>
                            <option>台</option>
                            <option>件</option>
                            <option>米</option>
                            <option>千克</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 工时 -->
                      <tr class="cost-row" data-type="工时">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">2</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">工时</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入工作内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>小时</option>
                            <option>天</option>
                            <option>月</option>
                            <option>人天</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 服务费 -->
                      <tr class="cost-row" data-type="服务费">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">3</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">服务费</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入服务内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>次</option>
                            <option>项</option>
                            <option>月</option>
                            <option>年</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex justify-between items-center">
                  <div class="flex space-x-3">
                    <button type="button" onclick="addCostRow('development-cost-tbody')" class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      添加费用项
                    </button>
                  </div>
                  <div class="flex space-x-3">
                    <button type="button" onclick="exportCosts('development-cost-table')" class="px-4 py-2 bg-orange-600 text-white text-sm rounded-md hover:bg-orange-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      导出费用
                    </button>
                  </div>
                </div>
                
                <!-- 费用汇总 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h4 class="text-lg font-medium text-gray-800 mb-4">费用汇总</h4>
                  <div class="grid grid-cols-4 gap-4">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-blue-600" id="development-material-total">0.00</div>
                      <div class="text-sm text-gray-600">材料费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-600" id="development-labor-total">0.00</div>
                      <div class="text-sm text-gray-600">工时费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-orange-600" id="development-service-total">0.00</div>
                      <div class="text-sm text-gray-600">服务费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-purple-600" id="development-grand-total">0.00</div>
                      <div class="text-sm text-gray-600">总费用</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
          <!-- 验收环节子页签 -->
          <div id="development-phase-acceptance" class="sub-tab-content">
          <div class="space-y-6">
            <!-- 文本结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">文本结论</label>
              <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="请填写验收结论">项目验收合格，各项功能正常运行，性能指标达标，同意通过验收。</textarea>
            </div>
            
            <!-- 验收报告 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">验收报告</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                <div class="text-sm text-gray-600 mt-2">
                  <label for="acceptance-report" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                </div>
                <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                <input type="file" id="acceptance-report" class="hidden" accept=".pdf,.doc,.docx">
                <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                  <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>验收报告.pdf</span></div>
                  <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                </div></div>
              </div>
            </div>
            
            <!-- 料工费填写（可变总表，待梳理） -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">料工费填写</label>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：请填写项目所需的材料费用、工时和服务费，并设置相应的分摊比例。
                </div>
                
                <!-- 料工费表格 -->
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                  <table class="min-w-full divide-y divide-gray-200" id="testing-cost-table">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用类型</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单位</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单价(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小计(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊比例(%)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊金额(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="testing-cost-tbody">
                      <!-- 材料费用 -->
                      <tr class="cost-row" data-type="材料费用">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">1</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">材料费用</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入材料名称" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>个</option>
                            <option>套</option>
                            <option>台</option>
                            <option>件</option>
                            <option>米</option>
                            <option>千克</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 工时 -->
                      <tr class="cost-row" data-type="工时">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">2</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">工时</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入工作内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>小时</option>
                            <option>天</option>
                            <option>月</option>
                            <option>人天</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 服务费 -->
                      <tr class="cost-row" data-type="服务费">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">3</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">服务费</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入服务内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>次</option>
                            <option>项</option>
                            <option>月</option>
                            <option>年</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex justify-between items-center">
                  <div class="flex space-x-3">
                    <button type="button" onclick="addCostRow('testing-cost-tbody')" class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      添加费用项
                    </button>
                  </div>
                  <div class="flex space-x-3">
                    <button type="button" onclick="exportCosts('testing-cost-table')" class="px-4 py-2 bg-orange-600 text-white text-sm rounded-md hover:bg-orange-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      导出费用
                    </button>
                  </div>
                </div>
                
                
              </div>
            </div>

            <!-- 费用汇总 -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <h4 class="text-lg font-medium text-gray-800 mb-4">费用汇总</h4>
              <div class="grid grid-cols-4 gap-4">
                <div class="text-center">
                  <div class="text-2xl font-bold text-blue-600" id="deployment-material-total">0.00</div>
                  <div class="text-sm text-gray-600">材料费用合计</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-green-600" id="deployment-labor-total">0.00</div>
                  <div class="text-sm text-gray-600">工时费用合计</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-orange-600" id="deployment-service-total">0.00</div>
                  <div class="text-sm text-gray-600">服务费用合计</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-purple-600" id="deployment-grand-total">0.00</div>
                  <div class="text-sm text-gray-600">总费用</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 上线环节页签 -->
        <div id="deployment-tab" class="tab-content">
          <div class="space-y-6">
            <!-- 上线结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">上线结论</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[100px]">
                系统已成功上线到生产环境，运行稳定，用户反馈良好。
              </div>
            </div>
            
            <!-- 上线附件 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">上线附件</label>
              <div class="space-y-2">
                <div class="flex items-center space-x-2 text-sm text-blue-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>上线方案文档.pdf</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-blue-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>运维手册.pdf</span>
                </div>
              </div>
            </div>
            
            <!-- 料工费填写 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">料工费填写</label>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：请填写项目所需的材料费用、工时和服务费，并设置相应的分摊比例。
                </div>
                
                <!-- 料工费表格 -->
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                  <table class="min-w-full divide-y divide-gray-200" id="deployment-cost-table">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">序号</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用类型</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">费用名称</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单位</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单价(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小计(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊比例(%)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分摊金额(元)</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="deployment-cost-tbody">
                      <!-- 材料费用 -->
                      <tr class="cost-row" data-type="材料费用">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">1</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">材料费用</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入材料名称" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>个</option>
                            <option>套</option>
                            <option>台</option>
                            <option>件</option>
                            <option>米</option>
                            <option>千克</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 工时 -->
                      <tr class="cost-row" data-type="工时">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">2</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">工时</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入工作内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>小时</option>
                            <option>天</option>
                            <option>月</option>
                            <option>人天</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                      
                      <!-- 服务费 -->
                      <tr class="cost-row" data-type="服务费">
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">3</td>
                        <td class="px-3 py-2 text-sm font-medium text-gray-900">服务费</td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入服务内容" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
                            <option>次</option>
                            <option>项</option>
                            <option>月</option>
                            <option>年</option>
                          </select>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
                        </td>
                        <td class="px-3 py-2 text-sm text-gray-700">
                          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex justify-between items-center">
                  <div class="flex space-x-3">
                    <button type="button" onclick="addCostRow('deployment-cost-tbody')" class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      添加费用项
                    </button>
                  </div>
                  <div class="flex space-x-3">
                    <button type="button" onclick="exportCosts('deployment-cost-table')" class="px-4 py-2 bg-orange-600 text-white text-sm rounded-md hover:bg-orange-700">
                      <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      导出费用
                    </button>
                  </div>
                </div>
                
                <!-- 费用汇总 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h4 class="text-lg font-medium text-gray-800 mb-4">费用汇总</h4>
                  <div class="grid grid-cols-4 gap-4">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-blue-600" id="deployment-material-total">0.00</div>
                      <div class="text-sm text-gray-600">材料费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-600" id="deployment-labor-total">0.00</div>
                      <div class="text-sm text-gray-600">工时费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-orange-600" id="deployment-service-total">0.00</div>
                      <div class="text-sm text-gray-600">服务费用合计</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-purple-600" id="deployment-grand-total">0.00</div>
                      <div class="text-sm text-gray-600">总费用</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 这里原来是测试、上线、验收三个环节，现在已删除测试和上线 -->
          <div class="space-y-6">
            <!-- 验收结论 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">验收结论</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[100px]">
                项目已通过用户验收，功能满足需求，性能达到预期，质量符合标准。
              </div>
            </div>

            <!-- 费用汇总 -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <h4 class="text-lg font-medium text-gray-800 mb-4">费用汇总</h4>
              <div class="grid grid-cols-4 gap-4">
                <div class="text-center">
                  <div class="mb-2">
                    <input type="number" 
                           id="testing-material-total" 
                           class="w-full text-2xl font-bold text-blue-600 text-center border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500" 
                           value="0.00" 
                           step="0.01" 
                           min="0"
                           onchange="calculateTestingGrandTotal()"
                           placeholder="0.00">
                  </div>
                  <div class="text-sm text-gray-600">材料费用合计</div>
                </div>
                <div class="text-center">
                  <div class="mb-2">
                    <input type="number" 
                           id="testing-labor-total" 
                           class="w-full text-2xl font-bold text-green-600 text-center border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-green-500" 
                           value="0.00" 
                           step="0.01" 
                           min="0"
                           onchange="calculateTestingGrandTotal()"
                           placeholder="0.00">
                  </div>
                  <div class="text-sm text-gray-600">工时费用合计</div>
                </div>
                <div class="text-center">
                  <div class="mb-2">
                    <input type="number" 
                           id="testing-service-total" 
                           class="w-full text-2xl font-bold text-orange-600 text-center border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-orange-500" 
                           value="0.00" 
                           step="0.01" 
                           min="0"
                           onchange="calculateTestingGrandTotal()"
                           placeholder="0.00">
                  </div>
                  <div class="text-sm text-gray-600">服务费用合计</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-purple-600 bg-gray-100 px-3 py-2 rounded border" id="testing-grand-total">0.00</div>
                  <div class="text-sm text-gray-600">总费用（自动计算）</div>
                </div>
              </div>
            </div>

            <!-- 资产信息展示与编辑 -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <h3 class="text-lg font-medium text-gray-800 mb-4">资产信息</h3>
              <div class="space-y-4">
                <div class="text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md">
                  说明：展示立项环节中定义的资产信息，可在此进行最终确认和编辑。
                </div>
                
                <!-- 资产列表展示 -->
                <div id="acceptance-assets-container" class="space-y-4">
                  <!-- 资产信息将通过JavaScript动态加载和展示 -->
                </div>
                
                <!-- 修改说明 -->
                <div class="mt-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2">修改说明</label>
                  <textarea id="asset-modification-notes" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="请说明对资产信息的修改情况，包括修改原因、修改内容等..."></textarea>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex justify-end space-x-3 mt-4">
                  <button onclick="saveModificationNotes()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                    <i class="fas fa-check-circle mr-2"></i>确认资产类型并保存
                  </button>
                </div>
              </div>
            </div>
         
            <!-- 相关论述 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">相关论述</label>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">预期经济流入分析</label>
                  <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[80px]">
                    资产上线后将显著提升业务效率，预计每年可节省人力成本约30万元，提升数据处理速度50%以上。
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">风险评估</label>
                  <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[80px]">
                    主要风险包括技术更新迭代、业务需求变化等。建议建立定期评估机制，及时识别和应对风险。
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 验收附件 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">验收附件</label>
              <div class="space-y-2">
                <div class="flex items-center space-x-2 text-sm text-blue-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>验收报告.pdf</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-blue-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>用户确认书.pdf</span>
                </div>
              </div>
            </div>
            
          </div>
        </div>
        
          <!-- 审批历史 -->
          <div class="mt-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">审批历史</label>
            <div class="space-y-3">
              <!-- 审批流程表格 -->
              <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批步骤</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批人</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批结果</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批时间</th>
                      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">审批意见</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                      <td class="px-4 py-3 text-sm font-medium text-gray-900">1. 开发环节审批</td>
                      <td class="px-4 py-3 text-sm text-gray-600">李总监</td>
                      <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          通过
                        </span>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-600">2024-12-25 15:30</td>
                      <td class="px-4 py-3 text-sm text-gray-600">开发完成，验收合格</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 资产形成环节大页签 -->
        <div id="asset-phase-tab" class="tab-content">
          <div class="space-y-6">
            
            <!-- ==================== 公用信息区域（所有资产共用） ==================== -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-400 rounded-xl p-6 shadow-lg">
              <div class="flex items-center mb-5">
                <i class="fas fa-info-circle text-blue-600 text-2xl mr-3"></i>
                <h3 class="text-xl font-bold text-gray-800">公用信息（所有资产共用）</h3>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 项目编码（从立项环节自动带出，只读） -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-barcode mr-1 text-blue-600"></i>
                    项目编码 
                    <span class="text-xs text-gray-500">(从立项环节自动带出，不可更改)</span>
                  </label>
                  <input type="text" id="asset-phase-project-code" class="w-full px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-md text-gray-700 cursor-not-allowed" value="" readonly>
                </div>
                
                <!-- 公司代码（默认物资公司，只读） -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-building mr-1 text-blue-600"></i>
                    公司代码 
                    <span class="text-xs text-gray-500">(默认物资公司，不可更改)</span>
                  </label>
                  <input type="text" class="w-full px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-md text-gray-700 cursor-not-allowed" value="WZ001 - 物资公司" readonly>
                </div>
                
                <!-- 利润中心（固定展示，只读） -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-chart-pie mr-1 text-blue-600"></i>
                    利润中心
                    <span class="text-xs text-gray-500">(固定为采购中心，不可更改)</span>
                  </label>
                  <input type="text" class="w-full px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-md text-gray-700 cursor-not-allowed" value="PC001 - 采购中心" readonly>
                </div>
                
                <!-- 内部订单（手动填写，必填） -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-file-invoice mr-1 text-blue-600"></i>
                    内部订单 <span class="text-red-500">*</span>
                  </label>
                  <input type="text" class="w-full px-3 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入内部订单号，如：IO-2024-12345" value="IO-2024-12345">
                </div>
              </div>
            </div>
            
            <!-- 资产分页签 -->
            <div class="mt-6">
              <!-- 页签导航 -->
              <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-6 overflow-x-auto items-center" aria-label="资产页签">
                  <button onclick="switchAssetTab('asset1')" id="asset-tab-1" class="asset-tab-button border-b-2 border-blue-500 py-2 px-1 text-sm font-medium text-blue-600 whitespace-nowrap" data-asset="asset1">
                    采购业务分析数据集
                  </button>
                  <button onclick="switchAssetTab('asset2')" id="asset-tab-2" class="asset-tab-button border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap" data-asset="asset2">
                    成交分析数据集
                  </button>
                  <button onclick="showAddAssetDialog()" class="ml-4 px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 flex items-center whitespace-nowrap">
                    <i class="fas fa-plus mr-2"></i>新增资产
                  </button>
                </nav>
              </div>
              
              <!-- 资产1页签内容 -->
              <div id="asset-tab-content-1" class="asset-tab-content space-y-6 mt-6">
                <!-- 资产内容容器 -->
                <div class="border-2 border-blue-300 rounded-lg p-6 bg-blue-50/30">
                  <!-- 资产信息 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产信息</h3>
                  <p class="text-sm text-gray-600 mb-4">说明：展示立项环节中定义的资产信息，可在此进行最终确认和编辑。</p>
                  
                  <!-- 是否为增资 -->
                  <div class="mb-6">
                    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                      <label class="block text-sm font-medium text-gray-700 mb-3">
                        <i class="fas fa-plus-circle mr-2 text-yellow-600"></i>
                        是否为增资
                      </label>
                      <div class="flex items-center space-x-6">
                        <label class="inline-flex items-center">
                          <input type="radio" name="is-addition" value="no" class="form-radio text-blue-600" checked onchange="toggleAdditionFields()">
                          <span class="ml-2 text-sm">否（新建资产）</span>
                        </label>
                        <label class="inline-flex items-center">
                          <input type="radio" name="is-addition" value="yes" class="form-radio text-blue-600" onchange="toggleAdditionFields()">
                          <span class="ml-2 text-sm">是（增资）</span>
                        </label>
                      </div>
                      
                      <!-- 增资相关字段 -->
                      <div id="addition-fields" class="mt-4 space-y-4 hidden">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">关联现有资产</label>
                          <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">请选择要增资的资产</option>
                            <option>客户数据分析平台</option>
                            <option>供应商管理系统</option>
                            <option>采购业务分析数据集</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">增资金额（万元）</label>
                          <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入增资金额" min="0" step="0.01">
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 资产基本信息 -->
                  <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-700 mb-3">资产 1</h4>
                <div class="grid grid-cols-4 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">资产名称</label>
                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="采购业务分析数据集" readonly>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">资产类型确认 *</label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                      <option value="">请选择</option>
                      <option value="无形资产" selected>无形资产</option>
                      <option value="存货">存货</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">持有目的</label>
                    <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">业务运营</div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">所属部门</label>
                    <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">数据管理部</div>
                  </div>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">业务归属</label>
                    <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">零售业务</div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">所属行业</label>
                    <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">银行业</div>
                  </div>
                  <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">详细描述</label>
                    <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2">该数据集包含采购业务相关的分析数据，包括采购订单、供应商信息、采购金额、采购周期等关键指标。主要用于采购决策分析、供应商评估、成本控制等业务场景。数据来源于采购管理系统，每日更新，是采购业务分析的重要数据资产。</textarea>
                  </div>
                </div>
              </div>

              <!-- 资产基础信息配置 -->
              <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-md font-medium text-gray-700">资产基础信息配置</h4>
                  <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                    <i class="fas fa-cog mr-1"></i>配置标签属性
                  </button>
                </div>
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                  <div class="space-y-2 text-sm text-gray-600">
                    <div><span class="font-medium">技术标签：</span>未配置</div>
                    <div><span class="font-medium">业务标签：</span>未配置</div>
                    <div><span class="font-medium">安全标签：</span>未配置</div>
                    <div><span class="font-medium">资产属性：</span>未配置</div>
                    <div><span class="font-medium">所属目录：</span>未配置</div>
                  </div>
                </div>
              </div>

              <!-- 数据集管理 -->
              <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-md font-medium text-gray-700">数据集管理</h4>
                  <button class="px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700">
                    <i class="fas fa-plus mr-1"></i>新增数据集
                  </button>
                </div>
                
                <!-- 数据集 1 -->
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-3">
                  <div class="flex items-center justify-between mb-3">
                    <h5 class="text-sm font-medium text-gray-800">数据集 1</h5>
                    <button class="text-red-500 hover:text-red-700 text-sm">删除</button>
                  </div>
                  <div class="grid grid-cols-2 gap-4 mb-3">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">名称 *</label>
                      <input type="text" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="请输入数据集名称">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">数据库类型 *</label>
                      <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                        <option value="">请选择数据库类型</option>
                        <option>MySQL</option>
                        <option>Oracle</option>
                        <option>SQL Server</option>
                      </select>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-4 mb-3">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">数据结构 *</label>
                      <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                        <option value="">请选择数据结构</option>
                        <option>结构化</option>
                        <option>半结构化</option>
                        <option>非结构化</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">规模 *</label>
                      <input type="text" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如：100GB">
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-4 mb-3">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">条数 *</label>
                      <input type="text" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如：100万条">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">频率 *</label>
                      <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                        <option value="">请选择更新频率</option>
                        <option>实时</option>
                        <option>每日</option>
                        <option>每周</option>
                        <option>每月</option>
                      </select>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-4 mb-3">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">加工性质 *</label>
                      <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                        <option value="">请选择加工性质</option>
                        <option>原始数据</option>
                        <option>清洗数据</option>
                        <option>加工数据</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">详细描述</label>
                    <textarea class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="2" placeholder="请描述本数据集的内容和用途"></textarea>
                  </div>
                  
                  <!-- 挂载数据资源 -->
                  <div class="mt-4">
                    <div class="flex items-center justify-between mb-2">
                      <label class="block text-sm font-medium text-gray-700">挂载数据资源</label>
                      <button onclick="openDataResourceModal()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                        <i class="fas fa-plus mr-1"></i>选择数据资源
                      </button>
                    </div>
                    <div class="text-sm text-gray-500">暂未挂载数据资源</div>
                  </div>
                </div>
              </div>
            </div>
            
                <!-- 资产使用年限 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产使用年限</h3>
               <div class="space-y-6">
                 <!-- 资产1使用年限 -->
                 <div class="space-y-4">
                   <div class="grid grid-cols-3 gap-4">
                     <div>
                       <label class="block text-sm font-medium text-gray-600 mb-1">资产名称</label>
                       <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md">采购业务分析数据集</div>
                     </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">预计使用年限</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="5年" placeholder="请输入预计使用年限">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">摊销方法</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                          <option value="直线摊销法" selected>直线摊销法</option>
                          <option value="产量摊销法">产量摊销法</option>
                          <option value="年限平均法">年限平均法</option>
                          <option value="其他">其他</option>
                        </select>
                      </div>
                   </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">使用年限说明</label>
                    <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[80px]">
                      根据数据资产的技术特性和业务价值，预计该资产可使用5年。在5年内，资产将保持其核心价值，之后可能需要技术升级或重新开发。
                    </div>
                  </div>
                 </div>
              </div>
            </div>

                <!-- 资产登记信息 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产登记信息</h3>
              <div class="grid grid-cols-5 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">资产名称</label>
                  <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                    采购业务分析数据集
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">资产编号</label>
                  <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                    DA-2025-001
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">登记日期</label>
                  <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                    2025年9月25日
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">资产状态</label>
                  <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                    已登记
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">管理责任人</label>
                  <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                    数据资产管理部
                  </div>
                </div>
              </div>
            </div>

                <!-- 资产评估价值 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产评估价值（选填，也可在资产卡片中修改）</h3>
               <div class="space-y-4">
                 <div class="grid grid-cols-4 gap-4">
                   <div>
                     <label class="block text-sm font-medium text-gray-600 mb-1">资产名称</label>
                     <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md">采购业务分析数据集</div>
                   </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-600 mb-1">评估价值</label>
                      <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="200万元" placeholder="请输入评估价值">
                    </div>
                    <div>
                     <label class="block text-sm font-medium text-gray-600 mb-1">评估方法</label>
                     <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="成本法 + 收益法综合评估" placeholder="请选择评估方法">
                  </div>
                    <div>
                     <label class="block text-sm font-medium text-gray-600 mb-1">评估结论</label>
                     <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="基于成本法和收益法的综合评估,该数据资产的总价值约为200万元。其中开发成本约80万元,预期收益现值约120万元。资产具有良好的投资回报率和长期价值。" placeholder="请输入评估结论">
                  </div>
                 </div>
              </div>

              <!-- 评估附件 -->
              <h3 class="text-lg font-medium text-gray-800 mb-4">评估附件</h3>
              <div class="space-y-2">
                <div class="flex items-center space-x-2 text-sm text-gray-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>数据资产评估报告.pdf</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-gray-600">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span>价值评估计算表.xlsx</span>
                </div>
              </div>
            </div>

                <!-- 数据权属证明 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-800">数据权属证明</h3>
                <button onclick="loadPreviousAssetOwnership()" class="px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 flex items-center">
                  <i class="fas fa-copy mr-2"></i>代入上一资产权属证明
                </button>
              </div>
              <p class="text-sm text-gray-600 mb-4">说明：请根据实际情况选择涉及的权属表单类型，并填写相应的指标评估表。</p>
              
              <!-- 权属表单类型选择 -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">请选择涉及的权属表单类型（可多选）<span class="text-red-500">*</span></label>
                <div class="space-y-2">
                  <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                    <input type="checkbox" class="mr-3 ownership-type-checkbox" value="device" onchange="toggleOwnershipForm('device')">
                    <span class="text-sm text-gray-700">（一）通过设备自行收集数据指标评估表</span>
                  </label>
                  <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                    <input type="checkbox" class="mr-3 ownership-type-checkbox" value="platform" onchange="toggleOwnershipForm('platform')">
                    <span class="text-sm text-gray-700">（二）通过电子业务平台收集的数据指标评估表</span>
                  </label>
                  <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                    <input type="checkbox" class="mr-3 ownership-type-checkbox" value="public" onchange="toggleOwnershipForm('public')">
                    <span class="text-sm text-gray-700">（三）收集公开数据指标评估表</span>
                  </label>
                  <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                    <input type="checkbox" class="mr-3 ownership-type-checkbox" value="authorized" onchange="toggleOwnershipForm('authorized')">
                    <span class="text-sm text-gray-700">（四）经授权使用第三方企业数据指标评估表</span>
                  </label>
                  <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                    <input type="checkbox" class="mr-3 ownership-type-checkbox" value="purchase" onchange="toggleOwnershipForm('purchase')">
                    <span class="text-sm text-gray-700">（五）向第三方企业采购数据指标评估表</span>
                  </label>
                </div>
              </div>

              <!-- （一）通过设备自行收集数据指标评估表 -->
              <div id="ownership-form-device" class="hidden mb-6 bg-white border-2 border-blue-300 rounded-lg p-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="text-md font-semibold text-blue-700">（一）通过设备自行收集数据指标评估表</h4>
                  <div class="flex items-center gap-4">
                    <label class="text-sm text-gray-700">
                      权属有效期：
                      <input type="date" id="device-ownership-start" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                      至
                      <input type="date" id="device-ownership-end" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                    </label>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full border border-gray-300 text-sm">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="border border-gray-300 px-3 py-2 text-center w-20">指标序号</th>
                        <th class="border border-gray-300 px-3 py-2 text-center w-48">名称</th>
                        <th class="border border-gray-300 px-3 py-2 text-center">上传内容</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">1</td>
                        <td class="border border-gray-300 px-3 py-2">设备合同及发票</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="device-file-1" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">2</td>
                        <td class="border border-gray-300 px-3 py-2">自行开发材料</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="device-file-2" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">3</td>
                        <td class="border border-gray-300 px-3 py-2">许可使用材料</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="device-file-3" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">4</td>
                        <td class="border border-gray-300 px-3 py-2">委托开发材料</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="device-file-4" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">5</td>
                        <td class="border border-gray-300 px-3 py-2">收集资质证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="device-file-5" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">6</td>
                        <td class="border border-gray-300 px-3 py-2">个人信息授权</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="device-file-6" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- （二）通过电子业务平台收集的数据指标评估表 -->
              <div id="ownership-form-platform" class="hidden mb-6 bg-white border-2 border-green-300 rounded-lg p-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="text-md font-semibold text-green-700">（二）通过电子业务平台收集的数据指标评估表</h4>
                  <div class="flex items-center gap-4">
                    <label class="text-sm text-gray-700">
                      权属有效期：
                      <input type="date" id="platform-ownership-start" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                      至
                      <input type="date" id="platform-ownership-end" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                    </label>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full border border-gray-300 text-sm">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="border border-gray-300 px-3 py-2 text-center w-20">指标序号</th>
                        <th class="border border-gray-300 px-3 py-2 text-center w-48">名称</th>
                        <th class="border border-gray-300 px-3 py-2 text-center">上传内容</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">1</td>
                        <td class="border border-gray-300 px-3 py-2">平台开发材料</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="platform-file-1" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">2</td>
                        <td class="border border-gray-300 px-3 py-2">平台资质证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="platform-file-2" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">3</td>
                        <td class="border border-gray-300 px-3 py-2">用户协议及隐私政策</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="platform-file-3" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">4</td>
                        <td class="border border-gray-300 px-3 py-2">个人信息保护措施</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="platform-file-4" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">5</td>
                        <td class="border border-gray-300 px-3 py-2">等保备案证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="platform-file-5" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- （三）收集公开数据指标评估表 -->
              <div id="ownership-form-public" class="hidden mb-6 bg-white border-2 border-purple-300 rounded-lg p-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="text-md font-semibold text-purple-700">（三）收集公开数据指标评估表</h4>
                  <div class="flex items-center gap-4">
                    <label class="text-sm text-gray-700">
                      权属有效期：
                      <input type="date" id="public-ownership-start" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                      至
                      <input type="date" id="public-ownership-end" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                    </label>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full border border-gray-300 text-sm">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="border border-gray-300 px-3 py-2 text-center w-20">指标序号</th>
                        <th class="border border-gray-300 px-3 py-2 text-center w-48">名称</th>
                        <th class="border border-gray-300 px-3 py-2 text-center">上传内容</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">1</td>
                        <td class="border border-gray-300 px-3 py-2">数据来源证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="public-file-1" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">2</td>
                        <td class="border border-gray-300 px-3 py-2">数据加工处理说明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="public-file-2" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">3</td>
                        <td class="border border-gray-300 px-3 py-2">知识产权证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="public-file-3" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">4</td>
                        <td class="border border-gray-300 px-3 py-2">是否包含个人隐私信息</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-3">
                            <label class="inline-flex items-center">
                              <input type="radio" name="public-privacy-check" value="yes" class="mr-1">
                              <span class="text-sm">是</span>
                            </label>
                            <label class="inline-flex items-center">
                              <input type="radio" name="public-privacy-check" value="no" class="mr-1" checked>
                              <span class="text-sm">否</span>
                            </label>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">5</td>
                        <td class="border border-gray-300 px-3 py-2">是否经过脱敏处理</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="space-y-2">
                            <div class="flex items-center gap-3">
                              <label class="inline-flex items-center">
                                <input type="radio" name="public-desensitization" value="yes" class="mr-1" onchange="toggleConditionalUpload('public-desensitization-upload', this.value === 'yes')">
                                <span class="text-sm">是</span>
                              </label>
                              <label class="inline-flex items-center">
                                <input type="radio" name="public-desensitization" value="no" class="mr-1" checked onchange="toggleConditionalUpload('public-desensitization-upload', this.value === 'yes')">
                                <span class="text-sm">否</span>
                              </label>
                            </div>
                            <div id="public-desensitization-upload" class="hidden mt-2">
                              <div class="flex items-center gap-2 bg-blue-50 px-3 py-2 rounded">
                                <input type="file" id="public-file-desensitization" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                                <span class="text-xs text-blue-600">请上传脱敏方案文件</span>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- （四）经授权使用第三方企业数据指标评估表 -->
              <div id="ownership-form-authorized" class="hidden mb-6 bg-white border-2 border-orange-300 rounded-lg p-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="text-md font-semibold text-orange-700">（四）经授权使用第三方企业数据指标评估表</h4>
                  <div class="flex items-center gap-4">
                    <label class="text-sm text-gray-700">
                      权属有效期：
                      <input type="date" id="authorized-ownership-start" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                      至
                      <input type="date" id="authorized-ownership-end" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                    </label>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full border border-gray-300 text-sm">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="border border-gray-300 px-3 py-2 text-center w-20">指标序号</th>
                        <th class="border border-gray-300 px-3 py-2 text-center w-48">名称</th>
                        <th class="border border-gray-300 px-3 py-2 text-center">上传内容</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">1</td>
                        <td class="border border-gray-300 px-3 py-2">授权协议</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="authorized-file-1" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">2</td>
                        <td class="border border-gray-300 px-3 py-2">个人信息主体同意证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="authorized-file-2" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">3</td>
                        <td class="border border-gray-300 px-3 py-2">审批流程文件</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="authorized-file-3" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">4</td>
                        <td class="border border-gray-300 px-3 py-2">数据加工处理证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="authorized-file-4" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">5</td>
                        <td class="border border-gray-300 px-3 py-2">是否包含敏感数据</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-3">
                            <label class="inline-flex items-center">
                              <input type="radio" name="authorized-sensitive-check" value="yes" class="mr-1">
                              <span class="text-sm">是</span>
                            </label>
                            <label class="inline-flex items-center">
                              <input type="radio" name="authorized-sensitive-check" value="no" class="mr-1" checked>
                              <span class="text-sm">否</span>
                            </label>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">6</td>
                        <td class="border border-gray-300 px-3 py-2">是否有数据安全评估报告</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="space-y-2">
                            <div class="flex items-center gap-3">
                              <label class="inline-flex items-center">
                                <input type="radio" name="authorized-security-report" value="yes" class="mr-1" onchange="toggleConditionalUpload('authorized-security-upload', this.value === 'yes')">
                                <span class="text-sm">是</span>
                              </label>
                              <label class="inline-flex items-center">
                                <input type="radio" name="authorized-security-report" value="no" class="mr-1" checked onchange="toggleConditionalUpload('authorized-security-upload', this.value === 'yes')">
                                <span class="text-sm">否</span>
                              </label>
                            </div>
                            <div id="authorized-security-upload" class="hidden mt-2">
                              <div class="flex items-center gap-2 bg-blue-50 px-3 py-2 rounded">
                                <input type="file" id="authorized-file-security" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                                <span class="text-xs text-blue-600">请上传安全评估报告</span>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- （五）向第三方企业采购数据指标评估表 -->
              <div id="ownership-form-purchase" class="hidden mb-6 bg-white border-2 border-red-300 rounded-lg p-4">
                <div class="flex items-center justify-between mb-4">
                  <h4 class="text-md font-semibold text-red-700">（五）向第三方企业采购数据指标评估表</h4>
                  <div class="flex items-center gap-4">
                    <label class="text-sm text-gray-700">
                      权属有效期：
                      <input type="date" id="purchase-ownership-start" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                      至
                      <input type="date" id="purchase-ownership-end" class="ml-2 px-2 py-1 text-sm border border-gray-300 rounded" required>
                    </label>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full border border-gray-300 text-sm">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="border border-gray-300 px-3 py-2 text-center w-20">指标序号</th>
                        <th class="border border-gray-300 px-3 py-2 text-center w-48">名称</th>
                        <th class="border border-gray-300 px-3 py-2 text-center">上传内容</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">1</td>
                        <td class="border border-gray-300 px-3 py-2">采购合同</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="purchase-file-1" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">2</td>
                        <td class="border border-gray-300 px-3 py-2">付款凭证</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="purchase-file-2" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">3</td>
                        <td class="border border-gray-300 px-3 py-2">数据交付证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="purchase-file-3" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">4</td>
                        <td class="border border-gray-300 px-3 py-2">供应商资质证明</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-2">
                            <input type="file" id="purchase-file-4" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                            <span class="text-xs text-gray-500">支持：word, pdf, 图片</span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">5</td>
                        <td class="border border-gray-300 px-3 py-2">是否为独家采购</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="flex items-center gap-3">
                            <label class="inline-flex items-center">
                              <input type="radio" name="purchase-exclusive-check" value="yes" class="mr-1">
                              <span class="text-sm">是</span>
                            </label>
                            <label class="inline-flex items-center">
                              <input type="radio" name="purchase-exclusive-check" value="no" class="mr-1" checked>
                              <span class="text-sm">否</span>
                            </label>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="border border-gray-300 px-3 py-2 text-center">6</td>
                        <td class="border border-gray-300 px-3 py-2">是否有质量验收报告</td>
                        <td class="border border-gray-300 px-3 py-2">
                          <div class="space-y-2">
                            <div class="flex items-center gap-3">
                              <label class="inline-flex items-center">
                                <input type="radio" name="purchase-quality-report" value="yes" class="mr-1" onchange="toggleConditionalUpload('purchase-quality-upload', this.value === 'yes')">
                                <span class="text-sm">是</span>
                              </label>
                              <label class="inline-flex items-center">
                                <input type="radio" name="purchase-quality-report" value="no" class="mr-1" checked onchange="toggleConditionalUpload('purchase-quality-upload', this.value === 'yes')">
                                <span class="text-sm">否</span>
                              </label>
                            </div>
                            <div id="purchase-quality-upload" class="hidden mt-2">
                              <div class="flex items-center gap-2 bg-blue-50 px-3 py-2 rounded">
                                <input type="file" id="purchase-file-quality" class="text-xs" accept=".doc,.docx,.pdf,.jpg,.jpeg,.png" multiple>
                                <span class="text-xs text-blue-600">请上传质量验收报告</span>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

                <!-- 其他附件上传 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">其他附件上传</h3>
              
              <!-- 转资增资申请表 -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">转资增资申请表</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600 mt-2">
                    <label for="asset-application" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX、XLS、XLSX 格式</p>
                  <input type="file" id="asset-application" class="hidden" accept=".pdf,.doc,.docx,.xls,.xlsx">
                  <div class="mt-4"><div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                    <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-excel"></i><span>转资增资申请表.xlsx</span></div>
                    <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                  </div></div>
                </div>
              </div>
              
              <!-- 预期经济利益流入的论证材料 -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">预期经济利益流入的论证材料</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600 mt-2">
                    <label for="benefit-docs" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式，可上传多个文件</p>
                  <input type="file" id="benefit-docs" class="hidden" accept=".pdf,.doc,.docx" multiple>
                  <div class="mt-4 space-y-2">
                    <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                      <div class="flex items-center space-x-2 text-sm text-blue-600"><i class="fas fa-file-pdf"></i><span>经济利益论证报告.pdf</span></div>
                      <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 知识产权登记 -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">知识产权登记</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600 mt-2">
                    <label for="intellectual-property-file" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                  <input type="file" id="intellectual-property-file" class="hidden" accept=".pdf,.doc,.docx">
                  <div class="mt-4">
                    <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                      <div class="flex items-center space-x-2 text-sm text-blue-600">
                        <i class="fas fa-file-pdf"></i>
                        <span>知识产权登记证书.pdf</span>
                      </div>
                      <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 数据质量 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">数据质量</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                  <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                  <div class="text-sm text-gray-600 mt-2">
                    <label for="data-quality-file" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                  </div>
                  <p class="text-xs text-gray-500 mt-1">支持 PDF、Excel、Word 格式</p>
                  <input type="file" id="data-quality-file" class="hidden" accept=".pdf,.xlsx,.xls,.doc,.docx">
                  <div class="mt-4">
                    <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                      <div class="flex items-center space-x-2 text-sm text-blue-600">
                        <i class="fas fa-file-pdf"></i>
                        <span>数据质量报告.pdf</span>
                      </div>
                      <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                    </div>
                  </div>
                </div>
              </div>
                </div>
              </div>
              
              <!-- 资产2页签内容 -->
              <div id="asset-tab-content-2" class="asset-tab-content hidden space-y-6 mt-6">
                <!-- 资产内容容器 -->
                <div class="border-2 border-blue-300 rounded-lg p-6 bg-blue-50/30">
                  <!-- 资产信息 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产信息</h3>
                  <p class="text-sm text-gray-600 mb-4">说明：展示立项环节中定义的资产信息，可在此进行最终确认和编辑。</p>
                  
                  <!-- 是否为增资 -->
                  <div class="mb-6">
                    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                      <label class="block text-sm font-medium text-gray-700 mb-3">
                        <i class="fas fa-plus-circle mr-2 text-yellow-600"></i>
                        是否为增资
                      </label>
                      <div class="flex items-center space-x-6">
                        <label class="inline-flex items-center">
                          <input type="radio" name="is-addition-2" value="no" class="form-radio text-blue-600" checked onchange="toggleAdditionFields2()">
                          <span class="ml-2 text-sm">否（新建资产）</span>
                        </label>
                        <label class="inline-flex items-center">
                          <input type="radio" name="is-addition-2" value="yes" class="form-radio text-blue-600" onchange="toggleAdditionFields2()">
                          <span class="ml-2 text-sm">是（增资）</span>
                        </label>
                      </div>
                      
                      <!-- 增资相关字段 -->
                      <div id="addition-fields-2" class="mt-4 space-y-4 hidden">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">关联现有资产</label>
                          <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">请选择要增资的资产</option>
                            <option>客户数据分析平台</option>
                            <option>供应商管理系统</option>
                            <option>采购业务分析数据集</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 mb-2">增资金额（万元）</label>
                          <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入增资金额" min="0" step="0.01">
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 资产基本信息 -->
                  <div class="mb-6">
                    <h4 class="text-md font-medium text-gray-700 mb-3">资产 2</h4>
                    <div class="grid grid-cols-4 gap-4 mb-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">资产名称</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="成交分析数据集" readonly>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">资产类型确认 *</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                          <option value="">请选择</option>
                          <option value="无形资产" selected>无形资产</option>
                          <option value="存货">存货</option>
                        </select>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">持有目的</label>
                        <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">业务运营</div>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">所属部门</label>
                        <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">数据管理部</div>
                      </div>
                    </div>
                    <div class="grid grid-cols-4 gap-4 mb-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">业务归属</label>
                        <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">零售业务</div>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">所属行业</label>
                        <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">银行业</div>
                      </div>
                      <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">详细描述</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2">该数据集包含成交业务相关的分析数据，包括成交记录、成交金额、成交周期等关键指标。主要用于成交分析、业绩评估等业务场景。</textarea>
                      </div>
                    </div>
                  </div>

                  <!-- 资产基础信息配置 -->
                  <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="text-md font-medium text-gray-700">资产基础信息配置</h4>
                      <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                        <i class="fas fa-cog mr-1"></i>配置标签属性
                      </button>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                      <div class="space-y-2 text-sm text-gray-600">
                        <div><span class="font-medium">技术标签：</span>未配置</div>
                        <div><span class="font-medium">业务标签：</span>未配置</div>
                        <div><span class="font-medium">安全标签：</span>未配置</div>
                        <div><span class="font-medium">资产属性：</span>未配置</div>
                        <div><span class="font-medium">所属目录：</span>未配置</div>
                      </div>
                    </div>
                  </div>

                  <!-- 数据集管理 -->
                  <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="text-md font-medium text-gray-700">数据集管理</h4>
                      <button class="px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700">
                        <i class="fas fa-plus mr-1"></i>新增数据集
                      </button>
                    </div>
                    <div class="text-sm text-gray-500">暂未配置数据集</div>
                  </div>
                </div>
                
                <!-- 资产使用年限 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产使用年限</h3>
                  <div class="space-y-6">
                    <div class="space-y-4">
                      <div class="grid grid-cols-3 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-600 mb-1">资产名称</label>
                          <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md">成交分析数据集</div>
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-600 mb-1">预计使用年限</label>
                          <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="5年" placeholder="请输入预计使用年限">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-600 mb-1">摊销方法</label>
                          <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="直线摊销法" selected>直线摊销法</option>
                            <option value="产量摊销法">产量摊销法</option>
                            <option value="年限平均法">年限平均法</option>
                            <option value="其他">其他</option>
                          </select>
                        </div>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">使用年限说明</label>
                        <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[80px]">
                          根据数据资产的技术特性和业务价值，预计该资产可使用5年。在5年内，资产将保持其核心价值，之后可能需要技术升级或重新开发。
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 资产登记信息 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产登记信息</h3>
                  <div class="grid grid-cols-5 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">资产名称</label>
                      <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                        成交分析数据集
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">资产编号</label>
                      <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                        DA-2025-002
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">登记日期</label>
                      <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                        2025年9月25日
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">资产状态</label>
                      <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                        已登记
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-1">管理责任人</label>
                      <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                        数据资产管理部
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 资产评估价值 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">资产评估价值（选填，也可在资产卡片中修改）</h3>
                  <div class="space-y-4">
                    <div class="grid grid-cols-4 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">资产名称</label>
                        <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md">成交分析数据集</div>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">评估价值</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="150万元" placeholder="请输入评估价值">
                      </div>
                      <div>
                       <label class="block text-sm font-medium text-gray-600 mb-1">评估方法</label>
                       <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="成本法 + 收益法综合评估" placeholder="请选择评估方法">
                      </div>
                      <div>
                       <label class="block text-sm font-medium text-gray-600 mb-1">评估结论</label>
                       <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="基于成本法和收益法的综合评估,该数据资产的总价值约为150万元。" placeholder="请输入评估结论">
                      </div>
                    </div>
                  </div>

                  <!-- 评估附件 -->
                  <h3 class="text-lg font-medium text-gray-800 mb-4 mt-4">评估附件</h3>
                  <div class="space-y-2">
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      <span>数据资产评估报告.pdf</span>
                    </div>
                  </div>
                </div>

                <!-- 数据权属证明 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-800">数据权属证明</h3>
                    <button onclick="loadPreviousAssetOwnership()" class="px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 flex items-center">
                      <i class="fas fa-copy mr-2"></i>代入上一资产权属证明
                    </button>
                  </div>
                  <p class="text-sm text-gray-600 mb-4">说明：请根据实际情况选择涉及的权属表单类型，并填写相应的指标评估表。</p>
                  
                  <!-- 权属表单类型选择 -->
                  <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">请选择涉及的权属表单类型（可多选）<span class="text-red-500">*</span></label>
                    <div class="space-y-2">
                      <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                        <input type="checkbox" class="mr-3 ownership-type-checkbox-2" value="device" onchange="toggleOwnershipForm2('device')">
                        <span class="text-sm text-gray-700">（一）通过设备自行收集数据指标评估表</span>
                      </label>
                      <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                        <input type="checkbox" class="mr-3 ownership-type-checkbox-2" value="platform" onchange="toggleOwnershipForm2('platform')">
                        <span class="text-sm text-gray-700">（二）通过电子业务平台收集的数据指标评估表</span>
                      </label>
                      <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                        <input type="checkbox" class="mr-3 ownership-type-checkbox-2" value="public" onchange="toggleOwnershipForm2('public')">
                        <span class="text-sm text-gray-700">（三）收集公开数据指标评估表</span>
                      </label>
                      <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                        <input type="checkbox" class="mr-3 ownership-type-checkbox-2" value="authorized" onchange="toggleOwnershipForm2('authorized')">
                        <span class="text-sm text-gray-700">（四）经授权使用第三方企业数据指标评估表</span>
                      </label>
                      <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                        <input type="checkbox" class="mr-3 ownership-type-checkbox-2" value="purchase" onchange="toggleOwnershipForm2('purchase')">
                        <span class="text-sm text-gray-700">（五）向第三方企业采购数据指标评估表</span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- 其他附件上传 -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <h3 class="text-lg font-medium text-gray-800 mb-4">其他附件上传</h3>
                  
                  <!-- 转资增资申请表 -->
                  <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">转资增资申请表</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                      <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                      <div class="text-sm text-gray-600 mt-2">
                        <label for="asset-application-2" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                      </div>
                      <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX、XLS、XLSX 格式</p>
                      <input type="file" id="asset-application-2" class="hidden" accept=".pdf,.doc,.docx,.xls,.xlsx">
                    </div>
                  </div>
                  
                  <!-- 预期经济利益流入的论证材料 -->
                  <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">预期经济利益流入的论证材料</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                      <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                      <div class="text-sm text-gray-600 mt-2">
                        <label for="benefit-docs-2" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                      </div>
                      <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式，可上传多个文件</p>
                      <input type="file" id="benefit-docs-2" class="hidden" accept=".pdf,.doc,.docx" multiple>
                    </div>
                  </div>
                  
                  <!-- 知识产权登记 -->
                  <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">知识产权登记</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                      <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                      <div class="text-sm text-gray-600 mt-2">
                        <label for="intellectual-property-file-2" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                      </div>
                      <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
                      <input type="file" id="intellectual-property-file-2" class="hidden" accept=".pdf,.doc,.docx">
                    </div>
                  </div>
                  
                  <!-- 数据质量 -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">数据质量</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                      <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                      <div class="text-sm text-gray-600 mt-2">
                        <label for="data-quality-file-2" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                      </div>
                      <p class="text-xs text-gray-500 mt-1">支持 PDF、Excel、Word 格式</p>
                      <input type="file" id="data-quality-file-2" class="hidden" accept=".pdf,.xlsx,.xls,.doc,.docx">
                    </div>
                  </div>
                </div>
              </div>
                </div>
              </div>

            <!-- 新增资产弹窗 -->
            <div id="add-asset-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center">
              <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium text-gray-800">新增资产</h3>
                  <button onclick="closeAddAssetDialog()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    资产名称 <span class="text-red-500">*</span>
                  </label>
                  <input type="text" id="new-asset-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入资产名称" maxlength="50">
                </div>
                <div class="flex justify-end space-x-3">
                  <button onclick="closeAddAssetDialog()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                    取消
                  </button>
                  <button onclick="addNewAsset()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    确定
                  </button>
                </div>
              </div>
            </div>

            <!-- 账面价值（移至页签底部） -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <h3 class="text-lg font-medium text-gray-800 mb-4">账面价值</h3>
              
              <!-- 费用分类汇总 -->
              <div class="mb-6">
                <h4 class="text-md font-medium text-gray-700 mb-3">费用分类汇总</h4>
                <div class="grid grid-cols-4 gap-4">
                  <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <div class="text-center">
                      <div class="text-lg font-bold text-blue-600" id="material-total">¥50万</div>
                      <div class="text-sm text-blue-600">材料费</div>
                    </div>
                  </div>
                  <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                    <div class="text-center">
                      <div class="text-lg font-bold text-green-600" id="labor-total">¥80万</div>
                      <div class="text-sm text-green-600">工时费</div>
                    </div>
                  </div>
                  <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                    <div class="text-center">
                      <div class="text-lg font-bold text-orange-600" id="service-total">¥70万</div>
                      <div class="text-sm text-orange-600">服务费</div>
                    </div>
                  </div>
                  <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                    <div class="text-center">
                      <div class="text-lg font-bold text-purple-600" id="allocation-total">¥200万</div>
                      <div class="text-sm text-purple-600">分配汇总</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 资产价值分配表 -->
              <div class="mb-4">
                <h4 class="text-md font-medium text-gray-700 mb-3">资产价值分配</h4>
                <div class="overflow-x-auto">
                  <table class="w-full border border-gray-200 rounded-lg">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">费用分类</th>
                        <th class="px-4 py-2 text-center text-sm font-medium text-gray-700 border-b bg-blue-50">材料费</th>
                        <th class="px-4 py-2 text-center text-sm font-medium text-gray-700 border-b bg-green-50">工时费</th>
                        <th class="px-4 py-2 text-center text-sm font-medium text-gray-700 border-b bg-yellow-50">服务费</th>
                        <th class="px-4 py-2 text-center text-sm font-medium text-gray-700 border-b bg-gray-100">按资产合计</th>
                      </tr>
                    </thead>
                    <tbody id="asset-allocation-table">
                      <!-- 采购业务分析数据集 -->
                      <tr class="border-b">
                        <td class="px-4 py-2 text-sm font-medium text-gray-900">采购业务分析数据集</td>
                        <td class="px-4 py-2 text-center">
                          <div class="mb-2">
                            <input type="number" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center" 
                                   value="60" min="0" max="100" onchange="calculateAllocationByCategory(this, 'material')">
                            <span class="text-xs text-gray-500 ml-1">%</span>
                          </div>
                          <div class="text-sm text-gray-600" id="asset1-material">¥30万</div>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <div class="mb-2">
                            <input type="number" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center" 
                                   value="50" min="0" max="100" onchange="calculateAllocationByCategory(this, 'labor')">
                            <span class="text-xs text-gray-500 ml-1">%</span>
                          </div>
                          <div class="text-sm text-gray-600" id="asset1-labor">¥40万</div>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <div class="mb-2">
                            <input type="number" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center" 
                                   value="60" min="0" max="100" onchange="calculateAllocationByCategory(this, 'service')">
                            <span class="text-xs text-gray-500 ml-1">%</span>
                          </div>
                          <div class="text-sm text-gray-600" id="asset1-service">¥42万</div>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <div class="text-lg font-bold text-gray-800" id="asset1-total">¥112万</div>
                        </td>
                      </tr>
                      <!-- 成交分析数据集 -->
                      <tr class="border-b">
                        <td class="px-4 py-2 text-sm font-medium text-gray-900">成交分析数据集</td>
                        <td class="px-4 py-2 text-center">
                          <div class="mb-2">
                            <input type="number" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center" 
                                   value="40" min="0" max="100" onchange="calculateAllocationByCategory(this, 'material')">
                            <span class="text-xs text-gray-500 ml-1">%</span>
                          </div>
                          <div class="text-sm text-gray-600" id="asset2-material">¥20万</div>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <div class="mb-2">
                            <input type="number" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center" 
                                   value="50" min="0" max="100" onchange="calculateAllocationByCategory(this, 'labor')">
                            <span class="text-xs text-gray-500 ml-1">%</span>
                          </div>
                          <div class="text-sm text-gray-600" id="asset2-labor">¥40万</div>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <div class="mb-2">
                            <input type="number" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded text-center" 
                                   value="40" min="0" max="100" onchange="calculateAllocationByCategory(this, 'service')">
                            <span class="text-xs text-gray-500 ml-1">%</span>
                          </div>
                          <div class="text-sm text-gray-600" id="asset2-service">¥28万</div>
                        </td>
                        <td class="px-4 py-2 text-center">
                          <div class="text-lg font-bold text-gray-800" id="asset2-total">¥88万</div>
                        </td>
                      </tr>
                      <!-- 分类总计 -->
                      <tr class="bg-gray-100 border-t-2 border-gray-400">
                        <td class="px-4 py-2 text-sm font-bold text-gray-900">分类总计</td>
                        <td class="px-4 py-2 text-center text-sm font-bold text-blue-600" id="material-total-allocated">¥50万</td>
                        <td class="px-4 py-2 text-center text-sm font-bold text-green-600" id="labor-total-allocated">¥80万</td>
                        <td class="px-4 py-2 text-center text-sm font-bold text-yellow-600" id="service-total-allocated">¥70万</td>
                        <td class="px-4 py-2 text-center">
                          <div class="text-lg font-bold text-gray-800" id="grand-total-allocated">¥200万</div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- 审核成本计量支撑文件 -->
              <div class="mb-4">
                <h4 class="text-md font-medium text-gray-700 mb-3">审核成本计量支撑文件</h4>
                <div class="space-y-4">
                  <!-- 文件上传 -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">成本计量支撑文件</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                      <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                      <div class="text-sm text-gray-600 mt-2">
                        <label for="cost-support-file" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
                      </div>
                      <p class="text-xs text-gray-500 mt-1">支持 PDF、Excel、Word 格式</p>
                      <input type="file" id="cost-support-file" class="hidden" accept=".pdf,.xlsx,.xls,.doc,.docx">
                      <div class="mt-4">
                        <div class="flex items-center justify-between bg-blue-50 px-4 py-2 rounded-md">
                          <div class="flex items-center space-x-2 text-sm text-blue-600">
                            <i class="fas fa-file-excel"></i>
                            <span>成本计量支撑文件.xlsx</span>
                          </div>
                          <button class="text-red-500 hover:text-red-700"><i class="fas fa-times"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 选择数据资源弹窗 -->
  <div id="dataResourceSelectionModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0">
          <h3 class="text-lg font-medium text-gray-900">选择数据资源</h3>
          <button onclick="closeDataResourceModal()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        
        <!-- 左右两栏布局 -->
        <div class="flex flex-1 overflow-hidden">
          <!-- 左侧：可选内容（树结构） -->
          <div class="w-1/2 border-r border-gray-200 flex flex-col">
            <!-- 搜索框 -->
            <div class="p-4 border-b border-gray-200 flex-shrink-0">
              <div class="flex gap-2">
                <input type="text" id="dataResourceSearch" placeholder="搜索数据资源" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                       onkeypress="if(event.key === 'Enter') searchDataResources()">
                <button onclick="searchDataResources()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm">
                  <i class="fas fa-search mr-1"></i>查询
                </button>
              </div>
            </div>
            
            <!-- 树形结构 -->
            <div class="flex-1 overflow-y-auto p-4">
              <div id="dataResourceTree" class="tree-container">
                <!-- 树形结构将通过JavaScript动态生成 -->
              </div>
            </div>
          </div>
          
          <!-- 右侧：已选申请清单 -->
          <div class="w-1/2 flex flex-col bg-gray-50">
            <div class="p-4 border-b border-gray-200 flex-shrink-0">
              <div class="flex items-center justify-between">
                <h4 class="text-sm font-medium text-gray-900">已选申请清单: <span id="selectedCount">0</span>项</h4>
                <button onclick="clearSelectedResources()" class="text-sm text-blue-500 hover:text-blue-700">清空表单</button>
              </div>
            </div>
            
            <!-- 已选列表 -->
            <div class="flex-1 overflow-y-auto p-4">
              <div id="selectedResourcesList" class="space-y-2">
                <!-- 已选择的数据资源将在这里显示 -->
              </div>
              <div id="emptySelectedMessage" class="text-center text-gray-400 text-sm mt-8">
                暂未选择数据资源
              </div>
            </div>
          </div>
        </div>
        
        <!-- 底部按钮 -->
        <div class="flex justify-end space-x-3 p-4 border-t border-gray-200 flex-shrink-0">
          <button onclick="closeDataResourceModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
            取消
          </button>
          <button onclick="confirmDataResourceSelection()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
            确认选择
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 项目基本信息模态框 -->
  <div id="projectBasicInfoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">项目基本信息</h3>
          <button onclick="closeProjectBasicInfoModal()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">项目名称</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md" id="projectName">数据质量管理系统</div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">负责人</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md" id="projectManager">张三</div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">项目类型 <span class="text-xs text-gray-500">(信息类/科技类)</span></label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md" id="projectType">信息类</div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">立项类型 <span class="text-xs text-gray-500">(二开自研/其他/待定)</span></label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md" id="establishmentType">二开自研</div>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">资产类型</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md" id="projectAssetType">无形资产</div>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">资产描述</label>
              <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md" id="assetDescription">构建企业级数据质量管理系统，提升数据治理能力，确保数据资产的质量和可靠性。</div>
            </div>
          </div>
          
          <!-- 财务汇总按钮 -->
          <div class="mt-6 pt-6 border-t border-gray-200">
            <div class="flex justify-center">
              <button onclick="showFinancialSummary()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-lg shadow-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-chart-pie mr-2"></i>
                每季度财务汇总
              </button>
            </div>
            <div class="text-center mt-2">
              <p class="text-xs text-gray-500">点击查看项目的季度财务汇总报告</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 财务汇总模态框 -->
  <div id="financialModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">项目财务汇总报告</h3>
          <button onclick="closeFinancialModal()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="p-6">
          <div class="mb-6">
            <h4 class="text-md font-medium text-gray-700 mb-4">季度财务汇总</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="bg-blue-50 p-4 rounded-lg">
                <h5 class="font-medium text-blue-800 mb-2">第一季度 (1-3月)</h5>
                <p class="text-sm text-blue-700">预算执行：85%</p>
                <p class="text-sm text-blue-700">实际支出：221,000元</p>
                <p class="text-sm text-blue-700">剩余预算：39,000元</p>
              </div>
              <div class="bg-green-50 p-4 rounded-lg">
                <h5 class="font-medium text-green-800 mb-2">第二季度 (4-6月)</h5>
                <p class="text-sm text-green-700">预算执行：92%</p>
                <p class="text-sm text-green-700">实际支出：239,200元</p>
                <p class="text-sm text-green-700">剩余预算：20,800元</p>
              </div>
            </div>
          </div>
          
          <div class="mb-6">
            <h4 class="text-md font-medium text-gray-700 mb-4">费用明细</h4>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">费用类别</th>
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">预算金额</th>
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">实际支出</th>
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">执行率</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr>
                    <td class="px-3 py-2 text-sm text-gray-700">人员费</td>
                    <td class="px-3 py-2 text-sm text-gray-900">150,000</td>
                    <td class="px-3 py-2 text-sm text-gray-900">142,500</td>
                    <td class="px-3 py-2 text-sm text-green-600">95%</td>
                  </tr>
                  <tr>
                    <td class="px-3 py-2 text-sm text-gray-700">设备费</td>
                    <td class="px-3 py-2 text-sm text-gray-900">80,000</td>
                    <td class="px-3 py-2 text-sm text-gray-900">78,000</td>
                    <td class="px-3 py-2 text-sm text-green-600">97.5%</td>
                  </tr>
                  <tr>
                    <td class="px-3 py-2 text-sm text-gray-700">材料费</td>
                    <td class="px-3 py-2 text-sm text-gray-900">30,000</td>
                    <td class="px-3 py-2 text-sm text-gray-900">28,500</td>
                    <td class="px-3 py-2 text-sm text-green-600">95%</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 返回上一页功能
    function goBack() {
      // 添加点击反馈效果
      const button = event.target.closest('button');
      if (button) {
        // 添加加载状态
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>返回中...';
        button.disabled = true;
        button.style.opacity = '0.7';
        
        // 添加点击反馈效果
        button.style.transform = 'scale(0.95)';
        setTimeout(() => {
          button.style.transform = '';
        }, 150);
        
        // 延迟执行返回操作，让用户看到反馈
        setTimeout(() => {
          // 检查是否有历史记录可以返回
          if (window.history.length > 1) {
            // 如果有历史记录，返回上一页
            window.history.back();
          } else {
            // 如果没有历史记录，跳转到资产开发管理页面
            window.location.href = '资产开发管理.html';
          }
        }, 300);
      }
    }
    
    // 页签切换功能
    function showTab(tabName) {
      try {
        // 隐藏所有页签内容
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(content => {
          content.classList.remove('active');
        });
        
        // 移除所有页签按钮的激活状态
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
          button.classList.remove('active', 'text-blue-600');
          button.classList.add('text-gray-500');
        });
        
        // 显示选中的页签内容
        const selectedTab = document.getElementById(tabName + '-tab');
        if (selectedTab) {
          selectedTab.classList.add('active');
        }
        
        // 激活对应的页签按钮
        const selectedButton = document.querySelector(`[data-tab="${tabName}"]`);
        if (selectedButton) {
          selectedButton.classList.remove('text-gray-500');
          selectedButton.classList.add('active', 'text-blue-600');
        }
        
        // 自动显示第一个子页签（如果有的话）
        if (selectedTab) {
          const firstSubButton = selectedTab.querySelector('.sub-tab-button.active');
          if (!firstSubButton) {
            const firstSubButtonAll = selectedTab.querySelector('.sub-tab-button');
            if (firstSubButtonAll) {
              const firstSubTabName = firstSubButtonAll.getAttribute('data-subtab');
              if (firstSubTabName) {
                showSubTab(tabName, firstSubTabName);
              }
            }
          }
        }
      } catch (error) {
        console.error('页签切换错误:', error);
      }
    }
    
    // 子标签页切换函数
    function showSubTab(phase, subTabName) {
      // 获取当前大环节下的所有子标签内容
      const parentTab = document.getElementById(phase + '-tab');
      if (!parentTab) return;
      
      const subContents = parentTab.querySelectorAll('.sub-tab-content');
      subContents.forEach(content => content.classList.remove('active'));
      
      // 获取当前大环节下的所有子标签按钮
      const subButtons = parentTab.querySelectorAll('.sub-tab-button');
      subButtons.forEach(button => button.classList.remove('active'));
      
      // 激活选中的子标签按钮
      const selectedButton = parentTab.querySelector(`[data-subtab="${subTabName}"]`);
      if (selectedButton) {
        selectedButton.classList.add('active');
      }
      
      // 显示选中的子标签内容
      const selectedSubTab = document.getElementById(phase + '-' + subTabName);
      if (selectedSubTab) {
        selectedSubTab.classList.add('active');
      }
    }
    
    // 资产计数器
    let assetCounter = 2; // 从2开始，因为已经有资产1和资产2
    
    // 资产页签切换函数
    function switchAssetTab(assetId) {
      // 隐藏所有资产页签内容
      const assetTabContents = document.querySelectorAll('.asset-tab-content');
      assetTabContents.forEach(content => content.classList.add('hidden'));
      
      // 移除所有资产页签按钮的激活状态
      const assetTabButtons = document.querySelectorAll('.asset-tab-button');
      assetTabButtons.forEach(button => {
        button.classList.remove('border-blue-500', 'text-blue-600');
        button.classList.add('border-transparent', 'text-gray-500');
      });
      
      // 显示选中的资产页签内容
      const assetNumber = assetId.replace('asset', '');
      const selectedAssetTab = document.getElementById('asset-tab-content-' + assetNumber);
      if (selectedAssetTab) {
        selectedAssetTab.classList.remove('hidden');
      }
      
      // 激活选中的资产页签按钮
      const selectedAssetButton = document.getElementById('asset-tab-' + assetNumber);
      if (selectedAssetButton) {
        selectedAssetButton.classList.remove('border-transparent', 'text-gray-500');
        selectedAssetButton.classList.add('border-blue-500', 'text-blue-600');
      }
    }
    
    // 显示新增资产弹窗
    function showAddAssetDialog() {
      const modal = document.getElementById('add-asset-modal');
      const input = document.getElementById('new-asset-name');
      if (modal && input) {
        modal.classList.remove('hidden');
        input.value = '';
        input.focus();
      }
    }
    
    // 关闭新增资产弹窗
    function closeAddAssetDialog() {
      const modal = document.getElementById('add-asset-modal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }
    
    // 创建新资产
    function addNewAsset() {
      const assetNameInput = document.getElementById('new-asset-name');
      const assetName = assetNameInput ? assetNameInput.value.trim() : '';
      
      if (!assetName) {
        alert('请输入资产名称');
        return;
      }
      
      assetCounter++;
      const assetId = 'asset' + assetCounter;
      const assetNumber = assetCounter;
      
      // 创建页签按钮
      const tabNav = document.querySelector('nav[aria-label="资产页签"]');
      if (tabNav) {
        const newTabButton = document.createElement('button');
        newTabButton.onclick = () => switchAssetTab(assetId);
        newTabButton.id = 'asset-tab-' + assetNumber;
        newTabButton.className = 'asset-tab-button border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap';
        newTabButton.setAttribute('data-asset', assetId);
        newTabButton.textContent = assetName;
        
        // 在"新增资产"按钮之前插入
        const addButton = tabNav.querySelector('button[onclick="showAddAssetDialog()"]');
        if (addButton) {
          tabNav.insertBefore(newTabButton, addButton);
        } else {
          tabNav.appendChild(newTabButton);
        }
      }
      
      // 创建资产内容
      const asset2Content = document.getElementById('asset-tab-content-2');
      if (asset2Content && asset2Content.parentNode) {
        const newAssetContent = createAssetContent(assetNumber, assetName);
        // 在资产2内容之后插入新资产内容
        asset2Content.parentNode.insertBefore(newAssetContent, asset2Content.nextSibling);
      }
      
      // 切换到新创建的资产页签
      switchAssetTab(assetId);
      
      // 关闭弹窗
      closeAddAssetDialog();
    }
    
    // 创建资产内容模板
    function createAssetContent(assetNumber, assetName) {
      const contentDiv = document.createElement('div');
      contentDiv.id = 'asset-tab-content-' + assetNumber;
      contentDiv.className = 'asset-tab-content hidden space-y-6 mt-6';
      
      contentDiv.innerHTML = `
        <!-- 资产内容容器 -->
        <div class="border-2 border-blue-300 rounded-lg p-6 bg-blue-50/30">
          <!-- 资产信息 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-800 mb-4">资产信息</h3>
          <p class="text-sm text-gray-600 mb-4">说明：展示立项环节中定义的资产信息，可在此进行最终确认和编辑。</p>
          
          <!-- 是否为增资 -->
          <div class="mb-6">
            <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
              <label class="block text-sm font-medium text-gray-700 mb-3">
                <i class="fas fa-plus-circle mr-2 text-yellow-600"></i>
                是否为增资
              </label>
              <div class="flex items-center space-x-6">
                <label class="inline-flex items-center">
                  <input type="radio" name="is-addition-${assetNumber}" value="no" class="form-radio text-blue-600" checked onchange="toggleAdditionFieldsDynamic(${assetNumber})">
                  <span class="ml-2 text-sm">否（新建资产）</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="radio" name="is-addition-${assetNumber}" value="yes" class="form-radio text-blue-600" onchange="toggleAdditionFieldsDynamic(${assetNumber})">
                  <span class="ml-2 text-sm">是（增资）</span>
                </label>
              </div>
              
              <!-- 增资相关字段 -->
              <div id="addition-fields-${assetNumber}" class="mt-4 space-y-4 hidden">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">关联现有资产</label>
                  <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">请选择要增资的资产</option>
                    <option>客户数据分析平台</option>
                    <option>供应商管理系统</option>
                    <option>采购业务分析数据集</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">增资金额（万元）</label>
                  <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入增资金额" min="0" step="0.01">
                </div>
              </div>
            </div>
          </div>
          
          <!-- 资产基本信息 -->
          <div class="mb-6">
            <h4 class="text-md font-medium text-gray-700 mb-3">资产 ${assetNumber}</h4>
            <div class="grid grid-cols-4 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">资产名称</label>
                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="${assetName}" readonly>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">资产类型确认 *</label>
                <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">请选择</option>
                  <option value="无形资产">无形资产</option>
                  <option value="存货">存货</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">持有目的</label>
                <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">业务运营</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">所属部门</label>
                <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">数据管理部</div>
              </div>
            </div>
            <div class="grid grid-cols-4 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">业务归属</label>
                <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">零售业务</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">所属行业</label>
                <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-700">银行业</div>
              </div>
              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">详细描述</label>
                <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="请输入详细描述"></textarea>
              </div>
            </div>
          </div>

          <!-- 资产基础信息配置 -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-md font-medium text-gray-700">资产基础信息配置</h4>
              <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                <i class="fas fa-cog mr-1"></i>配置标签属性
              </button>
            </div>
            <div class="bg-white border border-gray-200 rounded-lg p-4">
              <div class="space-y-2 text-sm text-gray-600">
                <div><span class="font-medium">技术标签：</span>未配置</div>
                <div><span class="font-medium">业务标签：</span>未配置</div>
                <div><span class="font-medium">安全标签：</span>未配置</div>
                <div><span class="font-medium">资产属性：</span>未配置</div>
                <div><span class="font-medium">所属目录：</span>未配置</div>
              </div>
            </div>
          </div>

          <!-- 数据集管理 -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-md font-medium text-gray-700">数据集管理</h4>
              <button class="px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700">
                <i class="fas fa-plus mr-1"></i>新增数据集
              </button>
            </div>
            <div class="text-sm text-gray-500">暂未配置数据集</div>
          </div>
        </div>
        
        <!-- 资产使用年限 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
          <h3 class="text-lg font-medium text-gray-800 mb-4">资产使用年限</h3>
          <div class="space-y-6">
            <div class="space-y-4">
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">资产名称</label>
                  <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md">${assetName}</div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">预计使用年限</label>
                  <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入预计使用年限">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">摊销方法</label>
                  <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="直线摊销法" selected>直线摊销法</option>
                    <option value="产量摊销法">产量摊销法</option>
                    <option value="年限平均法">年限平均法</option>
                    <option value="其他">其他</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">使用年限说明</label>
                <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md min-h-[80px]"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- 资产登记信息 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-800 mb-4">资产登记信息</h3>
          <div class="grid grid-cols-5 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">资产名称</label>
              <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                ${assetName}
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">资产编号</label>
              <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                -
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">登记日期</label>
              <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                -
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">资产状态</label>
              <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                -
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">管理责任人</label>
              <div class="text-sm text-gray-900 bg-white px-3 py-2 rounded-md border border-gray-200">
                -
              </div>
            </div>
          </div>
        </div>

        <!-- 资产评估价值 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
          <h3 class="text-lg font-medium text-gray-800 mb-4">资产评估价值（选填，也可在资产卡片中修改）</h3>
          <div class="space-y-4">
            <div class="grid grid-cols-4 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">资产名称</label>
                <div class="text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded-md">${assetName}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">评估价值</label>
                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入评估价值">
              </div>
              <div>
               <label class="block text-sm font-medium text-gray-600 mb-1">评估方法</label>
               <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请选择评估方法">
              </div>
              <div>
               <label class="block text-sm font-medium text-gray-600 mb-1">评估结论</label>
               <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入评估结论">
              </div>
            </div>
          </div>
          <h3 class="text-lg font-medium text-gray-800 mb-4 mt-4">评估附件</h3>
          <div class="space-y-2">
            <div class="text-sm text-gray-500">暂无附件</div>
          </div>
        </div>

        <!-- 数据权属证明 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-medium text-gray-800">数据权属证明</h3>
          </div>
          <p class="text-sm text-gray-600 mb-4">说明：请根据实际情况选择涉及的权属表单类型，并填写相应的指标评估表。</p>
          
          <!-- 权属表单类型选择 -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-3">请选择涉及的权属表单类型（可多选）<span class="text-red-500">*</span></label>
            <div class="space-y-2">
              <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                <input type="checkbox" class="mr-3 ownership-type-checkbox-${assetNumber}" value="device" onchange="toggleOwnershipFormDynamic('device', ${assetNumber})">
                <span class="text-sm text-gray-700">（一）通过设备自行收集数据指标评估表</span>
              </label>
              <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                <input type="checkbox" class="mr-3 ownership-type-checkbox-${assetNumber}" value="platform" onchange="toggleOwnershipFormDynamic('platform', ${assetNumber})">
                <span class="text-sm text-gray-700">（二）通过电子业务平台收集的数据指标评估表</span>
              </label>
              <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                <input type="checkbox" class="mr-3 ownership-type-checkbox-${assetNumber}" value="public" onchange="toggleOwnershipFormDynamic('public', ${assetNumber})">
                <span class="text-sm text-gray-700">（三）收集公开数据指标评估表</span>
              </label>
              <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                <input type="checkbox" class="mr-3 ownership-type-checkbox-${assetNumber}" value="authorized" onchange="toggleOwnershipFormDynamic('authorized', ${assetNumber})">
                <span class="text-sm text-gray-700">（四）经授权使用第三方企业数据指标评估表</span>
              </label>
              <label class="flex items-center p-3 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 cursor-pointer">
                <input type="checkbox" class="mr-3 ownership-type-checkbox-${assetNumber}" value="purchase" onchange="toggleOwnershipFormDynamic('purchase', ${assetNumber})">
                <span class="text-sm text-gray-700">（五）向第三方企业采购数据指标评估表</span>
              </label>
            </div>
          </div>
        </div>

        <!-- 其他附件上传 -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-800 mb-4">其他附件上传</h3>
          
          <!-- 转资增资申请表 -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">转资增资申请表</label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
              <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
              <div class="text-sm text-gray-600 mt-2">
                <label for="asset-application-${assetNumber}" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
              </div>
              <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX、XLS、XLSX 格式</p>
              <input type="file" id="asset-application-${assetNumber}" class="hidden" accept=".pdf,.doc,.docx,.xls,.xlsx">
            </div>
          </div>
          
          <!-- 预期经济利益流入的论证材料 -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">预期经济利益流入的论证材料</label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
              <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
              <div class="text-sm text-gray-600 mt-2">
                <label for="benefit-docs-${assetNumber}" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
              </div>
              <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式，可上传多个文件</p>
              <input type="file" id="benefit-docs-${assetNumber}" class="hidden" accept=".pdf,.doc,.docx" multiple>
            </div>
          </div>
          
          <!-- 知识产权登记 -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">知识产权登记</label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
              <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
              <div class="text-sm text-gray-600 mt-2">
                <label for="intellectual-property-file-${assetNumber}" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
              </div>
              <p class="text-xs text-gray-500 mt-1">支持 PDF、DOC、DOCX 格式</p>
              <input type="file" id="intellectual-property-file-${assetNumber}" class="hidden" accept=".pdf,.doc,.docx">
            </div>
          </div>
          
          <!-- 数据质量 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">数据质量</label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
              <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
              <div class="text-sm text-gray-600 mt-2">
                <label for="data-quality-file-${assetNumber}" class="cursor-pointer text-blue-600 hover:text-blue-800">点击上传</label>或拖拽文件到此处
              </div>
              <p class="text-xs text-gray-500 mt-1">支持 PDF、Excel、Word 格式</p>
              <input type="file" id="data-quality-file-${assetNumber}" class="hidden" accept=".pdf,.xlsx,.xls,.doc,.docx">
            </div>
          </div>
        </div>
        </div>
      `;
      
      return contentDiv;
    }
    
    // 动态切换增资字段显示/隐藏
    function toggleAdditionFieldsDynamic(assetNumber) {
      const additionFields = document.getElementById('addition-fields-' + assetNumber);
      const isAddition = document.querySelector(`input[name="is-addition-${assetNumber}"]:checked`).value === 'yes';
      
      if (additionFields) {
        if (isAddition) {
          additionFields.classList.remove('hidden');
        } else {
          additionFields.classList.add('hidden');
        }
      }
    }
    
    // 动态切换权属证明表单显示
    function toggleOwnershipFormDynamic(type, assetNumber) {
      const formId = 'ownership-form-' + type + '-' + assetNumber;
      const form = document.getElementById(formId);
      const checkbox = document.querySelector(`input[value="${type}"].ownership-type-checkbox-${assetNumber}`);
      
      if (checkbox && checkbox.checked) {
        if (form) {
          form.classList.remove('hidden');
        }
      } else if (form) {
        form.classList.add('hidden');
      }
    }
    
    // 切换增资字段显示/隐藏
    function toggleAdditionFields() {
      const additionFields = document.getElementById('addition-fields');
      const isAddition = document.querySelector('input[name="is-addition"]:checked').value === 'yes';
      
      if (isAddition) {
        additionFields.classList.remove('hidden');
      } else {
        additionFields.classList.add('hidden');
      }
    }
    
    // 切换资产2增资字段显示/隐藏
    function toggleAdditionFields2() {
      const additionFields = document.getElementById('addition-fields-2');
      const isAddition = document.querySelector('input[name="is-addition-2"]:checked').value === 'yes';
      
      if (isAddition) {
        additionFields.classList.remove('hidden');
      } else {
        additionFields.classList.add('hidden');
      }
    }

    // 切换权属证明表单显示
    function toggleOwnershipForm(type) {
      const formId = 'ownership-form-' + type;
      const form = document.getElementById(formId);
      const checkbox = document.querySelector(`input[value="${type}"].ownership-type-checkbox`);
      
      if (checkbox && checkbox.checked) {
        form.classList.remove('hidden');
      } else if (form) {
        form.classList.add('hidden');
      }
    }
    
    // 切换资产2权属证明表单显示
    function toggleOwnershipForm2(type) {
      const formId = 'ownership-form-' + type + '-2';
      const form = document.getElementById(formId);
      const checkbox = document.querySelector(`input[value="${type}"].ownership-type-checkbox-2`);
      
      if (checkbox && checkbox.checked) {
        if (form) {
          form.classList.remove('hidden');
        }
      } else if (form) {
        form.classList.add('hidden');
      }
    }
    
    // 条件上传控制函数
    function toggleConditionalUpload(uploadDivId, shouldShow) {
      const uploadDiv = document.getElementById(uploadDivId);
      if (uploadDiv) {
        if (shouldShow) {
          uploadDiv.classList.remove('hidden');
        } else {
          uploadDiv.classList.add('hidden');
          // 清空文件输入
          const fileInput = uploadDiv.querySelector('input[type="file"]');
          if (fileInput) {
            fileInput.value = '';
          }
        }
      }
    }
    
    // 获取项目数据
    function getProjectData() {
      // 从URL参数获取项目ID
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = urlParams.get('id') || 'project1';
      
      // 项目数据（这里可以根据实际需求从API获取）
      const projectData = {
        'project1': {
          name: '数据质量管理系统',
          type: '数据资产',
          assetType: '无形资产',
          manager: '张三',
          createTime: '2024-01-15',
          description: '构建企业级数据质量管理系统，提升数据治理能力，确保数据资产的质量和可靠性。',
          status: '资产已入库',
          stage: '验收完成'
        },
        'project2': {
          name: '移动端数据展示',
          type: '数据资产',
          assetType: '存货',
          manager: '李四',
          createTime: '2024-01-10',
          description: '开发移动端数据可视化应用，支持多维度数据展示和交互分析。',
          status: '项目已发起',
          stage: '立项阶段'
        }
      };
      
      return projectData[projectId] || projectData['project1'];
    }
    
    // 显示项目基本信息模态框
    function showProjectBasicInfo() {
      // 获取项目数据
      const projectData = getProjectData();
      
      // 更新模态框中的项目信息
      document.querySelector('#projectBasicInfoModal .grid .text-sm:first-child').textContent = projectData.name;
      document.getElementById('projectAssetType').textContent = projectData.assetType;
      
      // 显示模态框
      document.getElementById('projectBasicInfoModal').classList.remove('hidden');
    }
    
    // 关闭项目基本信息模态框
    function closeProjectBasicInfoModal() {
      document.getElementById('projectBasicInfoModal').classList.add('hidden');
    }
    
    // 点击项目基本信息模态框外部关闭
    document.getElementById('projectBasicInfoModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeProjectBasicInfoModal();
      }
    });

    // 显示财务汇总模态框
    function showFinancialSummary() {
      document.getElementById('financialModal').classList.remove('hidden');
    }
    
    // 关闭财务汇总模态框
    function closeFinancialModal() {
      document.getElementById('financialModal').classList.add('hidden');
    }
    
    // 点击模态框外部关闭
    document.getElementById('financialModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeFinancialModal();
      }
    });
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化示例数据
      initializeSampleData();
      
      // 初始化默认资产数据
      initializeDefaultAsset();
      
      // 默认显示研究环节及其第一个子页签（可行性研究环节）
      showTab('research-phase');
      showSubTab('research-phase', 'feasibility');
      
      // 恢复保存的费用数据
      restoreCosts();
      
      // 初始化费用计算
      
      // 初始化默认资产1数据到本地存储
      initializeDefaultAsset();
      
      // 自动加载验收环节的资产信息
      loadAssetsForAcceptance();
      calculateAllCosts();
      
      // 初始化验收环节费用数据
      initializeTestingCosts();
      
      // 初始化按资产合计
      calculateAssetTotals();
      
      // 渲染项目列表
      renderProjects();
      
      // 渲染资产列表
      renderAssets();
      
      // 添加键盘快捷键支持
      document.addEventListener('keydown', function(e) {
        // ESC键返回上一页
        if (e.key === 'Escape') {
          goBack();
        }
      });
    });
    
    // 初始化示例数据
    function initializeSampleData() {
      // 示例数据资源
      window.dataResources = [
        {
          id: 'dr_001',
          name: '用户基础信息表',
          description: '包含用户ID、姓名、联系方式等基础信息',
          type: 'master',
          source: 'database',
          volume: '2.5 GB',
          records: '1,250,000'
        },
        {
          id: 'dr_002',
          name: '订单交易记录',
          description: '记录所有订单的创建、支付、发货等状态',
          type: 'transaction',
          source: 'database',
          volume: '15.8 GB',
          records: '8,750,000'
        },
        {
          id: 'dr_003',
          name: '商品目录信息',
          description: '商品的基本信息、分类、价格等',
          type: 'master',
          source: 'database',
          volume: '1.2 GB',
          records: '450,000'
        },
        {
          id: 'dr_004',
          name: '用户行为日志',
          description: '用户浏览、搜索、点击等行为数据',
          type: 'analytics',
          source: 'file-upload',
          volume: '45.6 GB',
          records: '25,000,000'
        },
        {
          id: 'dr_005',
          name: '库存变动记录',
          description: '商品库存的入库、出库、盘点等记录',
          type: 'transaction',
          source: 'database',
          volume: '8.9 GB',
          records: '3,200,000'
        },
        {
          id: 'dr_006',
          name: '供应商信息表',
          description: '供应商的基本信息、资质、联系方式等',
          type: 'master',
          source: 'database',
          volume: '0.8 GB',
          records: '15,000'
        },
        {
          id: 'dr_007',
          name: '财务流水记录',
          description: '收入、支出、转账等财务交易记录',
          type: 'transaction',
          source: 'database',
          volume: '12.3 GB',
          records: '6,800,000'
        },
        {
          id: 'dr_008',
          name: '系统配置参数',
          description: '系统运行的各种配置参数和设置',
          type: 'reference',
          source: 'database',
          volume: '0.1 GB',
          records: '5,000'
        }
      ];
    }
    
    // 料工费管理相关函数
    
    // 添加费用行
    function addCostRow() {
      const tbody = document.getElementById('cost-tbody');
      const rows = tbody.querySelectorAll('.cost-row');
      const newRowNum = rows.length + 1;
      
      // 创建新的费用行
      const newRow = document.createElement('tr');
      newRow.className = 'cost-row';
      newRow.setAttribute('data-type', '其他费用');
      
      newRow.innerHTML = `
        <td class="px-3 py-2 text-sm font-medium text-gray-900">${newRowNum}</td>
        <td class="px-3 py-2 text-sm font-medium text-gray-900">
          <select class="cost-type w-full px-2 py-1 text-xs border border-gray-300 rounded" onchange="updateRowType(this)">
            <option>材料费用</option>
            <option>工时</option>
            <option>服务费</option>
            <option>其他费用</option>
          </select>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入费用名称" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
            <option>个</option>
            <option>套</option>
            <option>台</option>
            <option>件</option>
            <option>小时</option>
            <option>天</option>
            <option>次</option>
            <option>项</option>
          </select>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
        </td>
      `;
      
      tbody.appendChild(newRow);
      updateRowNumbers();
    }
    
    // 删除费用行
    function deleteRow(button) {
      const row = button.closest('.cost-row');
      if (row) {
        row.remove();
        updateRowNumbers();
        calculateAllCosts();
      }
    }
    
    // 更新行号
    function updateRowNumbers() {
      const rows = document.querySelectorAll('.cost-row');
      rows.forEach((row, index) => {
        const firstCell = row.querySelector('td:first-child');
        if (firstCell) {
          firstCell.textContent = index + 1;
        }
      });
    }
    
    // 更新行类型
    function updateRowType(select) {
      const row = select.closest('.cost-row');
      row.setAttribute('data-type', select.value);
    }
    
    // 计算单行费用
    function calculateRow(input) {
      const row = input.closest('.cost-row');
      const quantity = parseFloat(row.querySelector('.cost-quantity').value) || 0;
      const price = parseFloat(row.querySelector('.cost-price').value) || 0;
      const ratio = parseFloat(row.querySelector('.cost-ratio').value) || 0;
      
      // 计算小计
      const subtotal = quantity * price;
      row.querySelector('.cost-subtotal').value = subtotal.toFixed(2);
      
      // 计算分摊金额
      const allocated = subtotal * (ratio / 100);
      row.querySelector('.cost-allocated').value = allocated.toFixed(2);
      
      // 重新计算总计
      calculateAllCosts();
      
      // 自动保存费用数据
      autoSaveCosts();
    }
    
    // 计算所有费用
    function calculateAllCosts() {
      const rows = document.querySelectorAll('.cost-row');
      let materialTotal = 0;
      let laborTotal = 0;
      let serviceTotal = 0;
      let grandTotal = 0;
      
      rows.forEach(row => {
        const type = row.getAttribute('data-type');
        const subtotal = parseFloat(row.querySelector('.cost-subtotal').value) || 0;
        
        switch (type) {
          case '材料费用':
            materialTotal += subtotal;
            break;
          case '工时':
            laborTotal += subtotal;
            break;
          case '服务费':
            serviceTotal += subtotal;
            break;
          default:
            serviceTotal += subtotal; // 其他费用归类到服务费
            break;
        }
        
        grandTotal += subtotal;
      });
      
      // 更新显示
      document.getElementById('material-total').textContent = materialTotal.toFixed(2);
      document.getElementById('labor-total').textContent = laborTotal.toFixed(2);
      document.getElementById('service-total').textContent = serviceTotal.toFixed(2);
      document.getElementById('grand-total').textContent = grandTotal.toFixed(2);
    }
    
    // 计算验收环节总费用
    function calculateTestingGrandTotal() {
      const materialTotal = parseFloat(document.getElementById('testing-material-total').value) || 0;
      const laborTotal = parseFloat(document.getElementById('testing-labor-total').value) || 0;
      const serviceTotal = parseFloat(document.getElementById('testing-service-total').value) || 0;
      
      const grandTotal = materialTotal + laborTotal + serviceTotal;
      
      // 更新总费用显示
      document.getElementById('testing-grand-total').textContent = grandTotal.toFixed(2);
      
      // 保存到本地存储
      const testingCosts = {
        material: materialTotal,
        labor: laborTotal,
        service: serviceTotal,
        grand: grandTotal
      };
      localStorage.setItem('testingCosts', JSON.stringify(testingCosts));
    }
    
    // 初始化验收环节费用数据
    function initializeTestingCosts() {
      const savedCosts = JSON.parse(localStorage.getItem('testingCosts') || '{}');
      
      // 设置默认值或从本地存储加载
      document.getElementById('testing-material-total').value = savedCosts.material || 0.00;
      document.getElementById('testing-labor-total').value = savedCosts.labor || 0.00;
      document.getElementById('testing-service-total').value = savedCosts.service || 0.00;
      
      // 计算并显示总费用
      calculateTestingGrandTotal();
    }
    
    // 自动保存费用数据
    function autoSaveCosts() {
      const costs = [];
      const rows = document.querySelectorAll('.cost-row');
      
      rows.forEach(row => {
        const cost = {
          type: row.getAttribute('data-type'),
          name: row.querySelector('.cost-name').value,
          unit: row.querySelector('.cost-unit').value,
          quantity: parseFloat(row.querySelector('.cost-quantity').value) || 0,
          price: parseFloat(row.querySelector('.cost-price').value) || 0,
          subtotal: parseFloat(row.querySelector('.cost-subtotal').value) || 0,
          ratio: parseFloat(row.querySelector('.cost-ratio').value) || 0,
          allocated: parseFloat(row.querySelector('.cost-allocated').value) || 0,
          remark: row.querySelector('.cost-remark').value
        };
        costs.push(cost);
      });
      
      // 自动保存到localStorage（可扩展为保存到服务器）
      localStorage.setItem('projectCosts', JSON.stringify(costs));
      console.log('费用数据已自动保存:', costs);
    }
    
    // 恢复保存的费用数据
    function restoreCosts() {
      const savedCosts = localStorage.getItem('projectCosts');
      if (savedCosts) {
        try {
          const costs = JSON.parse(savedCosts);
          if (costs.length > 0) {
            // 清空现有行（保留默认的3行）
            const tbody = document.getElementById('cost-tbody');
            const defaultRows = tbody.querySelectorAll('.cost-row');
            
            // 如果保存的数据少于默认行数，只恢复保存的数据
            if (costs.length <= defaultRows.length) {
              costs.forEach((cost, index) => {
                if (defaultRows[index]) {
                  const row = defaultRows[index];
                  row.setAttribute('data-type', cost.type);
                  row.querySelector('.cost-name').value = cost.name;
                  row.querySelector('.cost-unit').value = cost.unit;
                  row.querySelector('.cost-quantity').value = cost.quantity;
                  row.querySelector('.cost-price').value = cost.price;
                  row.querySelector('.cost-subtotal').value = cost.subtotal;
                  row.querySelector('.cost-ratio').value = cost.ratio;
                  row.querySelector('.cost-allocated').value = cost.allocated;
                  row.querySelector('.cost-remark').value = cost.remark;
                }
              });
            } else {
              // 如果保存的数据多于默认行数，需要添加新行
              // 先清空所有行
              tbody.innerHTML = '';
              
              // 重新创建所有行
              costs.forEach((cost, index) => {
                if (index < 3) {
                  // 前3行使用默认样式
                  addDefaultCostRow(cost, index + 1);
                } else {
                  // 其他行使用动态添加的样式
                  addCostRowWithData(cost);
                }
              });
            }
            
            console.log('费用数据已恢复:', costs);
          }
        } catch (error) {
          console.error('恢复费用数据失败:', error);
        }
      }
    }
    
    // 添加默认费用行
    function addDefaultCostRow(cost, rowNum) {
      const tbody = document.getElementById('cost-tbody');
      const row = document.createElement('tr');
      row.className = 'cost-row';
      row.setAttribute('data-type', cost.type);
      
      // 根据费用类型设置背景色
      let bgColor = 'bg-blue-50';
      if (cost.type === '工时') bgColor = 'bg-green-50';
      if (cost.type === '服务费') bgColor = 'bg-yellow-50';
      
      row.className = `cost-row ${bgColor}`;
      
      row.innerHTML = `
        <td class="px-3 py-2 text-sm font-medium text-gray-900">${rowNum}</td>
        <td class="px-3 py-2 text-sm font-medium text-gray-900">${cost.type}</td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入费用名称" value="${cost.name}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
            <option value="个" ${cost.unit === '个' ? 'selected' : ''}>个</option>
            <option value="套" ${cost.unit === '套' ? 'selected' : ''}>套</option>
            <option value="台" ${cost.unit === '台' ? 'selected' : ''}>台</option>
            <option value="件" ${cost.unit === '件' ? 'selected' : ''}>件</option>
            <option value="小时" ${cost.unit === '小时' ? 'selected' : ''}>小时</option>
            <option value="天" ${cost.unit === '天' ? 'selected' : ''}>天</option>
            <option value="次" ${cost.unit === '次' ? 'selected' : ''}>次</option>
            <option value="项" ${cost.unit === '项' ? 'selected' : ''}>项</option>
          </select>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" value="${cost.quantity}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" value="${cost.price}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly value="${cost.subtotal}">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" value="${cost.ratio}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly value="${cost.allocated}">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息" value="${cost.remark}">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
        </td>
      `;
      
      tbody.appendChild(row);
    }
    
    // 添加带数据的费用行
    function addCostRowWithData(cost) {
      const tbody = document.getElementById('cost-tbody');
      const rows = tbody.querySelectorAll('.cost-row');
      const newRowNum = rows.length + 1;
      
      const newRow = document.createElement('tr');
      newRow.className = 'cost-row';
      newRow.setAttribute('data-type', cost.type);
      
      newRow.innerHTML = `
        <td class="px-3 py-2 text-sm font-medium text-gray-900">${newRowNum}</td>
        <td class="px-3 py-2 text-sm font-medium text-gray-900">
          <select class="cost-type w-full px-2 py-1 text-xs border border-gray-300 rounded" onchange="updateRowType(this)">
            <option value="材料费用" ${cost.type === '材料费用' ? 'selected' : ''}>材料费用</option>
            <option value="工时" ${cost.type === '工时' ? 'selected' : ''}>工时</option>
            <option value="服务费" ${cost.type === '服务费' ? 'selected' : ''}>服务费</option>
            <option value="其他费用" ${cost.type === '其他费用' ? 'selected' : ''}>其他费用</option>
          </select>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="text" class="cost-name w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="请输入费用名称" value="${cost.name}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <select class="cost-unit w-full px-2 py-1 text-xs border border-gray-300 rounded">
            <option value="个" ${cost.unit === '个' ? 'selected' : ''}>个</option>
            <option value="套" ${cost.unit === '套' ? 'selected' : ''}>套</option>
            <option value="台" ${cost.unit === '台' ? 'selected' : ''}>台</option>
            <option value="件" ${cost.unit === '件' ? 'selected' : ''}>件</option>
            <option value="小时" ${cost.unit === '小时' ? 'selected' : ''}>小时</option>
            <option value="天" ${cost.unit === '天' ? 'selected' : ''}>天</option>
            <option value="次" ${cost.unit === '次' ? 'selected' : ''}>次</option>
            <option value="项" ${cost.unit === '项' ? 'selected' : ''}>项</option>
          </select>
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-quantity w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" step="0.01" value="${cost.quantity}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-price w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0.00" min="0" step="0.01" value="${cost.price}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-subtotal w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly value="${cost.subtotal}">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-ratio w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="0" min="0" max="100" step="0.01" value="${cost.ratio}" onchange="calculateRow(this)">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="number" class="cost-allocated w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-100" placeholder="0.00" readonly value="${cost.allocated}">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <input type="text" class="cost-remark w-full px-2 py-1 text-xs border border-gray-300 rounded" placeholder="备注信息" value="${cost.remark}">
        </td>
        <td class="px-3 py-2 text-sm text-gray-700">
          <button type="button" class="delete-row px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600" onclick="deleteRow(this)">删除</button>
        </td>
      `;
      
      tbody.appendChild(newRow);
    }
    
    // 导出费用
    function exportCosts() {
      const costs = [];
      const rows = document.querySelectorAll('.cost-row');
      
      rows.forEach(row => {
        const cost = {
          type: row.getAttribute('data-type'),
          name: row.querySelector('.cost-name').value,
          unit: row.querySelector('.cost-unit').value,
          quantity: parseFloat(row.querySelector('.cost-quantity').value) || 0,
          price: parseFloat(row.querySelector('.cost-price').value) || 0,
          subtotal: parseFloat(row.querySelector('.cost-subtotal').value) || 0,
          ratio: parseFloat(row.querySelector('.cost-ratio').value) || 0,
          allocated: parseFloat(row.querySelector('.cost-allocated').value) || 0,
          remark: row.querySelector('.cost-remark').value
        };
        costs.push(cost);
      });
      
      // 创建CSV内容
      let csvContent = '费用类型,费用名称,单位,数量,单价(元),小计(元),分摊比例(%),分摊金额(元),备注\n';
      costs.forEach(cost => {
        csvContent += `${cost.type},${cost.name},${cost.unit},${cost.quantity},${cost.price},${cost.subtotal},${cost.ratio},${cost.allocated},${cost.remark}\n`;
      });
      
      // 下载CSV文件
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', '料工费明细.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // ==================== 数据资源挂载管理功能 ====================
    
    // 模拟数据资源数据
    const mockDataResources = [
      {
        id: 'dr001',
        name: '商城订单全生命周期分析',
        source: 'guoneng-ecommerce',
        type: 'structured',
        description: '展现商城订单全生命周期效率，洞察订单全流程运转情况、精准定位问题环节',
        fields: ['平均时长', '完成率', '及时率', '完成率标准值', '及时率标准值', '已完结订单数量', '占比', '超阈值单量', '平均发货时长', '发货时长最优值'],
        volume: '6,594 MB',
        records: '3,654,177',
        value: '¥1,250,000'
      },
      {
        id: 'dr002',
        name: '用户行为分析数据集',
        source: 'data-entry',
        type: 'structured',
        description: '分析用户在平台上的行为模式，包括浏览、搜索、购买等行为数据',
        fields: ['用户ID', '行为类型', '时间戳', '页面URL', '停留时长', '点击次数'],
        volume: '2,156 MB',
        records: '1,234,567',
        value: '¥850,000'
      },
      {
        id: 'dr003',
        name: '商品库存管理数据',
        source: 'database',
        type: 'structured',
        description: '实时监控商品库存状态，包括入库、出库、库存预警等信息',
        fields: ['商品ID', '商品名称', '当前库存', '安全库存', '入库时间', '出库时间'],
        volume: '1,234 MB',
        records: '567,890',
        value: '¥450,000'
      }
    ];
    
    // 页面加载时初始化数据资源
    document.addEventListener('DOMContentLoaded', function() {
      loadDataResources();
      loadSavedDatasets();
    });
    
    // 加载数据资源列表
    function loadDataResources() {
      const container = document.getElementById('data-resources-list');
      container.innerHTML = '';
      
      mockDataResources.forEach(resource => {
        const resourceItem = document.createElement('div');
        resourceItem.className = 'p-3 hover:bg-gray-50 cursor-pointer border-l-4 border-transparent hover:border-blue-500';
        resourceItem.setAttribute('data-resource-id', resource.id);
        
        resourceItem.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center space-x-2 mb-1">
                <span class="text-sm font-medium text-gray-900">${resource.name}</span>
                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">${resource.source === 'guoneng-ecommerce' ? '国能e购' : resource.source === 'data-entry' ? '数据填报' : resource.source === 'external-api' ? '外部API' : resource.source === 'database' ? '数据库' : '文件上传'}</span>
                <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded">${resource.type === 'structured' ? '结构化' : resource.type === 'semi-structured' ? '半结构化' : '非结构化'}</span>
              </div>
              <p class="text-xs text-gray-600 mb-2">${resource.description}</p>
              <div class="flex items-center space-x-4 text-xs text-gray-500">
                <span>数据量: ${resource.volume}</span>
                <span>记录数: ${resource.records}</span>
                <span class="text-red-600 font-medium">价值: ${resource.value}</span>
              </div>
            </div>
            <div class="ml-4">
              <button type="button" onclick="selectDataResource('${resource.id}')" class="px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600">
                选择
              </button>
            </div>
          </div>
        `;
        
        container.appendChild(resourceItem);
      });
    }
    
    // 刷新数据资源
    function refreshDataResources() {
      loadDataResources();
      showToast('数据资源已刷新');
    }
    
    // 选择数据资源
    function selectDataResource(resourceId) {
      const resource = mockDataResources.find(r => r.id === resourceId);
      if (resource) {
        showToast(`已选择数据资源: ${resource.name}`);
        // 这里可以添加选择逻辑，比如高亮显示或添加到已选择列表
      }
    }
    
    // 添加数据集
    function addDataset() {
      const container = document.getElementById('datasets-container');
      const datasetId = 'dataset_' + Date.now();
      
      const datasetHtml = `
        <div id="${datasetId}" class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <h5 class="text-sm font-medium text-gray-800">数据集 ${container.children.length + 1}</h5>
            <button type="button" onclick="removeDataset('${datasetId}')" class="px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">
              删除
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据集名称</label>
              <input type="text" class="dataset-name w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="请输入数据集名称" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据结构</label>
              <select class="dataset-structure w-full px-3 py-2 text-sm border border-gray-300 rounded-md" onchange="saveDatasetData()">
                <option value="">请选择数据结构</option>
                <option value="structured">结构化数据</option>
                <option value="semi-structured">半结构化数据</option>
                <option value="unstructured">非结构化数据</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据更新频率</label>
              <select class="dataset-frequency w-full px-3 py-2 text-sm border border-gray-300 rounded-md" onchange="saveDatasetData()">
                <option value="">请选择更新频率</option>
                <option value="real-time">实时</option>
                <option value="daily">日更</option>
                <option value="weekly">周更</option>
                <option value="monthly">月更</option>
                <option value="quarterly">季更</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">数据资源内容描述</label>
            <textarea class="dataset-description w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="3" placeholder="请描述该数据集的主要功能和价值" onchange="saveDatasetData()"></textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">主要字段</label>
            <div class="space-y-2">
              <div class="flex items-center space-x-2">
                <input type="text" class="field-input w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="请输入字段名称" onchange="saveDatasetData()">
                <button type="button" onclick="addField(this)" class="px-2 py-2 text-xs bg-green-500 text-white rounded hover:bg-green-600">
                  添加字段
                </button>
              </div>
              <div class="fields-container space-y-1">
                <!-- 字段标签将通过JavaScript动态生成 -->
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据规模</label>
              <input type="text" class="dataset-volume w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 6,594 MB" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据总条数</label>
              <input type="text" class="dataset-records w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 3,654,177" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">账面价值</label>
              <input type="text" class="dataset-value w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: ¥1,250,000" onchange="saveDatasetData()">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">所属业务部门</label>
              <input type="text" class="dataset-department w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 数据资产部" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据应用场景</label>
              <input type="text" class="dataset-scenario w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 物资采购应用场景下的商城业务" onchange="saveDatasetData()">
            </div>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', datasetHtml);
      saveDatasetData();
    }
    
    // 删除数据集
    function removeDataset(datasetId) {
      if (confirm('确定要删除这个数据集吗？')) {
        document.getElementById(datasetId).remove();
        saveDatasetData();
        showToast('数据集已删除');
      }
    }
    
    // 添加字段
    function addField(button) {
      const fieldInput = button.previousElementSibling;
      const fieldName = fieldInput.value.trim();
      
      if (fieldName) {
        const fieldsContainer = button.parentElement.nextElementSibling;
        const fieldTag = document.createElement('span');
        fieldTag.className = 'inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded mr-2 mb-1';
        fieldTag.innerHTML = `
          ${fieldName}
          <button type="button" onclick="removeField(this)" class="ml-1 text-blue-600 hover:text-blue-800">×</button>
        `;
        
        fieldsContainer.appendChild(fieldTag);
        fieldInput.value = '';
        saveDatasetData();
      }
    }
    
    // 删除字段
    function removeField(button) {
      button.parentElement.remove();
      saveDatasetData();
    }
    
    // 保存数据集数据
    function saveDatasetData() {
      const datasets = [];
      const containers = document.querySelectorAll('[id^="dataset_"]');
      
      containers.forEach(container => {
        const dataset = {
          name: container.querySelector('.dataset-name').value,
          source: container.querySelector('.dataset-source').value,
          structure: container.querySelector('.dataset-structure').value,
          frequency: container.querySelector('.dataset-frequency').value,
          description: container.querySelector('.dataset-description').value,
          volume: container.querySelector('.dataset-volume').value,
          records: container.querySelector('.dataset-records').value,
          value: container.querySelector('.dataset-value').value,
          department: container.querySelector('.dataset-department').value,
          scenario: container.querySelector('.dataset-scenario').value,
          fields: []
        };
        
        // 收集字段信息
        const fieldTags = container.querySelectorAll('.fields-container span');
        fieldTags.forEach(tag => {
          const fieldName = tag.textContent.replace('×', '').trim();
          dataset.fields.push(fieldName);
        });
        
        datasets.push(dataset);
      });
      
      localStorage.setItem('projectDatasets', JSON.stringify(datasets));
      console.log('数据集数据已保存:', datasets);
    }
    
    // 加载保存的数据集
    function loadSavedDatasets() {
      const savedDatasets = localStorage.getItem('projectDatasets');
      if (savedDatasets) {
        try {
          const datasets = JSON.parse(savedDatasets);
          datasets.forEach(dataset => {
            addDatasetWithData(dataset);
          });
        } catch (error) {
          console.error('加载数据集数据失败:', error);
        }
      }
    }
    
    // 添加带数据的数据集
    function addDatasetWithData(dataset) {
      const container = document.getElementById('datasets-container');
      const datasetId = 'dataset_' + Date.now();
      
      const datasetHtml = `
        <div id="${datasetId}" class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <h5 class="text-sm font-medium text-gray-800">数据集 ${container.children.length + 1}</h5>
            <button type="button" onclick="removeDataset('${datasetId}')" class="px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">
              删除
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据集名称</label>
              <input type="text" class="dataset-name w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="请输入数据集名称" value="${dataset.name || ''}" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据来源</label>
              <select class="dataset-source w-full px-3 py-2 text-sm border border-gray-300 rounded-md" onchange="saveDatasetData()">
                <option value="">请选择数据来源</option>
                <option value="guoneng-ecommerce" ${dataset.source === 'guoneng-ecommerce' ? 'selected' : ''}>国能e购</option>
                <option value="data-entry" ${dataset.source === 'data-entry' ? 'selected' : ''}>数据填报</option>
                <option value="external-api" ${dataset.source === 'external-api' ? 'selected' : ''}>外部API</option>
                <option value="database" ${dataset.source === 'database' ? 'selected' : ''}>数据库</option>
                <option value="file-upload" ${dataset.source === 'file-upload' ? 'selected' : ''}>文件上传</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据结构</label>
              <select class="dataset-structure w-full px-3 py-2 text-sm border border-gray-300 rounded-md" onchange="saveDatasetData()">
                <option value="">请选择数据结构</option>
                <option value="structured" ${dataset.structure === 'structured' ? 'selected' : ''}>结构化数据</option>
                <option value="semi-structured" ${dataset.structure === 'semi-structured' ? 'selected' : ''}>半结构化数据</option>
                <option value="unstructured" ${dataset.structure === 'unstructured' ? 'selected' : ''}>非结构化数据</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据更新频率</label>
              <select class="dataset-frequency w-full px-3 py-2 text-sm border border-gray-300 rounded-md" onchange="saveDatasetData()">
                <option value="">请选择更新频率</option>
                <option value="real-time" ${dataset.frequency === 'real-time' ? 'selected' : ''}>实时</option>
                <option value="daily" ${dataset.frequency === 'daily' ? 'selected' : ''}>日更</option>
                <option value="weekly" ${dataset.frequency === 'weekly' ? 'selected' : ''}>周更</option>
                <option value="monthly" ${dataset.frequency === 'monthly' ? 'selected' : ''}>月更</option>
                <option value="quarterly" ${dataset.frequency === 'quarterly' ? 'selected' : ''}>季更</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">数据资源内容描述</label>
            <textarea class="dataset-description w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="3" placeholder="请描述该数据集的主要功能和价值" onchange="saveDatasetData()">${dataset.description || ''}</textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">主要字段</label>
            <div class="space-y-2">
              <div class="flex items-center space-x-2">
                <input type="text" class="field-input w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="请输入字段名称" onchange="saveDatasetData()">
                <button type="button" onclick="addField(this)" class="px-2 py-2 text-xs bg-green-500 text-white rounded hover:bg-green-600">
                  添加字段
                </button>
              </div>
              <div class="fields-container space-y-1">
                ${(dataset.fields || []).map(field => `
                  <span class="inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded mr-2 mb-1">
                    ${field}
                    <button type="button" onclick="removeField(this)" class="ml-1 text-blue-600 hover:text-blue-800">×</button>
                  </span>
                `).join('')}
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据规模</label>
              <input type="text" class="dataset-volume w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 6,594 MB" value="${dataset.volume || ''}" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据总条数</label>
              <input type="text" class="dataset-records w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 3,654,177" value="${dataset.records || ''}" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">账面价值</label>
              <input type="text" class="dataset-value w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: ¥1,250,000" value="${dataset.value || ''}" onchange="saveDatasetData()">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">所属业务部门</label>
              <input type="text" class="dataset-department w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 数据资产部" value="${dataset.department || ''}" onchange="saveDatasetData()">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据应用场景</label>
              <input type="text" class="dataset-scenario w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如: 物资采购应用场景下的商城业务" value="${dataset.scenario || ''}" onchange="saveDatasetData()">
            </div>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', datasetHtml);
    }
    
    // 挂载资产到项目
    function mountAssetToProject(assetId) {
      const asset = assets.find(a => a.id === assetId);
      if (!asset) return;
      
      // 显示挂载对话框
      const dialog = document.createElement('div');
      dialog.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      dialog.innerHTML = `
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
          <div class="flex items-center justify-between p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">挂载资产: ${asset.name}</h3>
            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <div class="p-6">
            <div class="mb-6">
              <h4 class="text-md font-medium text-gray-700 mb-3">数据集列表</h4>
              <div id="datasets-container" class="space-y-4">
                <!-- 数据集将在这里动态添加 -->
              </div>
              <button onclick="addNewDataset()" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                + 新建数据集
              </button>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4 border-t">
              <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                取消
              </button>
              <button onclick="confirmMountAsset()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
                确认挂载
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(dialog);
      
      // 初始化第一个数据集
      addNewDataset();
    }
    
    // 添加新数据集
    function addNewDataset() {
      const container = document.getElementById('datasets-container');
      const datasetId = 'dataset_' + Date.now();
      
      const datasetHtml = `
        <div class="dataset-item border border-gray-200 rounded-lg p-4" data-dataset-id="${datasetId}">
          <div class="flex items-center justify-between mb-4">
            <h5 class="text-sm font-medium text-gray-700">数据集 ${container.children.length + 1}</h5>
            <button onclick="removeDataset(this)" class="text-red-500 hover:text-red-700 text-sm">
              删除数据集
            </button>
          </div>
          
          <!-- 基本信息 -->
          <div class="mb-6">
            <h6 class="text-sm font-medium text-gray-700 mb-3 pb-2 border-b">基本信息</h6>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据资源名称 *</label>
                <input type="text" class="dataset-name w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="请输入数据资源名称">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">细分数据集</label>
                <input type="text" class="dataset-sub-name w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如：NBI03-商城订单全生命周期分析">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据集类型 *</label>
                <select class="dataset-type w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择类型</option>
                  <option value="transaction">交易数据</option>
                  <option value="master">主数据</option>
                  <option value="reference">参考数据</option>
                  <option value="analytics">分析数据</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">持有目的</label>
                <select class="dataset-purpose w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择持有目的</option>
                  <option value="self-use">自用</option>
                  <option value="external-service">对外服务</option>
                  <option value="both">自用+对外服务</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- 技术属性 -->
          <div class="mb-6">
            <h6 class="text-sm font-medium text-gray-700 mb-3 pb-2 border-b">技术属性</h6>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据库类型</label>
                <select class="database-type w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择数据库类型</option>
                  <option value="rds">RDS</option>
                  <option value="mysql">MySQL</option>
                  <option value="oracle">Oracle</option>
                  <option value="sqlserver">SQL Server</option>
                  <option value="postgresql">PostgreSQL</option>
                  <option value="mongodb">MongoDB</option>
                  <option value="redis">Redis</option>
                  <option value="other">其他</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据结构</label>
                <select class="data-structure w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择数据结构</option>
                  <option value="structured">结构化数据</option>
                  <option value="semi-structured">半结构化数据</option>
                  <option value="unstructured">非结构化数据</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据存储方式</label>
                <select class="storage-method w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择存储方式</option>
                  <option value="alibaba-cloud">阿里云</option>
                  <option value="tencent-cloud">腾讯云</option>
                  <option value="huawei-cloud">华为云</option>
                  <option value="aws">AWS</option>
                  <option value="azure">Azure</option>
                  <option value="on-premise">本地部署</option>
                  <option value="hybrid">混合云</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据规模 (MB)</label>
                <input type="number" class="data-scale w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如：6594">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据总条数</label>
                <input type="number" class="total-records w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如：3654177">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据更新频率</label>
                <select class="update-frequency w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择更新频率</option>
                  <option value="real-time">实时</option>
                  <option value="hourly">每小时</option>
                  <option value="daily">每日</option>
                  <option value="weekly">每周</option>
                  <option value="monthly">每月</option>
                  <option value="quarterly">每季度</option>
                  <option value="yearly">每年</option>
                  <option value="on-demand">按需</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- 业务属性 -->
          <div class="mb-6">
            <h6 class="text-sm font-medium text-gray-700 mb-3 pb-2 border-b">业务属性</h6>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据来源</label>
                <select class="data-source w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择数据来源</option>
                  <option value="guoneng-ecommerce">国能e购</option>
                  <option value="data-entry">数据填报</option>
                  <option value="external-api">外部API</option>
                  <option value="database">数据库</option>
                  <option value="file-upload">文件上传</option>
                  <option value="multiple">多来源</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据加工性质</label>
                <select class="processing-nature w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择加工性质</option>
                  <option value="raw">原始数据</option>
                  <option value="processed">加工数据</option>
                  <option value="aggregated">聚合数据</option>
                  <option value="derived">衍生数据</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据业务归属</label>
                <select class="business-affiliation w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择业务归属</option>
                  <option value="data-tech">数据科技</option>
                  <option value="it">信息技术</option>
                  <option value="business">业务部门</option>
                  <option value="finance">财务部门</option>
                  <option value="hr">人力资源</option>
                  <option value="operations">运营部门</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">所属业务部门</label>
                <select class="business-department w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择业务部门</option>
                  <option value="data-asset">数据资产部</option>
                  <option value="it-dept">信息技术部</option>
                  <option value="business-dept">业务发展部</option>
                  <option value="finance-dept">财务部</option>
                  <option value="hr-dept">人力资源部</option>
                  <option value="operations-dept">运营部</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据所属行业</label>
                <select class="data-industry w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择所属行业</option>
                  <option value="energy">能源行业</option>
                  <option value="finance">金融行业</option>
                  <option value="manufacturing">制造业</option>
                  <option value="retail">零售业</option>
                  <option value="healthcare">医疗健康</option>
                  <option value="education">教育行业</option>
                  <option value="logistics">物流运输</option>
                  <option value="other">其他行业</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">权属信息</label>
                <select class="ownership-info w-full px-3 py-2 text-sm border border-gray-300 rounded-md">
                  <option value="">请选择权属信息</option>
                  <option value="owned">自有</option>
                  <option value="licensed">授权使用</option>
                  <option value="purchased">购买</option>
                  <option value="shared">共享</option>
                  <option value="third-party">第三方</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- 详细描述 -->
          <div class="mb-6">
            <h6 class="text-sm font-medium text-gray-700 mb-3 pb-2 border-b">详细描述</h6>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据资源内容 *</label>
                <textarea class="dataset-content w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="3" placeholder="请详细描述数据资源的内容、用途和价值，如：展现商城订单全生命周期效率,洞察订单全流程运转情况、精准定位问题环节等"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据应用场景</label>
                <textarea class="application-scenario w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="2" placeholder="请描述数据的具体应用场景，如：物资采购应用场景下的商城业务"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">主要字段</label>
                <textarea class="main-fields w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="2" placeholder="请列出数据的主要字段，如：平均时长、完成率、及时率、已完结订单数量等"></textarea>
              </div>
            </div>
          </div>
          
          <!-- 价值信息 -->
          <div class="mb-6">
            <h6 class="text-sm font-medium text-gray-700 mb-3 pb-2 border-b">价值信息</h6>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">账面价值 (元)</label>
                <input type="number" class="book-value w-full px-3 py-2 text-sm border border-gray-300 rounded-md" placeholder="如：1250000">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">数据集描述</label>
                <textarea class="dataset-description w-full px-3 py-2 text-sm border border-gray-300 rounded-md" rows="2" placeholder="请简要描述该数据集的主要内容和用途"></textarea>
              </div>
            </div>
          </div>
          
          <!-- 数据资源选择 -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">选择数据资源</label>
            <div class="data-resources-container border border-gray-200 rounded-md p-3 min-h-[100px]">
              <div class="text-sm text-gray-500 mb-2">已选择的数据资源：</div>
              <div class="selected-resources space-y-2">
                <!-- 已选择的数据资源将在这里显示 -->
              </div>
              <button onclick="selectDataResources(this)" class="mt-2 px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600">
                选择数据资源
              </button>
            </div>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', datasetHtml);
    }
    
    // 删除数据集
    function removeDataset(button) {
      const datasetItem = button.closest('.dataset-item');
      datasetItem.remove();
      
      // 重新编号数据集
      const datasets = document.querySelectorAll('.dataset-item');
      datasets.forEach((dataset, index) => {
        const title = dataset.querySelector('h5');
        title.textContent = `数据集 ${index + 1}`;
      });
    }
    
    // 选择数据资源
    function selectDataResources(button) {
      const datasetItem = button.closest('.dataset-item');
      const selectedResourcesContainer = datasetItem.querySelector('.selected-resources');
      
      // 显示数据资源选择对话框
      const modal = document.getElementById('resource-selection-modal');
      const resourcesList = document.getElementById('resources-list');
      
      // 生成数据资源列表
      resourcesList.innerHTML = dataResources.map(resource => `
        <div class="flex items-center space-x-3 p-3 border border-gray-200 rounded-md hover:bg-gray-50">
          <input type="checkbox" id="resource_${resource.id}" value="${resource.id}" class="resource-checkbox">
          <div class="flex-1">
            <div class="font-medium text-sm">${resource.name}</div>
            <div class="text-xs text-gray-500">${resource.description}</div>
            <div class="text-xs text-gray-400 mt-1">
              <span class="mr-3">类型: ${getResourceTypeName(resource.type)}</span>
              <span class="mr-3">来源: ${getResourceSourceName(resource.source)}</span>
              <span>容量: ${resource.volume}</span>
            </div>
          </div>
        </div>
      `).join('');
      
      // 设置当前选中的数据集ID
      modal.dataset.currentDatasetId = datasetItem.dataset.datasetId;
      
      // 显示对话框
      modal.classList.remove('hidden');
      
      // 搜索功能
      const searchInput = document.getElementById('resource-search');
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const checkboxes = modal.querySelectorAll('.resource-checkbox');
        checkboxes.forEach(checkbox => {
          const resourceItem = checkbox.closest('.border');
          const resourceName = resourceItem.querySelector('.font-medium').textContent.toLowerCase();
          const resourceDesc = resourceItem.querySelector('.text-xs').textContent.toLowerCase();
          
          if (resourceName.includes(searchTerm) || resourceDesc.includes(searchTerm)) {
            resourceItem.style.display = 'block';
          } else {
            resourceItem.style.display = 'none';
          }
        });
      });
    }
    
    
    
    
    // 获取资源类型名称
    function getResourceTypeName(type) {
      const typeNames = {
        'master': '主数据',
        'transaction': '交易数据',
        'reference': '参考数据',
        'analytics': '分析数据'
      };
      return typeNames[type] || type;
    }
    
    // 获取资源来源名称
    function getResourceSourceName(source) {
      const sourceNames = {
        'database': '数据库',
        'file-upload': '文件上传',
        'external-api': '外部API',
        'data-entry': '数据填报'
      };
      return sourceNames[source] || source;
    }
    
    // 确认挂载资产
    function confirmMountAsset() {
      const datasets = document.querySelectorAll('.dataset-item');
      const mountData = [];
      
      datasets.forEach(dataset => {
        const name = dataset.querySelector('.dataset-name').value;
        const type = dataset.querySelector('.dataset-type').value;
        const description = dataset.querySelector('.dataset-description').value;
        const selectedResources = Array.from(dataset.querySelectorAll('.selected-resources .bg-blue-50')).map(resource => {
          const resourceName = resource.querySelector('.font-medium').textContent;
          return dataResources.find(r => r.name === resourceName);
        }).filter(Boolean);
        
        if (name && type && selectedResources.length > 0) {
          mountData.push({
            name,
            type,
            description,
            resources: selectedResources
          });
        }
      });
      
      if (mountData.length === 0) {
        showToast('请至少创建一个有效的数据集');
        return;
      }
      
      // 这里可以添加实际的挂载逻辑
      console.log('挂载数据:', mountData);
      showToast('资产挂载成功！');
      
      // 关闭对话框
      document.querySelector('.fixed').remove();
    }
    
    // 验证数据集信息
    function validateDataset(datasetItem) {
      const requiredFields = [
        { selector: '.dataset-name', name: '数据资源名称' },
        { selector: '.dataset-type', name: '数据集类型' },
        { selector: '.dataset-content', name: '数据资源内容' }
      ];
      
      const errors = [];
      
      requiredFields.forEach(field => {
        const element = datasetItem.querySelector(field.selector);
        if (!element || !element.value.trim()) {
          errors.push(`${field.name}为必填项`);
        }
      });
      
      // 检查是否选择了数据资源
      const selectedResources = datasetItem.querySelectorAll('.selected-resources .bg-blue-50');
      if (selectedResources.length === 0) {
        errors.push('请至少选择一个数据资源');
      }
      
      return errors;
    }
    
    // 收集数据集完整信息
    function collectDatasetInfo(datasetItem) {
      return {
        name: datasetItem.querySelector('.dataset-name')?.value || '',
        subName: datasetItem.querySelector('.dataset-sub-name')?.value || '',
        type: datasetItem.querySelector('.dataset-type')?.value || '',
        purpose: datasetItem.querySelector('.dataset-purpose')?.value || '',
        databaseType: datasetItem.querySelector('.database-type')?.value || '',
        dataStructure: datasetItem.querySelector('.data-structure')?.value || '',
        storageMethod: datasetItem.querySelector('.storage-method')?.value || '',
        dataScale: datasetItem.querySelector('.data-scale')?.value || '',
        totalRecords: datasetItem.querySelector('.total-records')?.value || '',
        updateFrequency: datasetItem.querySelector('.update-frequency')?.value || '',
        dataSource: datasetItem.querySelector('.data-source')?.value || '',
        processingNature: datasetItem.querySelector('.processing-nature')?.value || '',
        businessAffiliation: datasetItem.querySelector('.business-affiliation')?.value || '',
        businessDepartment: datasetItem.querySelector('.business-department')?.value || '',
        dataIndustry: datasetItem.querySelector('.data-industry')?.value || '',
        ownershipInfo: datasetItem.querySelector('.ownership-info')?.value || '',
        content: datasetItem.querySelector('.dataset-content')?.value || '',
        applicationScenario: datasetItem.querySelector('.application-scenario')?.value || '',
        mainFields: datasetItem.querySelector('.main-fields')?.value || '',
        bookValue: datasetItem.querySelector('.book-value')?.value || '',
        description: datasetItem.querySelector('.dataset-description')?.value || '',
        resources: Array.from(datasetItem.querySelectorAll('.selected-resources .bg-blue-50')).map(resource => {
          const resourceName = resource.querySelector('.font-medium').textContent;
          return dataResources.find(r => r.name === resourceName);
        }).filter(Boolean)
      };
    }
    
    // 资产标签、属性和目录选择相关功能
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化目录选择联动
      initDirectorySelection();
      
      // 绑定标签和属性选择事件
      bindAssetSelectionEvents();
    });

    // 初始化目录选择联动
    function initDirectorySelection() {
      // 使用更准确的选择器来定位select元素
      const level1Select = document.getElementById('level1-select');
      const level2Select = document.getElementById('level2-select');
      
      if (level1Select && level2Select) {
        // 一级目录变化时，更新二级目录选项
        level1Select.addEventListener('change', function() {
          updateLevel2Options(this.value);
          level2Select.value = '';
        });
        
        // 二级目录变化时，更新路径显示
        level2Select.addEventListener('change', function() {
          updateDirectoryPath();
        });
      }
    }

    // 更新二级目录选项
    function updateLevel2Options(level1Value) {
      const level2Select = document.getElementById('level2-select');
      if (!level2Select) return;
      
      const options = {
        'business': [
          { value: 'internal', text: '内部数据' },
          { value: 'external', text: '外部数据' },
          { value: 'marketing', text: '营销数据' },
          { value: 'sales', text: '销售数据' },
          { value: 'operations', text: '运营数据' }
        ],
        'system': [
          { value: 'analytics', text: '分析数据' },
          { value: 'monitoring', text: '监控数据' },
          { value: 'logs', text: '日志数据' },
          { value: 'performance', text: '性能数据' }
        ],
        'external': [
          { value: 'third-party', text: '第三方数据' },
          { value: 'public', text: '公开数据' },
          { value: 'partner', text: '合作伙伴数据' },
          { value: 'market', text: '市场数据' }
        ],
        'personal': [
          { value: 'user-profile', text: '用户画像' },
          { value: 'user-behavior', text: '用户行为' },
          { value: 'user-preference', text: '用户偏好' }
        ]
      };
      
      level2Select.innerHTML = '<option value="">请选择二级目录</option>';
      if (options[level1Value]) {
        options[level1Value].forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option.value;
          optionElement.textContent = option.text;
          level2Select.appendChild(optionElement);
        });
      }
    }



    // 更新目录路径显示
    function updateDirectoryPath() {
      const level1Select = document.getElementById('level1-select');
      const level2Select = document.getElementById('level2-select');
      
      if (!level1Select || !level2Select) return;
      
      const level1Text = level1Select.options[level1Select.selectedIndex]?.text || '';
      const level2Text = level2Select.options[level2Select.selectedIndex]?.text || '';
      
      const pathElement = document.getElementById('directory-path');
      if (pathElement) {
        if (level1Text && level2Text) {
          pathElement.textContent = `${level1Text} > ${level2Text}`;
        } else if (level1Text) {
          pathElement.textContent = level1Text;
        } else {
          pathElement.textContent = '未选择';
        }
      }
    }

    // 绑定资产选择事件
    function bindAssetSelectionEvents() {
      // 绑定重置选择按钮
      const resetButton = document.querySelector('#asset-formation-tab button:contains("重置选择")');
      if (resetButton) {
        resetButton.addEventListener('click', resetAssetSelection);
      }
      
      // 绑定保存配置按钮
      const saveButton = document.querySelector('#asset-formation-tab button:contains("保存配置")');
      if (saveButton) {
        saveButton.addEventListener('click', saveAssetConfiguration);
      }
      
      // 如果上面的选择器不工作，使用更通用的方法
      setTimeout(() => {
        const buttons = document.querySelectorAll('#asset-formation-tab button');
        buttons.forEach(button => {
          if (button.textContent.includes('重置选择')) {
            button.addEventListener('click', resetAssetSelection);
          } else if (button.textContent.includes('保存配置')) {
            button.addEventListener('click', saveAssetConfiguration);
          }
        });
      }, 100);
    }

    // 重置资产选择
    function resetAssetSelection() {
      // 重置标签选择
      document.querySelectorAll('#asset-formation-tab input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // 重置目录选择
      const level1Select = document.getElementById('level1-select');
      const level2Select = document.getElementById('level2-select');
      
      if (level1Select) level1Select.value = '';
      if (level2Select) level2Select.value = '';
      
      // 更新路径显示
      updateDirectoryPath();
      
      showToast('选择已重置');
    }

    // 保存资产配置
    function saveAssetConfiguration() {
      // 收集选中的标签
      const selectedTags = [];
      document.querySelectorAll('#asset-formation-tab input[type="checkbox"]:checked').forEach(checkbox => {
        selectedTags.push(checkbox.nextElementSibling.textContent);
      });
      
      // 收集目录选择
      const level1Select = document.getElementById('level1-select');
      const level2Select = document.getElementById('level2-select');
      
      if (!level1Select || !level2Select) return;
      
      const directorySelection = {
        level1: level1Select.value || '',
        level2: level2Select.value || ''
      };
      
      // 验证必填项
      if (selectedTags.length === 0) {
        showToast('请至少选择一个资产标签', 'error');
        return;
      }
      
      if (!directorySelection.level1 || !directorySelection.level2) {
        showToast('请完整选择所属目录', 'error');
        return;
      }
      
      // 保存配置到本地存储
      const assetConfig = {
        tags: selectedTags,
        directory: directorySelection,
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('assetConfiguration', JSON.stringify(assetConfig));
      
      showToast('资产配置保存成功！');
      
      // 这里可以添加实际的保存逻辑
      console.log('资产配置:', assetConfig);
    }

    // 保存数据集信息
    function saveDatasetInfo() {
      const datasets = document.querySelectorAll('.dataset-item');
      const allDatasets = [];
      const allErrors = [];
      
      datasets.forEach((dataset, index) => {
        const errors = validateDataset(dataset);
        if (errors.length > 0) {
          allErrors.push(`数据集 ${index + 1}: ${errors.join(', ')}`);
        } else {
          const datasetInfo = collectDatasetInfo(dataset);
          allDatasets.push(datasetInfo);
        }
      });
      
      if (allErrors.length > 0) {
        showToast('请完善以下信息：' + allErrors.join('; '), 'error');
        return false;
      }
      
      if (allDatasets.length === 0) {
        showToast('请至少创建一个有效的数据集', 'error');
        return false;
      }
      
      // 保存到本地存储
      localStorage.setItem('projectDatasets', JSON.stringify(allDatasets));
      
      showToast('数据集信息保存成功！');
      return true;
    }

    // 资产管理函数
    // assetCounter 已在上面定义，这里不再重复声明
    
    function addNewAsset() {
      const container = document.getElementById('assets-container');
      const assetId = 'asset_' + Date.now();
      assetCounter++;
      
      const assetHtml = `
        <div class="asset-item border border-gray-200 rounded-lg p-4" data-asset-id="${assetId}">
          <div class="flex items-center justify-between mb-4">
            <h5 class="text-sm font-medium text-gray-700">资产 ${assetCounter}</h5>
            <button onclick="removeAsset(this)" class="text-red-500 hover:text-red-700 text-sm">
              删除资产
            </button>
          </div>
          
          <!-- 基本信息表单 -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- 资产名称 -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-1">资产名称 *</label>
              <input type="text" class="asset-name w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入数据资产名称" required>
            </div>
            
            <!-- 持有目的 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">持有目的 *</label>
              <select class="holding-purpose w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">请选择持有目的</option>
                <option value="自用">自用</option>
                <option value="对外服务">对外服务</option>
                <option value="自用+对外服务">自用+对外服务</option>
                <option value="出售">出售</option>
              </select>
            </div>
            
            <!-- 所属部门 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">所属部门 *</label>
              <select class="department w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">请选择所属部门</option>
                <option value="信息技术部">信息技术部</option>
                <option value="数据管理部">数据管理部</option>
                <option value="业务发展部">业务发展部</option>
                <option value="风险管理部">风险管理部</option>
                <option value="客户服务部">客户服务部</option>
                <option value="产品研发部">产品研发部</option>
                <option value="合规管理部">合规管理部</option>
                <option value="其他">其他</option>
              </select>
            </div>
            
            <!-- 业务归属 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">业务归属 *</label>
              <select class="business-ownership w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">请选择业务归属</option>
                <option value="零售业务">零售业务</option>
                <option value="公司业务">公司业务</option>
                <option value="投资银行业务">投资银行业务</option>
                <option value="资产管理业务">资产管理业务</option>
                <option value="金融市场业务">金融市场业务</option>
                <option value="风险管理">风险管理</option>
                <option value="运营管理">运营管理</option>
                <option value="其他">其他</option>
              </select>
            </div>
            
            <!-- 所属行业 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">所属行业 *</label>
              <select class="industry w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="">请选择所属行业</option>
                <option value="银行业">银行业</option>
                <option value="保险业">保险业</option>
                <option value="证券业">证券业</option>
                <option value="基金业">基金业</option>
                <option value="信托业">信托业</option>
                <option value="租赁业">租赁业</option>
                <option value="金融科技">金融科技</option>
                <option value="其他">其他</option>
              </select>
            </div>
            
            <!-- 详细描述 -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-1">详细描述 *</label>
              <textarea class="description w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="请详细描述数据资产的内容、用途、价值、数据来源等信息" required></textarea>
            </div>
          </div>
          
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', assetHtml);
    }
    
    function removeAsset(button) {
      const assetItem = button.closest('.asset-item');
      assetItem.remove();
      
      // 重新编号剩余的资产
      const remainingAssets = document.querySelectorAll('.asset-item');
      remainingAssets.forEach((asset, index) => {
        const titleElement = asset.querySelector('h5');
        if (titleElement) {
          titleElement.textContent = `资产 ${index + 1}`;
        }
      });
      
      assetCounter = remainingAssets.length;
      
      // 如果删除了所有资产，重置计数器
      if (remainingAssets.length === 0) {
        assetCounter = 0;
      }
    }
    
    function saveAssets() {
      const assets = [];
      const assetItems = document.querySelectorAll('.asset-item');
      
      assetItems.forEach((item, index) => {
        const asset = {
          id: item.dataset.assetId,
          name: item.querySelector('.asset-name')?.value || '',
          holdingPurpose: item.querySelector('.holding-purpose')?.value || '',
          department: item.querySelector('.department')?.value || '',
          businessOwnership: item.querySelector('.business-ownership')?.value || '',
          industry: item.querySelector('.industry')?.value || '',
          totalCount: item.querySelector('.total-count')?.value || '',
          dataSize: item.querySelector('.data-size')?.value || '',
          updateFrequency: item.querySelector('.update-frequency')?.value || '',
          description: item.querySelector('.description')?.value || ''
        };
        
        // 验证必填字段
        if (!asset.name || !asset.holdingPurpose || !asset.department || 
            !asset.businessOwnership || !asset.industry || !asset.totalCount || 
            !asset.dataSize || !asset.updateFrequency || !asset.description) {
          showToast('请填写所有必填字段', 'error');
          return false;
        }
        
        assets.push(asset);
      });
      
      if (assets.length === 0) {
        showToast('请至少添加一个资产', 'error');
        return false;
      }
      
      // 保存到本地存储
      localStorage.setItem('projectAssets', JSON.stringify(assets));
      showToast('资产信息保存成功！');
      return true;
    }

    // 获取项目资产类型
    function getProjectAssetType() {
      const projectData = getProjectData();
      return projectData.assetType || '无形资产';
    }
    
    // 验收环节资产管理函数
    function loadAssetsForAcceptance() {
      const container = document.getElementById('acceptance-assets-container');
      const savedAssets = JSON.parse(localStorage.getItem('projectAssets') || '[]');
      
      if (savedAssets.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-info-circle text-4xl mb-4"></i>
            <p>暂无资产信息，请先在立项环节添加资产。</p>
          </div>
        `;
        return;
      }
      
      let assetsHtml = '';
      savedAssets.forEach((asset, index) => {
        assetsHtml += `
          <div class="acceptance-asset-item border border-gray-200 rounded-lg p-4" data-asset-id="${asset.id}">
            <div class="flex items-center justify-between mb-4">
              <h5 class="text-sm font-medium text-gray-700">资产 ${index + 1}</h5>
            </div>
            
            <!-- 资产信息展示/编辑 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- 资产名称 -->
              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">资产名称</label>
                <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.name}</div>
              </div>
              
              <!-- 资产类型确认 -->
              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">资产类型确认 *</label>
                <select class="asset-type-confirmation w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" data-asset-id="${asset.id}">
                  <option value="">请选择资产类型</option>
                  <option value="存货" ${(asset.assetType || getProjectAssetType()) === '存货' ? 'selected' : ''}>存货</option>
                  <option value="无形资产" ${(asset.assetType || getProjectAssetType()) === '无形资产' ? 'selected' : ''}>无形资产</option>
                </select>
                <div class="text-xs text-gray-500 mt-1">默认与项目基本信息一致，可根据需要调整</div>
              </div>
              
              <!-- 持有目的、所属部门、业务归属、所属行业 -->
              <div class="col-span-2">
                <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">持有目的</label>
                  <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.holdingPurpose}</div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">所属部门</label>
                  <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.department}</div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">业务归属</label>
                  <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.businessOwnership}</div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">所属行业</label>
                  <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.industry}</div>
                </div>
              </div>

              <!-- 总条数、数据规模、更新频率、存储方式 -->
              <div class="col-span-2">
                <div class="grid grid-cols-4 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">总条数</label>
                    <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.totalCount}</div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">数据规模</label>
                    <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.dataSize}</div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">更新频率</label>
                    <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.updateFrequency || '未设置'}</div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">存储方式</label>
                    <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900">${asset.storageType || '关系型数据库'}</div>
                  </div>
                </div>
              </div>
              
              <!-- 详细描述 -->
              <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">详细描述</label>
                <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900 min-h-[100px] whitespace-pre-wrap">${asset.description}</div>
              </div>
            </div>
            
            <!-- 资产基础信息配置 -->
            <div class="col-span-2">
              <div class="flex items-center justify-between mb-4">
                <h6 class="text-sm font-medium text-gray-700">资产基础信息配置</h6>
                <button type="button" onclick="openAssetConfigModal()" class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">
                  <i class="fas fa-cog mr-1"></i>配置标签属性
                </button>
              </div>
              
              <!-- 当前配置显示 -->
              <div id="current-asset-config" class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                <div class="text-sm text-gray-600">
                  <div class="mb-2">
                    <span class="font-medium">技术标签：</span>
                    <span id="current-tech-tags">未配置</span>
                  </div>
                  <div class="mb-2">
                    <span class="font-medium">业务标签：</span>
                    <span id="current-business-tags">未配置</span>
                  </div>
                  <div class="mb-2">
                    <span class="font-medium">安全标签：</span>
                    <span id="current-security-tags">未配置</span>
                  </div>
                  <div class="mb-2">
                    <span class="font-medium">资产属性：</span>
                    <span id="current-asset-attributes">未配置</span>
                  </div>
                  <div>
                    <span class="font-medium">所属目录：</span>
                    <span id="current-directory">未配置</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- 数据集管理 -->
            <div class="col-span-2">
              <div class="flex items-center justify-between mb-4">
                <h6 class="text-sm font-medium text-gray-700">数据集管理</h6>
                <button type="button" onclick="addNewDatasetForAcceptance(this)" class="px-3 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600">
                  <i class="fas fa-plus mr-1"></i>新增数据集
                </button>
              </div>
              
              <!-- 数据集列表 -->
              <div class="acceptance-datasets-container space-y-3">
                <!-- 数据集项将通过JavaScript动态生成 -->
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = assetsHtml;
      
      // 获取项目资产类型作为默认值
      const projectAssetType = getProjectAssetType();
      
      // 加载已保存的资产类型确认，如果没有保存则使用项目默认值
      const savedAssetTypeConfirmations = JSON.parse(localStorage.getItem('assetTypeConfirmations') || '{}');
      Object.keys(savedAssetTypeConfirmations).forEach(assetId => {
        const select = document.querySelector(`.asset-type-confirmation[data-asset-id="${assetId}"]`);
        if (select) {
          select.value = savedAssetTypeConfirmations[assetId];
        }
      });
      
      // 为没有保存确认的资产设置项目默认值
      const allConfirmationSelects = document.querySelectorAll('.asset-type-confirmation');
      allConfirmationSelects.forEach(select => {
        if (!select.value && projectAssetType) {
          select.value = projectAssetType;
        }
      });
      
      // 加载修改说明
      const savedNotes = localStorage.getItem('assetModificationNotes') || '';
      const notesTextarea = document.getElementById('asset-modification-notes');
      if (notesTextarea) {
        notesTextarea.value = savedNotes;
      }
      
    }
    
    
    function saveModificationNotes() {
      const modificationNotes = document.getElementById('asset-modification-notes')?.value || '';
      
      // 验证资产类型确认
      const assetTypeConfirmations = document.querySelectorAll('.asset-type-confirmation');
      let hasUnconfirmed = false;
      
      assetTypeConfirmations.forEach(select => {
        if (!select.value) {
          hasUnconfirmed = true;
          select.style.borderColor = '#ef4444';
          select.style.backgroundColor = '#fef2f2';
        } else {
          select.style.borderColor = '#d1d5db';
          select.style.backgroundColor = '#ffffff';
        }
      });
      
      if (hasUnconfirmed) {
        showToast('请确认所有资产的类型分类！', 'error');
        return false;
      }
      
      // 保存资产类型确认
      const assetTypeData = {};
      assetTypeConfirmations.forEach(select => {
        const assetId = select.getAttribute('data-asset-id');
        assetTypeData[assetId] = select.value;
      });
      localStorage.setItem('assetTypeConfirmations', JSON.stringify(assetTypeData));
      
      // 保存修改说明
      localStorage.setItem('assetModificationNotes', modificationNotes);
      
      showToast('资产类型确认和修改说明保存成功！');
      return true;
    }

    // 为资产添加数据集
    function addNewDatasetForAsset(button) {
      const assetItem = button.closest('.asset-item');
      const datasetsContainer = assetItem.querySelector('.asset-datasets-container');
      const datasetId = 'dataset_' + Date.now();
      
      const datasetHtml = `
        <div class="dataset-item border border-gray-200 rounded-lg p-3" data-dataset-id="${datasetId}">
          <div class="flex items-center justify-between mb-3">
            <h6 class="text-sm font-medium text-gray-600">数据集 ${datasetsContainer.children.length + 1}</h6>
            <button onclick="removeDatasetFromAsset(this)" class="text-red-500 hover:text-red-700 text-xs">
              删除
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据资源名称 *</label>
              <input type="text" class="dataset-name w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="请输入数据资源名称">
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据资源类型 *</label>
              <select class="dataset-type w-full px-2 py-1 text-sm border border-gray-300 rounded">
                <option value="">请选择类型</option>
                <option value="structured">结构化数据</option>
                <option value="unstructured">非结构化数据</option>
                <option value="semi-structured">半结构化数据</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据来源 *</label>
              <input type="text" class="dataset-source w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="请输入数据来源">
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据量级</label>
              <input type="text" class="dataset-volume w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="如：100万条">
            </div>
            <div class="col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">数据集描述</label>
              <textarea class="dataset-description w-full px-2 py-1 text-sm border border-gray-300 rounded" rows="2" placeholder="请描述数据集的内容和用途"></textarea>
            </div>
          </div>
        </div>
      `;
      
      datasetsContainer.insertAdjacentHTML('beforeend', datasetHtml);
    }
    
    // 从资产中删除数据集
    function removeDatasetFromAsset(button) {
      const datasetItem = button.closest('.dataset-item');
      datasetItem.remove();
      
      // 重新编号剩余的数据集
      const assetItem = button.closest('.asset-item');
      const remainingDatasets = assetItem.querySelectorAll('.dataset-item');
      remainingDatasets.forEach((dataset, index) => {
        const titleElement = dataset.querySelector('h6');
        if (titleElement) {
          titleElement.textContent = `数据集 ${index + 1}`;
        }
      });
    }

    // 为验收环节的资产添加数据集
    function addNewDatasetForAcceptance(button) {
      const assetItem = button.closest('.acceptance-asset-item');
      const datasetsContainer = assetItem.querySelector('.acceptance-datasets-container');
      const datasetId = 'acceptance_dataset_' + Date.now();
      
      const datasetHtml = `
        <div class="acceptance-dataset-item border border-gray-200 rounded-lg p-3" data-dataset-id="${datasetId}">
          <div class="flex items-center justify-between mb-3">
            <h6 class="text-sm font-medium text-gray-600">数据集 ${datasetsContainer.children.length + 1}</h6>
            <button onclick="removeDatasetFromAcceptance(this)" class="text-red-500 hover:text-red-700 text-xs">
              删除
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <!-- 名称 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">名称 *</label>
              <input type="text" class="acceptance-dataset-name w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="请输入数据集名称">
            </div>
            
            <!-- 数据库类型 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据库类型 *</label>
              <select class="acceptance-dataset-db-type w-full px-2 py-1 text-sm border border-gray-300 rounded">
                <option value="">请选择数据库类型</option>
                <option value="MySQL">MySQL</option>
                <option value="Oracle">Oracle</option>
                <option value="SQL Server">SQL Server</option>
                <option value="PostgreSQL">PostgreSQL</option>
                <option value="MongoDB">MongoDB</option>
                <option value="Redis">Redis</option>
                <option value="Elasticsearch">Elasticsearch</option>
                <option value="HBase">HBase</option>
                <option value="其他">其他</option>
              </select>
            </div>
            
            <!-- 数据结构 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据结构 *</label>
              <select class="acceptance-dataset-structure w-full px-2 py-1 text-sm border border-gray-300 rounded">
                <option value="">请选择数据结构</option>
                <option value="structured">结构化数据</option>
                <option value="unstructured">非结构化数据</option>
                <option value="semi-structured">半结构化数据</option>
              </select>
            </div>
            
            <!-- 规模 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">规模 *</label>
              <input type="text" class="acceptance-dataset-scale w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="如：100GB">
            </div>
            
            <!-- 条数 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">条数 *</label>
              <input type="text" class="acceptance-dataset-count w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="如：100万条">
            </div>
            
            <!-- 频率 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">频率 *</label>
              <select class="acceptance-dataset-frequency w-full px-2 py-1 text-sm border border-gray-300 rounded">
                <option value="">请选择更新频率</option>
                <option value="实时">实时</option>
                <option value="每小时">每小时</option>
                <option value="每日">每日</option>
                <option value="每周">每周</option>
                <option value="每月">每月</option>
                <option value="每季度">每季度</option>
                <option value="每年">每年</option>
                <option value="不定期">不定期</option>
                <option value="其他">其他</option>
              </select>
            </div>
            
            <!-- 加工性质 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">加工性质 *</label>
              <select class="acceptance-dataset-processing w-full px-2 py-1 text-sm border border-gray-300 rounded">
                <option value="">请选择加工性质</option>
                <option value="原始数据">原始数据</option>
                <option value="清洗数据">清洗数据</option>
                <option value="加工数据">加工数据</option>
                <option value="聚合数据">聚合数据</option>
                <option value="衍生数据">衍生数据</option>
                <option value="其他">其他</option>
              </select>
            </div>
            
            <!-- 数据来源 -->
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">数据来源 *</label>
              <input type="text" class="acceptance-dataset-source w-full px-2 py-1 text-sm border border-gray-300 rounded" placeholder="请输入数据来源">
            </div>
            
            <!-- 详细描述 -->
            <div class="col-span-2">
              <label class="block text-xs font-medium text-gray-600 mb-1">详细描述</label>
              <textarea class="acceptance-dataset-description w-full px-2 py-1 text-sm border border-gray-300 rounded" rows="2" placeholder="请描述数据集的内容和用途"></textarea>
            </div>
          </div>
          
          <!-- 数据资源选择 -->
          <div class="mt-4 border-t pt-3">
            <div class="flex items-center justify-between mb-3">
              <label class="block text-xs font-medium text-gray-600">挂载数据资源</label>
              <button type="button" onclick="openResourceSelectionModal('${datasetId}')" class="px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600">
                <i class="fas fa-plus mr-1"></i>选择数据资源
              </button>
            </div>
            
            <!-- 已选择的数据资源列表 -->
            <div class="selected-resources-${datasetId} space-y-2">
              <!-- 已选择的数据资源将在这里显示 -->
            </div>
          </div>
        </div>
      `;
      
      datasetsContainer.insertAdjacentHTML('beforeend', datasetHtml);
    }
    
    // 从验收环节的资产中删除数据集
    function removeDatasetFromAcceptance(button) {
      const datasetItem = button.closest('.acceptance-dataset-item');
      datasetItem.remove();
      
      // 重新编号剩余的数据集
      const assetItem = button.closest('.acceptance-asset-item');
      const remainingDatasets = assetItem.querySelectorAll('.acceptance-dataset-item');
      remainingDatasets.forEach((dataset, index) => {
        const titleElement = dataset.querySelector('h6');
        if (titleElement) {
          titleElement.textContent = `数据集 ${index + 1}`;
        }
      });
    }

    // 初始化默认资产数据
    function initializeDefaultAsset() {
      // 检查是否已经有保存的资产数据
      const existingAssets = JSON.parse(localStorage.getItem('projectAssets') || '[]');
      
      // 如果没有资产数据，则初始化默认的资产1和资产2
      if (existingAssets.length === 0) {
        const defaultAssets = [
          {
            id: 'asset_1',
            name: '采购业务分析数据集',
            holdingPurpose: '业务运营',
            department: '数据管理部',
            businessOwnership: '零售业务',
            industry: '银行业',
            totalCount: '500000',
            dataSize: '2.5TB',
            updateFrequency: '每日更新',
            storageType: '关系型数据库',
            description: '该数据集包含采购业务相关的分析数据，包括采购订单、供应商信息、采购金额、采购周期等关键指标。主要用于采购决策分析、供应商评估、成本控制等业务场景。数据来源于采购管理系统，每日更新，是采购业务分析的重要数据资产。'
          },
          {
            id: 'asset_2',
            name: '成交分析数据集',
            holdingPurpose: '业务分析',
            department: '数据分析部',
            businessOwnership: '交易业务',
            industry: '金融业',
            totalCount: '300000',
            dataSize: '1.8TB',
            updateFrequency: '实时更新',
            storageType: '分布式数据库',
            description: '该数据集包含交易成交相关的分析数据，包括成交价格、成交量、成交时间、交易对手信息等关键指标。主要用于交易策略分析、市场趋势预测、风险控制等业务场景。数据来源于交易系统，实时更新，是交易分析的重要数据资产。'
          }
        ];
        
        localStorage.setItem('projectAssets', JSON.stringify(defaultAssets));
        console.log('默认资产数据已初始化（资产1和资产2）');
      } else {
        // 如果已有资产数据，检查是否需要添加资产2
        const hasAsset2 = existingAssets.some(asset => asset.id === 'asset_2');
        if (!hasAsset2) {
          const asset2 = {
            id: 'asset_2',
            name: '成交分析数据集',
            holdingPurpose: '业务分析',
            department: '数据分析部',
            businessOwnership: '交易业务',
            industry: '金融业',
            totalCount: '300000',
            dataSize: '1.8TB',
            updateFrequency: '实时更新',
            storageType: '分布式数据库',
            description: '该数据集包含交易成交相关的分析数据，包括成交价格、成交量、成交时间、交易对手信息等关键指标。主要用于交易策略分析、市场趋势预测、风险控制等业务场景。数据来源于交易系统，实时更新，是交易分析的重要数据资产。'
          };
          
          existingAssets.push(asset2);
          localStorage.setItem('projectAssets', JSON.stringify(existingAssets));
          console.log('资产2已添加到现有资产列表中');
        }
      }
    }

    // 数据资源选择相关函数
    let currentDatasetId = null;
    let selectedResources = [];

    // 打开数据资源选择模态框
    function openResourceSelectionModal(datasetId) {
      console.log('打开数据资源选择模态框，数据集ID:', datasetId);
      currentDatasetId = datasetId;
      selectedResources = [];
      
      // 显示模态框
      const modal = document.getElementById('resource-selection-modal');
      if (modal) {
        modal.classList.remove('hidden');
        console.log('模态框已显示');
      } else {
        console.error('未找到数据资源选择模态框');
        return;
      }
      
      // 加载数据资源列表
      loadResourceList();
    }

    // 关闭数据资源选择模态框
    function closeResourceModal() {
      const modal = document.getElementById('resource-selection-modal');
      modal.classList.add('hidden');
      currentDatasetId = null;
      selectedResources = [];
    }

    // 加载数据资源列表
    function loadResourceList() {
      console.log('开始加载数据资源列表');
      const resourcesList = document.getElementById('resources-list');
      const searchInput = document.getElementById('resource-search');
      
      if (!resourcesList) {
        console.error('未找到数据资源列表容器');
        return;
      }
      
      // 示例数据资源
      const resources = [
        { id: 'res_001', name: '用户基础信息表', type: '结构化', volume: '2.5GB', records: '1,250,000' },
        { id: 'res_002', name: '订单交易记录', type: '结构化', volume: '15.8GB', records: '8,750,000' },
        { id: 'res_003', name: '商品目录信息', type: '结构化', volume: '1.2GB', records: '450,000' },
        { id: 'res_004', name: '用户行为日志', type: '半结构化', volume: '25.6GB', records: '12,500,000' },
        { id: 'res_005', name: '客户服务记录', type: '非结构化', volume: '8.3GB', records: '2,100,000' }
      ];
      
      let resourcesHtml = '';
      resources.forEach(resource => {
        const isSelected = selectedResources.includes(resource.id);
        resourcesHtml += `
          <div class="resource-item border border-gray-200 rounded-lg p-3 hover:bg-gray-50 cursor-pointer ${isSelected ? 'bg-blue-50 border-blue-300' : ''}" 
               onclick="toggleResourceSelection('${resource.id}')">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="flex items-center space-x-3">
                  <input type="checkbox" class="resource-checkbox" data-resource-id="${resource.id}" ${isSelected ? 'checked' : ''}>
                  <div>
                    <h4 class="text-sm font-medium text-gray-900">${resource.name}</h4>
                    <div class="text-xs text-gray-500 mt-1">
                      <span class="mr-3">类型: ${resource.type}</span>
                      <span class="mr-3">大小: ${resource.volume}</span>
                      <span>记录数: ${resource.records}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <span class="text-xs text-gray-400">${resource.id}</span>
              </div>
            </div>
          </div>
        `;
      });
      
      resourcesList.innerHTML = resourcesHtml;
      
      // 添加搜索功能
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const resourceItems = document.querySelectorAll('.resource-item');
        
        resourceItems.forEach(item => {
          const resourceName = item.querySelector('h4').textContent.toLowerCase();
          if (resourceName.includes(searchTerm)) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
    }

    // 切换数据资源选择状态
    function toggleResourceSelection(resourceId) {
      const checkbox = document.querySelector(`input[data-resource-id="${resourceId}"]`);
      const resourceItem = checkbox.closest('.resource-item');
      
      if (selectedResources.includes(resourceId)) {
        // 取消选择
        selectedResources = selectedResources.filter(id => id !== resourceId);
        checkbox.checked = false;
        resourceItem.classList.remove('bg-blue-50', 'border-blue-300');
      } else {
        // 选择
        selectedResources.push(resourceId);
        checkbox.checked = true;
        resourceItem.classList.add('bg-blue-50', 'border-blue-300');
      }
    }

    // 确认选择数据资源
    function confirmSelectResources() {
      if (currentDatasetId && selectedResources.length > 0) {
        // 更新数据集的数据资源显示
        updateDatasetResources(currentDatasetId, selectedResources);
        closeResourceModal();
        showToast(`已为数据集选择 ${selectedResources.length} 个数据资源`);
      } else {
        showToast('请至少选择一个数据资源', 'error');
      }
    }

    // 更新数据集的数据资源显示
    function updateDatasetResources(datasetId, resourceIds) {
      const resourcesContainer = document.querySelector(`.selected-resources-${datasetId}`);
      
      // 示例数据资源信息
      const resourceInfo = {
        'res_001': { name: '用户基础信息表', type: '结构化', volume: '2.5GB' },
        'res_002': { name: '订单交易记录', type: '结构化', volume: '15.8GB' },
        'res_003': { name: '商品目录信息', type: '结构化', volume: '1.2GB' },
        'res_004': { name: '用户行为日志', type: '半结构化', volume: '25.6GB' },
        'res_005': { name: '客户服务记录', type: '非结构化', volume: '8.3GB' }
      };
      
      let resourcesHtml = '';
      resourceIds.forEach(resourceId => {
        const resource = resourceInfo[resourceId];
        if (resource) {
          resourcesHtml += `
            <div class="flex items-center justify-between bg-gray-50 border border-gray-200 rounded-lg p-2">
              <div class="flex items-center space-x-3">
                <i class="fas fa-database text-blue-500"></i>
                <div>
                  <div class="text-sm font-medium text-gray-900">${resource.name}</div>
                  <div class="text-xs text-gray-500">${resource.type} | ${resource.volume}</div>
                </div>
              </div>
              <button onclick="removeResourceFromDataset('${datasetId}', '${resourceId}')" class="text-red-500 hover:text-red-700 text-xs">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `;
        }
      });
      
      resourcesContainer.innerHTML = resourcesHtml;
    }

    // 从数据集中移除数据资源
    function removeResourceFromDataset(datasetId, resourceId) {
      const resourcesContainer = document.querySelector(`.selected-resources-${datasetId}`);
      const resourceElement = resourcesContainer.querySelector(`[onclick*="${resourceId}"]`);
      if (resourceElement) {
        resourceElement.remove();
        showToast('数据资源已移除');
      }
    }

    // 按费用分类计算价值分配
    function calculateAllocationByCategory(input, category) {
      const row = input.closest('tr');
      const categoryTotals = {
        'material': 50,  // 材料费总额（万元）
        'labor': 80,     // 工时费总额（万元）
        'service': 70    // 服务费总额（万元）
      };
      
      const categoryTotal = categoryTotals[category];
      
      // 获取该分类下所有资产的比例
      const inputs = row.querySelectorAll('input[onchange*="calculateAllocationByCategory"]');
      const amounts = [];
      
      inputs.forEach((input, index) => {
        const percent = parseFloat(input.value) || 0;
        const amount = (categoryTotal * percent / 100).toFixed(1);
        amounts.push(amount);
        
        // 更新对应资产的金额显示
        const amountCell = input.parentNode.nextElementSibling;
        if (amountCell) {
          amountCell.textContent = `¥${amount}万`;
        }
      });
      
      // 更新该分类的总计
      const totalAllocated = amounts.reduce((sum, amount) => sum + parseFloat(amount), 0).toFixed(1);
      const totalCell = row.querySelector('td:last-child');
      if (totalCell) {
        totalCell.textContent = `¥${totalAllocated}万`;
      }
      
      // 更新总分配价值
      updateAllocationTotal();
      
      // 更新按资产合计
      calculateAssetTotals();
    }

    // 更新总分配价值
    function updateAllocationTotal() {
      const rows = document.querySelectorAll('#asset-allocation-table tr');
      let totalAllocation = 0;
      
      rows.forEach(row => {
        const totalCell = row.querySelector('td:last-child');
        if (totalCell && totalCell.id && totalCell.id.includes('total-allocated')) {
          const amount = parseFloat(totalCell.textContent.replace('¥', '').replace('万', ''));
          if (!isNaN(amount)) {
            totalAllocation += amount;
          }
        }
      });
      
      const totalElement = document.getElementById('allocation-total');
      if (totalElement) {
        totalElement.textContent = `¥${totalAllocation.toFixed(1)}万`;
      }
    }

    // 计算按资产合计
    function calculateAssetTotals() {
      // 计算资产1的总计（采购业务分析数据集）
      const asset1Material = parseFloat(document.getElementById('asset1-material').textContent.replace('¥', '').replace('万', '')) || 0;
      const asset1Labor = parseFloat(document.getElementById('asset1-labor').textContent.replace('¥', '').replace('万', '')) || 0;
      const asset1Service = parseFloat(document.getElementById('asset1-service').textContent.replace('¥', '').replace('万', '')) || 0;
      const asset1Total = asset1Material + asset1Labor + asset1Service;
      
      // 计算资产2的总计（成交分析数据集）
      const asset2Material = parseFloat(document.getElementById('asset2-material').textContent.replace('¥', '').replace('万', '')) || 0;
      const asset2Labor = parseFloat(document.getElementById('asset2-labor').textContent.replace('¥', '').replace('万', '')) || 0;
      const asset2Service = parseFloat(document.getElementById('asset2-service').textContent.replace('¥', '').replace('万', '')) || 0;
      const asset2Total = asset2Material + asset2Labor + asset2Service;
      
      // 计算总计
      const grandTotal = asset1Total + asset2Total;
      
      // 更新显示
      document.getElementById('asset1-total').textContent = `¥${asset1Total.toFixed(1)}万`;
      document.getElementById('asset2-total').textContent = `¥${asset2Total.toFixed(1)}万`;
      document.getElementById('grand-total-allocated').textContent = `¥${grandTotal.toFixed(1)}万`;
    }

    // 资产配置弹窗相关函数
    function openAssetConfigModal() {
      const modal = document.getElementById('asset-config-modal');
      if (modal) {
        modal.classList.remove('hidden');
        // 加载已保存的配置
        loadAssetConfig();
      }
    }

    function closeAssetConfigModal() {
      const modal = document.getElementById('asset-config-modal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    function resetAssetConfigModal() {
      // 重置所有复选框
      const checkboxes = document.querySelectorAll('#asset-config-modal input[type="checkbox"]');
      checkboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // 重置下拉选择
      const level1Select = document.getElementById('modal-level1-select');
      const level2Select = document.getElementById('modal-level2-select');
      const directoryPath = document.getElementById('modal-directory-path');
      
      if (level1Select) level1Select.value = '';
      if (level2Select) level2Select.value = '';
      if (directoryPath) directoryPath.textContent = '未选择';
    }

    function saveAssetConfigModal() {
      // 收集选中的技术标签
      const techTags = [];
      const techCheckboxes = document.querySelectorAll('#asset-config-modal input[id^="modal-tag-"]:checked');
      techCheckboxes.forEach(checkbox => {
        const label = document.querySelector(`label[for="${checkbox.id}"]`);
        if (label) {
          techTags.push(label.textContent.trim());
        }
      });

      // 收集选中的业务标签
      const businessTags = [];
      const businessCheckboxes = document.querySelectorAll('#asset-config-modal input[id^="modal-tag-"]:checked');
      businessCheckboxes.forEach(checkbox => {
        const label = document.querySelector(`label[for="${checkbox.id}"]`);
        if (label) {
          businessTags.push(label.textContent.trim());
        }
      });

      // 收集选中的安全标签
      const securityTags = [];
      const securityCheckboxes = document.querySelectorAll('#asset-config-modal input[id^="modal-tag-"]:checked');
      securityCheckboxes.forEach(checkbox => {
        const label = document.querySelector(`label[for="${checkbox.id}"]`);
        if (label) {
          securityTags.push(label.textContent.trim());
        }
      });

      // 收集选中的资产属性
      const attributes = [];
      const attrCheckboxes = document.querySelectorAll('#asset-config-modal input[id^="modal-attr-"]:checked');
      attrCheckboxes.forEach(checkbox => {
        const label = document.querySelector(`label[for="${checkbox.id}"]`);
        if (label) {
          attributes.push(label.textContent.trim());
        }
      });

      // 获取目录选择
      const level1Select = document.getElementById('modal-level1-select');
      const level2Select = document.getElementById('modal-level2-select');
      const level1Value = level1Select ? level1Select.value : '';
      const level2Value = level2Select ? level2Select.value : '';
      
      let directoryPath = '未选择';
      if (level1Value && level2Value) {
        const level1Text = level1Select.options[level1Select.selectedIndex].text;
        const level2Text = level2Select.options[level2Select.selectedIndex].text;
        directoryPath = `${level1Text} > ${level2Text}`;
      } else if (level1Value) {
        const level1Text = level1Select.options[level1Select.selectedIndex].text;
        directoryPath = level1Text;
      }

      // 保存配置到localStorage
      const config = {
        techTags: techTags,
        businessTags: businessTags,
        securityTags: securityTags,
        attributes: attributes,
        directory: {
          level1: level1Value,
          level2: level2Value,
          path: directoryPath
        }
      };
      
      localStorage.setItem('assetConfig', JSON.stringify(config));
      
      // 更新显示
      updateAssetConfigDisplay(config);
      
      // 关闭弹窗
      closeAssetConfigModal();
      
      showToast('资产配置保存成功！');
    }

    function loadAssetConfig() {
      const savedConfig = localStorage.getItem('assetConfig');
      if (savedConfig) {
        const config = JSON.parse(savedConfig);
        
        // 恢复复选框状态
        config.techTags.forEach(tag => {
          const checkbox = document.querySelector(`#asset-config-modal input[type="checkbox"]`);
          if (checkbox) {
            const label = document.querySelector(`label:contains("${tag}")`);
            if (label) {
              const checkboxId = label.getAttribute('for');
              const checkboxElement = document.getElementById(checkboxId);
              if (checkboxElement) checkboxElement.checked = true;
            }
          }
        });

        // 恢复下拉选择
        const level1Select = document.getElementById('modal-level1-select');
        const level2Select = document.getElementById('modal-level2-select');
        const directoryPath = document.getElementById('modal-directory-path');
        
        if (level1Select && config.directory.level1) {
          level1Select.value = config.directory.level1;
          updateLevel2Options(config.directory.level1);
        }
        if (level2Select && config.directory.level2) {
          level2Select.value = config.directory.level2;
        }
        if (directoryPath) {
          directoryPath.textContent = config.directory.path;
        }
      }
    }

    function updateAssetConfigDisplay(config) {
      // 更新技术标签显示
      const techTagsElement = document.getElementById('current-tech-tags');
      if (techTagsElement) {
        techTagsElement.textContent = config.techTags.length > 0 ? config.techTags.join(', ') : '未配置';
      }

      // 更新业务标签显示
      const businessTagsElement = document.getElementById('current-business-tags');
      if (businessTagsElement) {
        businessTagsElement.textContent = config.businessTags.length > 0 ? config.businessTags.join(', ') : '未配置';
      }

      // 更新安全标签显示
      const securityTagsElement = document.getElementById('current-security-tags');
      if (securityTagsElement) {
        securityTagsElement.textContent = config.securityTags.length > 0 ? config.securityTags.join(', ') : '未配置';
      }

      // 更新资产属性显示
      const attributesElement = document.getElementById('current-asset-attributes');
      if (attributesElement) {
        attributesElement.textContent = config.attributes.length > 0 ? config.attributes.join(', ') : '未配置';
      }

      // 更新目录显示
      const directoryElement = document.getElementById('current-directory');
      if (directoryElement) {
        directoryElement.textContent = config.directory.path;
      }
    }

    // 目录选择联动
    function updateLevel2Options(level1Value) {
      const level2Select = document.getElementById('modal-level2-select');
      const directoryPath = document.getElementById('modal-directory-path');
      
      if (!level2Select) return;
      
      // 清空二级目录选项
      level2Select.innerHTML = '<option value="">请选择二级目录</option>';
      
      // 根据一级目录设置二级目录选项
      const level2Options = {
        'business': [
          { value: 'customer', text: '客户数据' },
          { value: 'order', text: '订单数据' },
          { value: 'product', text: '产品数据' }
        ],
        'system': [
          { value: 'log', text: '日志数据' },
          { value: 'config', text: '配置数据' },
          { value: 'monitor', text: '监控数据' }
        ],
        'external': [
          { value: 'api', text: 'API数据' },
          { value: 'third-party', text: '第三方数据' }
        ],
        'personal': [
          { value: 'profile', text: '个人档案' },
          { value: 'preference', text: '个人偏好' }
        ]
      };
      
      if (level2Options[level1Value]) {
        level2Options[level1Value].forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option.value;
          optionElement.textContent = option.text;
          level2Select.appendChild(optionElement);
        });
      }
      
      // 更新路径显示
      if (directoryPath) {
        const level1Text = document.querySelector(`#modal-level1-select option[value="${level1Value}"]`)?.textContent || '';
        directoryPath.textContent = level1Text || '未选择';
      }
    }

    // 监听一级目录变化
    document.addEventListener('DOMContentLoaded', function() {
      const level1Select = document.getElementById('modal-level1-select');
      const level2Select = document.getElementById('modal-level2-select');
      const directoryPath = document.getElementById('modal-directory-path');
      
      if (level1Select) {
        level1Select.addEventListener('change', function() {
          updateLevel2Options(this.value);
        });
      }
      
      if (level2Select) {
        level2Select.addEventListener('change', function() {
          const level1Value = level1Select ? level1Select.value : '';
          const level1Text = level1Select ? level1Select.options[level1Select.selectedIndex].text : '';
          const level2Text = this.options[this.selectedIndex].text;
          
          if (directoryPath) {
            if (level1Value && this.value) {
              directoryPath.textContent = `${level1Text} > ${level2Text}`;
            } else if (level1Value) {
              directoryPath.textContent = level1Text;
            } else {
              directoryPath.textContent = '未选择';
            }
          }
        });
      }
      
      // 加载已保存的配置
      const savedConfig = localStorage.getItem('assetConfig');
      if (savedConfig) {
        const config = JSON.parse(savedConfig);
        updateAssetConfigDisplay(config);
      }
    });
  </script>

  <!-- 数据资源选择模态框 -->
  <div id="resource-selection-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full h-[90vh] flex flex-col modal-container">
      <div class="flex items-center justify-between p-6 border-b">
        <h3 class="text-lg font-semibold text-gray-900">选择数据资源</h3>
        <button onclick="closeResourceModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="flex-1 overflow-y-auto p-6 modal-content" style="max-height: calc(90vh - 120px);">
        <div class="mb-4">
          <input type="text" id="resource-search" placeholder="搜索数据资源..." class="w-full px-3 py-2 border border-gray-300 rounded-md">
        </div>
        
        <div class="space-y-2">
          <div id="resources-list">
            <!-- 数据资源列表将通过JavaScript动态生成 -->
          </div>
        </div>
      </div>
      
      <div class="flex justify-end space-x-3 p-4 sm:p-6 border-t bg-gray-50 flex-shrink-0">
        <button onclick="closeResourceModal()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
          取消
        </button>
        <button onclick="confirmSelectResources()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
          确认选择
        </button>
      </div>
    </div>
  </div>

  <!-- 资产配置弹窗 -->
  <div id="asset-config-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full h-[90vh] flex flex-col modal-container">
        <div class="flex items-center justify-between p-6 border-b">
          <h3 class="text-lg font-medium text-gray-800">资产基础信息配置</h3>
          <button onclick="closeAssetConfigModal()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-6 modal-content" style="max-height: calc(90vh - 120px);">
          <div class="space-y-6">
            <!-- 技术标签 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-3">技术标签 <span class="text-red-500">*</span></label>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-structured" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-structured" class="text-sm text-gray-700">结构化数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-unstructured" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-unstructured" class="text-sm text-gray-700">非结构化数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-real-time" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-real-time" class="text-sm text-gray-700">实时数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-batch" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-batch" class="text-sm text-gray-700">批量数据</label>
                </div>
              </div>
            </div>

            <!-- 业务标签 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-3">业务标签 <span class="text-red-500">*</span></label>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-user" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-user" class="text-sm text-gray-700">用户数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-behavior" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-behavior" class="text-sm text-gray-700">行为数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-marketing" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-marketing" class="text-sm text-gray-700">营销数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-sales" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-sales" class="text-sm text-gray-700">销售数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-operations" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-operations" class="text-sm text-gray-700">运营数据</label>
                </div>
              </div>
            </div>

            <!-- 安全标签 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-3">安全标签 <span class="text-red-500">*</span></label>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-sensitive" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-sensitive" class="text-sm text-gray-700">敏感数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-encrypted" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-encrypted" class="text-sm text-gray-700">加密数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-public" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-public" class="text-sm text-gray-700">公开数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-tag-internal" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-tag-internal" class="text-sm text-gray-700">内部数据</label>
                </div>
              </div>
            </div>

            <!-- 资产属性选择 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-3">资产属性 <span class="text-red-500">*</span></label>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-attr-internal" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-attr-internal" class="text-sm text-gray-700">内部数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-attr-external" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-attr-external" class="text-sm text-gray-700">外部数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-attr-public" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-attr-public" class="text-sm text-gray-700">公开数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-attr-confidential" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-attr-confidential" class="text-sm text-gray-700">机密数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-attr-restricted" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-attr-restricted" class="text-sm text-gray-700">受限数据</label>
                </div>
                <div class="flex items-center space-x-2">
                  <input type="checkbox" id="modal-attr-archived" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <label for="modal-attr-archived" class="text-sm text-gray-700">归档数据</label>
                </div>
              </div>
            </div>

            <!-- 所属目录选择 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-3">所属目录 <span class="text-red-500">*</span></label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-xs font-medium text-gray-600 mb-1">一级目录</label>
                  <select id="modal-level1-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">请选择一级目录</option>
                    <option value="business">业务数据</option>
                    <option value="system">系统数据</option>
                    <option value="external">外部数据</option>
                    <option value="personal">个人数据</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-600 mb-1">二级目录</label>
                  <select id="modal-level2-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">请选择二级目录</option>
                  </select>
                </div>
              </div>
              <div class="mt-2 text-xs text-gray-500">
                当前选择路径：<span id="modal-directory-path" class="text-blue-600">未选择</span>
              </div>
            </div>
          </div>
          
        </div>
        
        <!-- 操作按钮 -->
        <div class="flex justify-end space-x-3 p-4 sm:p-6 border-t bg-gray-50 flex-shrink-0">
          <button type="button" onclick="resetAssetConfigModal()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
            重置选择
          </button>
          <button type="button" onclick="closeAssetConfigModal()" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
            取消
          </button>
          <button type="button" onclick="saveAssetConfigModal()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
            保存配置
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 数据资源弹窗相关函数（资产形成环节）
    let assetFormationSelectedResources = [];
    
    // 树形数据资源结构
    const dataResourceTree = [
      {
        id: 'source_001',
        name: '数据来源1',
        expanded: true,
        tables: [
          { id: 'table_001', name: '合同数据表', type: '结构化', volume: '2.5GB', records: '1,250,000' },
          { id: 'table_002', name: '供应商数据表', type: '结构化', volume: '1.2GB', records: '450,000' },
          { id: 'table_003', name: '投标数据表', type: '结构化', volume: '0.8GB', records: '150,000' }
        ]
      },
      {
        id: 'source_002',
        name: '数据来源222',
        expanded: false,
        tables: [
          { id: 'table_004', name: '订单交易记录', type: '结构化', volume: '15.8GB', records: '8,750,000' },
          { id: 'table_005', name: '用户基础信息表', type: '结构化', volume: '2.5GB', records: '1,250,000' }
        ]
      },
      {
        id: 'source_003',
        name: '数据来源2533',
        expanded: false,
        tables: [
          { id: 'table_006', name: '商品目录信息', type: '结构化', volume: '1.2GB', records: '450,000' },
          { id: 'table_007', name: '用户行为日志', type: '半结构化', volume: '25.6GB', records: '12,500,000' },
          { id: 'table_008', name: '客户服务记录', type: '非结构化', volume: '8.3GB', records: '2,100,000' }
        ]
      }
    ];

    // 打开数据资源选择弹窗
    function openDataResourceModal() {
      document.getElementById('dataResourceSelectionModal').classList.remove('hidden');
      assetFormationSelectedResources = [];
      renderDataResourceTree();
      updateSelectedResourcesList();
    }

    // 关闭数据资源选择弹窗
    function closeDataResourceModal() {
      document.getElementById('dataResourceSelectionModal').classList.add('hidden');
    }

    // 渲染树形结构
    function renderDataResourceTree() {
      const treeContainer = document.getElementById('dataResourceTree');
      if (!treeContainer) return;
      
      let html = '';
      dataResourceTree.forEach(source => {
        html += `
          <div class="tree-node mb-2">
            <div class="flex items-center py-2 cursor-pointer hover:bg-gray-100 rounded px-2" onclick="toggleSourceNode('${source.id}')">
              <i class="fas fa-chevron-${source.expanded ? 'down' : 'right'} text-xs text-gray-500 mr-2 w-4"></i>
              <span class="text-sm font-medium text-gray-700">${source.name}</span>
            </div>
            <div class="tree-children ml-6 ${source.expanded ? '' : 'hidden'}" id="children_${source.id}">
              ${source.tables.map(table => {
                const isSelected = assetFormationSelectedResources.some(r => r.id === table.id);
                return `
                  <div class="flex items-center py-2 px-2 hover:bg-gray-50 rounded cursor-pointer" onclick="toggleTableSelection('${source.id}', '${table.id}')">
                    <input type="checkbox" class="mr-3 h-4 w-4 text-blue-600" ${isSelected ? 'checked' : ''} 
                           onclick="event.stopPropagation(); toggleTableSelection('${source.id}', '${table.id}')">
                    <i class="fas fa-table text-xs text-gray-400 mr-2"></i>
                    <span class="text-sm text-gray-700">${table.name}</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      });
      
      treeContainer.innerHTML = html;
    }

    // 切换数据来源节点展开/折叠
    function toggleSourceNode(sourceId) {
      const source = dataResourceTree.find(s => s.id === sourceId);
      if (!source) return;
      
      source.expanded = !source.expanded;
      const children = document.getElementById(`children_${sourceId}`);
      if (children) {
        if (source.expanded) {
          children.classList.remove('hidden');
        } else {
          children.classList.add('hidden');
        }
        // 更新图标
        const icon = children.previousElementSibling.querySelector('i');
        if (icon) {
          icon.className = `fas fa-chevron-${source.expanded ? 'down' : 'right'} text-xs text-gray-500 mr-2 w-4`;
        }
      }
    }

    // 切换数据表选择状态
    function toggleTableSelection(sourceId, tableId) {
      const source = dataResourceTree.find(s => s.id === sourceId);
      if (!source) return;
      
      const table = source.tables.find(t => t.id === tableId);
      if (!table) return;
      
      const existingIndex = assetFormationSelectedResources.findIndex(r => r.id === tableId);
      
      if (existingIndex >= 0) {
        // 取消选择
        assetFormationSelectedResources.splice(existingIndex, 1);
      } else {
        // 选择
        assetFormationSelectedResources.push({
          id: tableId,
          name: table.name,
          sourceId: sourceId,
          sourceName: source.name
        });
      }
      
      renderDataResourceTree();
      updateSelectedResourcesList();
    }

    // 更新已选资源列表
    function updateSelectedResourcesList() {
      const selectedList = document.getElementById('selectedResourcesList');
      const emptyMessage = document.getElementById('emptySelectedMessage');
      const selectedCount = document.getElementById('selectedCount');
      
      if (!selectedList || !emptyMessage || !selectedCount) return;
      
      selectedCount.textContent = assetFormationSelectedResources.length;
      
      if (assetFormationSelectedResources.length === 0) {
        selectedList.innerHTML = '';
        emptyMessage.classList.remove('hidden');
      } else {
        emptyMessage.classList.add('hidden');
        selectedList.innerHTML = assetFormationSelectedResources.map(resource => `
          <div class="flex items-center justify-between bg-white px-3 py-2 rounded border border-gray-200">
            <span class="text-sm text-gray-700">${resource.name}</span>
            <button onclick="removeSelectedResource('${resource.id}')" class="text-gray-400 hover:text-red-500 ml-2">
              <i class="fas fa-times text-xs"></i>
            </button>
          </div>
        `).join('');
      }
    }

    // 移除已选资源
    function removeSelectedResource(resourceId) {
      assetFormationSelectedResources = assetFormationSelectedResources.filter(r => r.id !== resourceId);
      renderDataResourceTree();
      updateSelectedResourcesList();
    }

    // 清空已选资源
    function clearSelectedResources() {
      assetFormationSelectedResources = [];
      renderDataResourceTree();
      updateSelectedResourcesList();
    }

    // 搜索数据资源
    function searchDataResources() {
      const searchTerm = document.getElementById('dataResourceSearch').value.toLowerCase().trim();
      
      if (!searchTerm) {
        // 如果搜索为空，显示所有节点
        dataResourceTree.forEach(source => {
          source.expanded = true;
        });
        renderDataResourceTree();
        return;
      }
      
      // 展开包含匹配项的节点，并隐藏不匹配的节点
      dataResourceTree.forEach(source => {
        const hasMatch = source.tables.some(table => 
          table.name.toLowerCase().includes(searchTerm) || source.name.toLowerCase().includes(searchTerm)
        );
        source.expanded = hasMatch;
      });
      
      renderDataResourceTree();
      
      // 高亮匹配项，隐藏不匹配的表
      const allTables = document.querySelectorAll('.tree-children > div');
      allTables.forEach(tableDiv => {
        const tableName = tableDiv.querySelector('span').textContent.toLowerCase();
        if (tableName.includes(searchTerm)) {
          tableDiv.classList.add('bg-yellow-100');
          tableDiv.style.display = 'flex';
        } else {
          tableDiv.classList.remove('bg-yellow-100');
          // 如果父节点也不匹配，则隐藏
          const sourceName = tableDiv.closest('.tree-node').querySelector('.font-medium').textContent.toLowerCase();
          if (!sourceName.includes(searchTerm)) {
            tableDiv.style.display = 'none';
          } else {
            tableDiv.style.display = 'flex';
          }
        }
      });
    }

    // 确认选择数据资源
    function confirmDataResourceSelection() {
      if (assetFormationSelectedResources.length === 0) {
        alert('请至少选择一个数据资源');
        return;
      }
      
      console.log('已选择的数据资源:', assetFormationSelectedResources);
      alert(`已选择 ${assetFormationSelectedResources.length} 个数据资源`);
      closeDataResourceModal();
    }
    
    // 代入上一资产权属证明
    function loadPreviousAssetOwnership() {
      if (confirm('确定要代入上一资产的权属证明吗？这将覆盖当前已填写的权属证明信息。')) {
        alert('功能开发中：将从系统中获取上一个资产的权属证明信息并自动填充到当前表单。');
        // 实际实现时，这里会调用API获取上一个资产的权属证明信息并填充表单
      }
    }

    // ==================== 项目编码同步逻辑 ====================
    // 页面加载完成后，自动同步项目编码到资产形成环节
    document.addEventListener('DOMContentLoaded', function() {
      syncProjectCodeToAssetPhase();
      
      // 监听立项环节的项目编码输入变化
      const projectCodeInput = document.getElementById('project-code-input');
      if (projectCodeInput) {
        projectCodeInput.addEventListener('input', syncProjectCodeToAssetPhase);
      }
    });
    
    // 同步项目编码函数
    function syncProjectCodeToAssetPhase() {
      const projectCodeInput = document.getElementById('project-code-input');
      const assetPhaseProjectCode = document.getElementById('asset-phase-project-code');
      
      if (projectCodeInput && assetPhaseProjectCode) {
        assetPhaseProjectCode.value = projectCodeInput.value || '';
      }
    }
    
    // 用户下拉菜单切换
    function toggleUserDropdown() {
      const dropdownMenu = document.getElementById('user-dropdown-menu');
      const arrow = document.getElementById('dropdown-arrow');
      
      if (dropdownMenu.classList.contains('hidden')) {
        dropdownMenu.classList.remove('hidden');
        arrow.style.transform = 'rotate(180deg)';
      } else {
        dropdownMenu.classList.add('hidden');
        arrow.style.transform = 'rotate(0deg)';
      }
    }

    // 点击外部关闭下拉菜单
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('user-dropdown');
      const dropdownMenu = document.getElementById('user-dropdown-menu');
      const arrow = document.getElementById('dropdown-arrow');
      
      if (!dropdown.contains(event.target)) {
        dropdownMenu.classList.add('hidden');
        arrow.style.transform = 'rotate(0deg)';
      }
    });

  </script>
</body>
</html> 