<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - 数据资产管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .sidebar-item.active {
            background-color: #3b82f6;
            color: white;
        }
        .sidebar-item:hover {
            background-color: #f3f4f6;
        }
        .notification-item.unread {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
        }
        .process-step.completed {
            color: #10b981;
        }
        .process-step.current {
            color: #3b82f6;
            font-weight: 600;
        }
        .process-step.pending {
            color: #6b7280;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-pending { background-color: #fef3c7; color: #d97706; }
        .status-processing { background-color: #dbeafe; color: #2563eb; }
        .status-approved { background-color: #d1fae5; color: #059669; }
        .status-rejected { background-color: #fee2e2; color: #dc2626; }
        .status-completed { background-color: #e0e7ff; color: #7c3aed; }
        
        /* 内容卡片样式 */
        .content-card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            border-radius: 1rem; 
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.15);
        }
        
        /* 子菜单样式 */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .submenu.open {
            max-height: 500px;
        }
        .submenu-arrow {
            transition: transform 0.3s ease;
        }
        .submenu-arrow.rotated {
            transform: rotate(180deg);
        }
        
        /* 隐藏类 */
        .hidden {
            display: none !important;
        }
        
        /* 强制显示我的任务页面 */
        #my-tasks-page {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        #my-tasks-page * {
            display: block !important;
            visibility: visible !important;
        }
        
        #my-tasks-page .grid {
            display: grid !important;
        }
        
        #my-tasks-page .flex {
            display: flex !important;
        }
        
        /* 响应式布局优化 */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            .sidebar-left {
                width: 100%;
                margin-bottom: 1rem;
            }
            .content-right {
                width: 100%;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- 顶部主导航栏 -->
    <header class="bg-gradient-to-r from-red-900 via-red-800 to-red-900 shadow flex items-center justify-between px-10 h-16 sticky top-0 z-20">
        <div class="flex items-center space-x-4">
            <img src="https://img1.imgtp.com/2023/07/21/0Qw6Qk4n.png" alt="LOGO" class="h-10 w-10 rounded-full border-2 border-red-400 shadow bg-white object-contain">
            <span class="text-xl font-bold text-white tracking-wide whitespace-nowrap">数据资产管理系统</span>
        </div>
        <nav class="flex-1 flex items-center justify-center space-x-8">
        </nav>
        <div class="flex items-center space-x-4">
            <a href="首页.html" class="text-red-100 hover:text-red-400 font-medium px-3 py-1 rounded border border-red-400 hover:bg-red-700 transition">
                <i class="fas fa-home mr-2"></i>返回首页
            </a>
            <div class="relative" id="user-dropdown">
                <div class="flex items-center space-x-2 cursor-pointer hover:bg-red-700 px-2 py-1 rounded-lg transition" onclick="toggleUserDropdown()">
                    <img src="https://i.pravatar.cc/32?img=3" class="rounded-full w-8 h-8 border-2 border-red-200" alt="用户头像">
                    <span class="text-red-100 text-sm">张三</span>
                    <i class="fas fa-chevron-down text-xs text-red-300 transition-transform" id="dropdown-arrow"></i>
                </div>
                <div id="user-dropdown-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 py-2 hidden z-50">
                    <a href="个人中心.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
                        <i class="fas fa-user-circle mr-3 text-red-500"></i>
                        个人中心
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
                        <i class="fas fa-cog mr-3 text-red-500"></i>
                        系统管理
                    </a>
                    <div class="border-t border-gray-200 my-1"></div>
                    <a href="#" class="flex items-center px-4 py-2 text-red-600 hover:bg-red-50 transition">
                        <i class="fas fa-sign-out-alt mr-3"></i>
                        退出
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- 主体内容区 -->
    <main class="flex-1 w-full max-w-7xl mx-auto flex gap-8 py-8 px-4">
        <!-- 左侧导航栏 -->
        <div class="w-64 bg-white shadow-sm rounded-lg h-fit sticky top-20">
            <div class="p-4">
                <nav class="space-y-2">
                    <!-- 我的任务 -->
                    <div id="nav-process" class="sidebar-item active flex items-center px-3 py-2 text-sm font-medium text-white rounded-lg cursor-pointer" onclick="showPersonalCenter()">
                        <i class="fas fa-tasks mr-3"></i>
                        我的任务
                    </div>

                    <!-- 消息中心 -->
                    <div id="nav-messages" class="sidebar-item flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 cursor-pointer" onclick="showMessagesCenter()">
                        <i class="fas fa-bell mr-3"></i>
                        消息中心
                    </div>
                </nav>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="flex-1">
            <!-- 消息中心页面 -->
            <div id="messages-center-page" class="content-card p-6 hidden">
                <!-- 页面标题 -->
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">消息中心</h2>
                    <p class="text-gray-600 mt-1">查看和管理您的消息通知</p>
                </div>

                <!-- 消息统计 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i class="fas fa-bell text-blue-600"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-600">总消息</p>
                                <p class="text-2xl font-bold text-blue-600" id="total-messages">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <i class="fas fa-envelope-open text-green-600"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-600">已读</p>
                                <p class="text-2xl font-bold text-green-600" id="read-messages">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <i class="fas fa-envelope text-yellow-600"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-600">未读</p>
                                <p class="text-2xl font-bold text-yellow-600" id="unread-messages">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 消息筛选 -->
                <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">
                    <div class="flex flex-wrap items-center gap-4">
                        <div class="flex items-center space-x-2">
                            <label class="text-sm font-medium text-gray-700">筛选：</label>
                            <select id="message-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">全部消息</option>
                                <option value="unread">未读消息</option>
                                <option value="read">已读消息</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm font-medium text-gray-700">类型：</label>
                            <select id="message-type-filter" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">全部类型</option>
                                <option value="system">知会通知</option>
                                <option value="process">流程通知</option>
                                <option value="approval">审批通知</option>
                            </select>
                        </div>
                        <button onclick="markAllAsRead()" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition">
                            <i class="fas fa-check-double mr-2"></i>全部标记为已读
                        </button>
                    </div>
                </div>

                <!-- 消息列表 -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="p-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">消息列表</h3>
                    </div>
                    <div id="messages-list" class="divide-y divide-gray-200">
                        <!-- 消息列表内容将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 个人中心页面（我的任务） -->
            <div id="personal-center-page" class="content-card p-6">
                <!-- 页面标题 -->
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">我的任务</h2>
                    <p class="text-gray-600 mt-1">查看和管理您的任务进度</p>
                </div>

            <!-- 统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="p-3 bg-blue-100 rounded-lg">
                            <i class="fas fa-tasks text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">进行中流程</p>
                            <p class="text-2xl font-bold text-gray-900" id="processingCount">5</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="p-3 bg-green-100 rounded-lg">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">已完成流程</p>
                            <p class="text-2xl font-bold text-gray-900" id="completedCount">8</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">待处理事项</p>
                            <p class="text-2xl font-bold text-gray-900" id="pendingCount">3</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 流程进度内容 -->
            <div class="bg-white rounded-lg shadow-sm">
                <div class="p-6">
                    <!-- 流程筛选 -->
                    <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center space-x-4">
                                <select id="processFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">全部流程</option>
                                    <option value="permission">数据资产权限申请</option>
                                    <option value="source">数据来源新建</option>
                                    <option value="content">资产内容变更</option>
                                    <option value="resource">资源变更</option>
                                    <option value="ownership">权属变更</option>
                                    <option value="development">数据资产开发</option>
                                </select>
                                <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">全部状态</option>
                                    <option value="pending">待处理</option>
                                    <option value="processing">进行中</option>
                                    <option value="approved">已通过</option>
                                    <option value="rejected">已拒绝</option>
                                    <option value="completed">已完成</option>
                                </select>
                            </div>
                        <div class="text-sm text-gray-500">
                            共 <span id="totalProcesses">16</span> 个流程
                        </div>
                    </div>

                    <!-- 流程列表 -->
                    <div class="space-y-6" id="processList">
                        <!-- 流程项1 -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-database text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-900">数据资产权限申请</h3>
                                        <p class="text-sm text-gray-500">申请时间：2024-01-15 09:30</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        进行中
                                    </span>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-600 mb-2">申请内容：申请访问客户数据资产，用于业务分析</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="fas fa-user mr-1"></i>申请人：张三</span>
                                    <span><i class="fas fa-building mr-1"></i>部门：数据分析部</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                    <span class="text-sm text-gray-600">当前步骤：部门审批</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="px-3 py-1 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                                        查看详情
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 流程项2 -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-folder-plus text-green-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-900">数据来源新建</h3>
                                        <p class="text-sm text-gray-500">申请时间：2024-01-14 14:20</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        已完成
                                    </span>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-600 mb-2">申请内容：新建外部数据源接入，用于市场分析</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="fas fa-user mr-1"></i>申请人：李四</span>
                                    <span><i class="fas fa-building mr-1"></i>部门：市场部</span>
                                    <span><i class="fas fa-calendar mr-1"></i>完成时间：2024-01-18</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-sm text-gray-600">已完成：数据源已接入</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="px-3 py-1 text-sm bg-green-500 text-white rounded-md hover:bg-green-600">
                                        查看详情
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 流程项3 -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-edit text-yellow-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-900">资产内容变更</h3>
                                        <p class="text-sm text-gray-500">申请时间：2024-01-16 11:45</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        待处理
                                    </span>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-600 mb-2">申请内容：更新客户画像数据资产，增加新的分析维度</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="fas fa-user mr-1"></i>申请人：王五</span>
                                    <span><i class="fas fa-building mr-1"></i>部门：产品部</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                    <span class="text-sm text-gray-600">当前步骤：等待技术评估</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="px-3 py-1 text-sm bg-yellow-500 text-white rounded-md hover:bg-yellow-600">
                                        查看详情
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 流程项4 -->
                        <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-exchange-alt text-purple-600"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-900">资源变更</h3>
                                        <p class="text-sm text-gray-500">申请时间：2024-01-13 16:30</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                        进行中
                                    </span>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-600 mb-2">申请内容：调整数据存储资源配置，优化成本</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="fas fa-user mr-1"></i>申请人：赵六</span>
                                    <span><i class="fas fa-building mr-1"></i>部门：技术部</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                    <span class="text-sm text-gray-600">当前步骤：技术实施</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="px-3 py-1 text-sm bg-purple-500 text-white rounded-md hover:bg-purple-600">
                                        查看详情
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 消息详情弹窗 -->
    <div id="messageDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">消息详情</h3>
                <button onclick="hideMessageDetail()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="messageDetailContent">
                    <!-- 消息详情内容 -->
                </div>
            </div>
            </div>

            <!-- 我的任务页面 -->
            <div id="my-tasks-page" class="content-card p-6">
                <!-- 页面标题 -->
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">我的任务</h2>
                    <p class="text-gray-600 mt-1">查看和管理您需要处理的任务</p>
                </div>

                <!-- 任务统计 -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <i class="fas fa-tasks text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">待处理任务</p>
                                <p class="text-2xl font-bold text-gray-900" id="pendingTasksCount">8</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">已完成任务</p>
                                <p class="text-2xl font-bold text-gray-900" id="completedTasksCount">12</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-clock text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">即将到期</p>
                                <p class="text-2xl font-bold text-gray-900" id="urgentTasksCount">3</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-red-100 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">逾期任务</p>
                                <p class="text-2xl font-bold text-gray-900" id="overdueTasksCount">1</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 任务筛选 -->
                <div class="bg-white rounded-lg shadow-sm mb-6">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center space-x-4">
                                <select id="taskFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">全部任务</option>
                                    <option value="approval">审批任务</option>
                                    <option value="review">审核任务</option>
                                    <option value="processing">处理任务</option>
                                    <option value="notification">通知任务</option>
                                </select>
                                <select id="taskStatusFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">全部状态</option>
                                    <option value="pending">待处理</option>
                                    <option value="processing">处理中</option>
                                    <option value="completed">已完成</option>
                                    <option value="overdue">已逾期</option>
                                </select>
                                <select id="taskPriorityFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">全部优先级</option>
                                    <option value="high">高优先级</option>
                                    <option value="medium">中优先级</option>
                                    <option value="low">低优先级</option>
                                </select>
                            </div>
                            <div class="text-sm text-gray-500">
                                共 <span id="totalTasks">21</span> 个任务
                            </div>
                        </div>

                        <!-- 任务列表 -->
                        <div class="space-y-4" id="taskList">
                            <!-- 任务项1 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-check-circle text-blue-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-medium text-gray-900">数据资产权限申请审批</h3>
                                            <p class="text-sm text-gray-500">任务类型：审批任务</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            待处理
                                        </span>
                                        <span class="text-sm text-red-600 font-medium">高优先级</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-600 mb-2">申请人：张三（数据分析部）申请访问客户数据资产</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-calendar mr-1"></i>创建时间：2024-01-15 09:30</span>
                                        <span><i class="fas fa-clock mr-1"></i>截止时间：2024-01-20 18:00</span>
                                        <span><i class="fas fa-user mr-1"></i>分配人：李经理</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600">等待您的审批</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button class="px-3 py-1 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                                            处理任务
                                        </button>
                                        <button class="px-3 py-1 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                            查看详情
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 任务项2 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-eye text-green-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-medium text-gray-900">数据来源审核</h3>
                                            <p class="text-sm text-gray-500">任务类型：审核任务</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                            处理中
                                        </span>
                                        <span class="text-sm text-yellow-600 font-medium">中优先级</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-600 mb-2">申请人：李四（市场部）申请新建外部数据源接入</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-calendar mr-1"></i>创建时间：2024-01-14 14:20</span>
                                        <span><i class="fas fa-clock mr-1"></i>截止时间：2024-01-22 18:00</span>
                                        <span><i class="fas fa-user mr-1"></i>分配人：王主管</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600">正在审核中</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button class="px-3 py-1 text-sm bg-yellow-500 text-white rounded-md hover:bg-yellow-600">
                                            继续处理
                                        </button>
                                        <button class="px-3 py-1 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                            查看详情
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 任务项3 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-cog text-purple-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-medium text-gray-900">资产内容变更处理</h3>
                                            <p class="text-sm text-gray-500">任务类型：处理任务</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            已完成
                                        </span>
                                        <span class="text-sm text-green-600 font-medium">低优先级</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-600 mb-2">申请人：王五（产品部）申请更新客户画像数据资产</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-calendar mr-1"></i>创建时间：2024-01-16 11:45</span>
                                        <span><i class="fas fa-check mr-1"></i>完成时间：2024-01-18 16:30</span>
                                        <span><i class="fas fa-user mr-1"></i>分配人：赵经理</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600">任务已完成</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button class="px-3 py-1 text-sm bg-green-500 text-white rounded-md hover:bg-green-600">
                                            查看结果
                                        </button>
                                        <button class="px-3 py-1 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                            查看详情
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 任务项4 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-bell text-red-600 text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-medium text-gray-900">权属变更通知</h3>
                                            <p class="text-sm text-gray-500">任务类型：通知任务</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                            已逾期
                                        </span>
                                        <span class="text-sm text-red-600 font-medium">高优先级</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-600 mb-2">申请人：孙七（法务部）申请数据资产权属转移</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-calendar mr-1"></i>创建时间：2024-01-12 10:15</span>
                                        <span><i class="fas fa-exclamation-triangle mr-1 text-red-500"></i>截止时间：2024-01-18 18:00（已逾期）</span>
                                        <span><i class="fas fa-user mr-1"></i>分配人：陈总监</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                        <span class="text-sm text-red-600">任务已逾期，请尽快处理</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button class="px-3 py-1 text-sm bg-red-500 text-white rounded-md hover:bg-red-600">
                                            紧急处理
                                        </button>
                                        <button class="px-3 py-1 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                            查看详情
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 流程详情弹窗 -->
    <div id="processDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">流程详情</h3>
                <button onclick="hideProcessDetail()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="processDetailContent">
                    <!-- 流程详情内容 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 用户下拉菜单切换
        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown-menu');
            const arrow = document.getElementById('dropdown-arrow');
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                dropdown.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // 点击外部关闭下拉菜单
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('user-dropdown');
            const dropdownMenu = document.getElementById('user-dropdown-menu');
            
            if (!dropdown.contains(event.target)) {
                dropdownMenu.classList.add('hidden');
                document.getElementById('dropdown-arrow').style.transform = 'rotate(0deg)';
            }
        });

        // 子菜单切换功能
        function toggleSubmenu(menuId) {
            const submenu = document.getElementById(menuId + '-submenu');
            const arrow = document.getElementById(menuId + '-arrow');
            
            if (submenu.classList.contains('open')) {
                submenu.classList.remove('open');
                arrow.classList.remove('rotated');
            } else {
                // 关闭其他子菜单
                const allSubmenus = document.querySelectorAll('.submenu');
                const allArrows = document.querySelectorAll('.submenu-arrow');
                
                allSubmenus.forEach(menu => {
                    if (menu.id !== menuId + '-submenu') {
                        menu.classList.remove('open');
                    }
                });
                
                allArrows.forEach(arrow => {
                    if (arrow.id !== menuId + '-arrow') {
                        arrow.classList.remove('rotated');
                    }
                });
                
                // 切换当前子菜单
                submenu.classList.toggle('open');
                arrow.classList.toggle('rotated');
            }
        }

        // 页面加载时默认展开个人中心子菜单
        document.addEventListener('DOMContentLoaded', function() {
            const personalSubmenu = document.getElementById('personal-submenu');
            const personalArrow = document.getElementById('personal-arrow');
            
            if (personalSubmenu && personalArrow) {
                personalSubmenu.classList.add('open');
                personalArrow.classList.add('rotated');
            }
            
            // 初始化消息中心
            initializeMessagesCenter();
        });

        // 显示消息中心页面
        function showMessagesCenter() {
            // 隐藏个人中心页面
            document.getElementById('personal-center-page').classList.add('hidden');
            // 隐藏我的任务页面（如果存在）
            const myTasksPage = document.getElementById('my-tasks-page');
            if (myTasksPage) {
                myTasksPage.classList.add('hidden');
            }
            // 显示消息中心页面
            document.getElementById('messages-center-page').classList.remove('hidden');
            
            // 更新导航状态
            updateNavigationState('messages');
            
            // 加载消息数据
            loadMessagesData();
        }

        // 显示个人中心页面（我的任务）
        function showPersonalCenter() {
            // 隐藏消息中心页面
            document.getElementById('messages-center-page').classList.add('hidden');
            // 隐藏我的任务页面（如果存在）
            const myTasksPage = document.getElementById('my-tasks-page');
            if (myTasksPage) {
                myTasksPage.classList.add('hidden');
            }
            // 显示个人中心页面
            document.getElementById('personal-center-page').classList.remove('hidden');
            
            // 更新导航状态
            updateNavigationState('personal');
        }

        // 显示我的任务页面
        function showMyTasks() {
            console.log('showMyTasks called');
            
            // 隐藏消息中心页面
            const messagesPage = document.getElementById('messages-center-page');
            if (messagesPage) {
                messagesPage.classList.add('hidden');
                console.log('Messages page hidden');
            }
            
            // 隐藏个人中心页面
            const personalPage = document.getElementById('personal-center-page');
            if (personalPage) {
                personalPage.classList.add('hidden');
                console.log('Personal center page hidden');
            }
            
            // 显示我的任务页面
            const tasksPage = document.getElementById('my-tasks-page');
            if (tasksPage) {
                tasksPage.classList.remove('hidden');
                tasksPage.style.display = 'block';
                tasksPage.style.visibility = 'visible';
                tasksPage.style.opacity = '1';
                tasksPage.style.position = 'relative';
                tasksPage.style.zIndex = '1';
                console.log('Tasks page shown');
                console.log('Tasks page element:', tasksPage);
                console.log('Tasks page content:', tasksPage.innerHTML.substring(0, 200));
            } else {
                console.error('Tasks page element not found!');
            }
            
            // 更新导航状态
            updateNavigationState('personal');
        }

        // 更新导航状态
        function updateNavigationState(activePage) {
            // 重置所有导航项状态
            const allNavItems = document.querySelectorAll('.sidebar-item');
            allNavItems.forEach(item => {
                item.classList.remove('active', 'text-white');
                item.classList.add('text-gray-700');
            });
            
            // 设置当前激活的导航项
            if (activePage === 'messages') {
                const messagesNav = document.getElementById('nav-messages');
                if (messagesNav) {
                    messagesNav.classList.add('active');
                    messagesNav.classList.remove('text-gray-700');
                    messagesNav.classList.add('text-white');
                }
            } else if (activePage === 'personal') {
                const processNav = document.getElementById('nav-process');
                if (processNav) {
                    processNav.classList.add('active');
                    processNav.classList.remove('text-gray-700');
                    processNav.classList.add('text-white');
                }
            }
        }

        // 初始化消息中心
        function initializeMessagesCenter() {
            // 添加筛选器事件监听
            document.getElementById('message-filter').addEventListener('change', filterMessages);
            document.getElementById('message-type-filter').addEventListener('change', filterMessages);
        }

        // 加载消息数据
        function loadMessagesData() {
            // 更新统计信息
            updateMessageStatistics();
            // 渲染消息列表
            renderMessagesList();
        }

        // 更新消息统计
        function updateMessageStatistics() {
            const totalMessages = messageData.length;
            const readMessages = messageData.filter(msg => msg.read).length;
            const unreadMessages = totalMessages - readMessages;
            
            document.getElementById('total-messages').textContent = totalMessages;
            document.getElementById('read-messages').textContent = readMessages;
            document.getElementById('unread-messages').textContent = unreadMessages;
        }

        // 渲染消息列表
        function renderMessagesList() {
            const messagesList = document.getElementById('messages-list');
            const filter = document.getElementById('message-filter').value;
            const typeFilter = document.getElementById('message-type-filter').value;
            
            let filteredMessages = messageData;
            
            // 应用筛选
            if (filter === 'unread') {
                filteredMessages = filteredMessages.filter(msg => !msg.read);
            } else if (filter === 'read') {
                filteredMessages = filteredMessages.filter(msg => msg.read);
            }
            
            if (typeFilter !== 'all') {
                filteredMessages = filteredMessages.filter(msg => msg.type === typeFilter);
            }
            
            // 清空列表
            messagesList.innerHTML = '';
            
            if (filteredMessages.length === 0) {
                messagesList.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>暂无消息</p>
                    </div>
                `;
                return;
            }
            
            // 渲染消息项
            filteredMessages.forEach(message => {
                const messageItem = createMessageItem(message);
                messagesList.appendChild(messageItem);
            });
        }

        // 创建消息项
        function createMessageItem(message) {
            const messageItem = document.createElement('div');
            messageItem.className = `p-4 hover:bg-gray-50 cursor-pointer ${!message.read ? 'bg-blue-50 border-l-4 border-blue-500' : ''}`;
            messageItem.onclick = () => showMessageDetail(message.id);
            
            const timeAgo = getTimeAgo(message.timestamp);
            const typeClass = getMessageTypeClass(message.type);
            const typeText = getMessageTypeText(message.type);
            
            messageItem.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 rounded-full ${typeClass} flex items-center justify-center">
                            <i class="fas ${getMessageIcon(message.type)} text-xs"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900 truncate">${message.title}</p>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${typeClass}">
                                    ${typeText}
                                </span>
                                <span class="text-xs text-gray-500">${timeAgo}</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">${message.content}</p>
                        ${!message.read ? '<div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>' : ''}
                    </div>
                </div>
            `;
            
            return messageItem;
        }

        // 获取消息图标
        function getMessageIcon(type) {
            const icons = {
                'system': 'fa-cog',
                'process': 'fa-tasks',
                'approval': 'fa-check-circle'
            };
            return icons[type] || 'fa-bell';
        }

        // 获取时间差
        function getTimeAgo(timestamp) {
            const now = new Date();
            const messageTime = new Date(timestamp);
            const diffInMinutes = Math.floor((now - messageTime) / (1000 * 60));
            
            if (diffInMinutes < 1) return '刚刚';
            if (diffInMinutes < 60) return `${diffInMinutes}分钟前`;
            if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}小时前`;
            return `${Math.floor(diffInMinutes / 1440)}天前`;
        }

        // 筛选消息
        function filterMessages() {
            renderMessagesList();
        }

        // 全部标记为已读
        function markAllAsRead() {
            messageData.forEach(message => {
                message.read = true;
            });
            saveDataToStorage();
            updateMessageStatistics();
            renderMessagesList();
        }

        // 消息数据
        const messageData = [
            {
                id: 1,
                type: 'system',
                title: '系统维护通知',
                content: '系统将于今晚22:00-24:00进行维护升级，期间可能影响部分功能使用，请提前保存工作内容。',
                timestamp: '2024-01-15 14:30',
                read: false,
                important: true
            },
            {
                id: 2,
                type: 'process',
                title: '数据资产权限申请已提交',
                content: '您申请的"采购数据专题分析模型"使用权限已提交，正在等待审批，预计1-3个工作日处理。',
                timestamp: '2024-01-15 10:15',
                read: false,
                important: false
            },
            {
                id: 3,
                type: 'approval',
                title: '待审批：数据来源新建申请',
                content: '李四提交了"客户行为数据"来源新建申请，需要您的审批。',
                timestamp: '2024-01-15 09:45',
                read: false,
                important: true
            },
            {
                id: 4,
                type: 'process',
                title: '资产内容变更已完成',
                content: '您申请的"销售数据分析模型"内容变更已通过审批并完成更新。',
                timestamp: '2024-01-14 16:20',
                read: true,
                important: false
            },
            {
                id: 5,
                type: 'system',
                title: '新功能上线通知',
                content: '数据资产管理系统新增了个人中心功能，您可以在这里查看消息通知和流程进度。',
                timestamp: '2024-01-14 11:30',
                read: true,
                important: false
            },
            {
                id: 6,
                type: 'process',
                title: '资源变更申请进度更新',
                content: '您申请的数据存储资源配置调整已进入技术实施阶段。',
                timestamp: '2024-01-13 18:20',
                read: true,
                important: false
            },
            {
                id: 7,
                type: 'approval',
                title: '待审批：权限申请',
                content: '王五提交了"客户画像数据资产"访问权限申请，需要您的审批。',
                timestamp: '2024-01-13 15:30',
                read: false,
                important: false
            },
            {
                id: 8,
                type: 'system',
                title: '数据安全培训通知',
                content: '本周五下午2点将进行数据安全培训，请准时参加。',
                timestamp: '2024-01-12 09:00',
                read: true,
                important: false
            }
        ];

        // 流程数据
        const processData = [
            {
                id: 1,
                type: 'permission',
                title: '数据资产权限申请',
                description: '申请使用"采购数据专题分析模型"',
                status: 'processing',
                currentStep: 2,
                totalSteps: 4,
                steps: ['提交申请', '部门审批', '安全审查', '最终审批'],
                createTime: '2024-01-15 10:15',
                updateTime: '2024-01-15 14:30',
                assignee: '张三',
                approver: '李经理'
            },
            {
                id: 2,
                type: 'source',
                title: '数据来源新建',
                description: '新建"客户行为数据"数据来源',
                status: 'pending',
                currentStep: 1,
                totalSteps: 3,
                steps: ['提交申请', '技术审核', '业务审批'],
                createTime: '2024-01-15 09:45',
                updateTime: '2024-01-15 09:45',
                assignee: '李四',
                approver: '王总'
            },
            {
                id: 3,
                type: 'content',
                title: '资产内容变更',
                description: '更新"销售数据分析模型"内容',
                status: 'completed',
                currentStep: 3,
                totalSteps: 3,
                steps: ['提交变更', '内容审核', '发布更新'],
                createTime: '2024-01-14 14:20',
                updateTime: '2024-01-14 16:20',
                assignee: '王五',
                approver: '赵经理'
            },
            {
                id: 4,
                type: 'development',
                title: '数据资产开发',
                description: '开发"用户画像分析模型"',
                status: 'processing',
                currentStep: 3,
                totalSteps: 5,
                steps: ['项目立项', '需求分析', '开发实现', '测试验证', '上线部署'],
                createTime: '2024-01-13 15:30',
                updateTime: '2024-01-15 11:45',
                assignee: '张三',
                approver: '技术总监'
            },
            {
                id: 5,
                type: 'ownership',
                title: '权属变更',
                description: '变更"财务数据模型"权属信息',
                status: 'approved',
                currentStep: 2,
                totalSteps: 2,
                steps: ['提交申请', '权属确认'],
                createTime: '2024-01-12 11:20',
                updateTime: '2024-01-13 09:15',
                assignee: '刘六',
                approver: '法务部'
            }
        ];

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
            initializePage();
            loadMessages();
            loadProcesses();
            setupEventListeners();
        });

        // 从本地存储加载数据
        function loadDataFromStorage() {
            // 加载消息数据
            const savedMessages = localStorage.getItem('personalCenterMessages');
            if (savedMessages) {
                const parsedMessages = JSON.parse(savedMessages);
                // 合并保存的消息和默认消息
                parsedMessages.forEach(savedMsg => {
                    const existingIndex = messageData.findIndex(msg => msg.id === savedMsg.id);
                    if (existingIndex >= 0) {
                        messageData[existingIndex] = { ...messageData[existingIndex], ...savedMsg };
                    } else {
                        messageData.push(savedMsg);
                    }
                });
            }

            // 加载流程数据
            const savedProcesses = localStorage.getItem('personalCenterProcesses');
            if (savedProcesses) {
                const parsedProcesses = JSON.parse(savedProcesses);
                // 合并保存的流程和默认流程
                parsedProcesses.forEach(savedProcess => {
                    const existingIndex = processData.findIndex(process => process.id === savedProcess.id);
                    if (existingIndex >= 0) {
                        processData[existingIndex] = { ...processData[existingIndex], ...savedProcess };
                    } else {
                        processData.push(savedProcess);
                    }
                });
            }
        }

        // 保存数据到本地存储
        function saveDataToStorage() {
            localStorage.setItem('personalCenterMessages', JSON.stringify(messageData));
            localStorage.setItem('personalCenterProcesses', JSON.stringify(processData));
        }

        // 初始化页面
        function initializePage() {
            updateStatistics();
        }

        // 更新统计信息
        function updateStatistics() {
            const unreadCount = messageData.filter(msg => !msg.read).length;
            const completedCount = processData.filter(process => process.status === 'completed').length;
            const processingCount = processData.filter(process => process.status === 'processing').length;
            const pendingCount = processData.filter(process => process.status === 'pending').length;

            document.getElementById('unreadCount').textContent = unreadCount;
            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('processingCount').textContent = processingCount;
            document.getElementById('pendingCount').textContent = pendingCount;
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 标签页切换
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // 消息筛选
            document.getElementById('messageFilter').addEventListener('change', function() {
                loadMessages();
            });

            // 流程筛选
            document.getElementById('processFilter').addEventListener('change', function() {
                loadProcesses();
            });

            document.getElementById('statusFilter').addEventListener('change', function() {
                loadProcesses();
            });
        }

        // 切换标签页
        function switchTab(tabName) {
            // 更新按钮状态
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
            activeButton.classList.remove('border-transparent', 'text-gray-500');

            // 显示对应内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
        }

        // 加载消息列表
        function loadMessages() {
            const filter = document.getElementById('messageFilter').value;
            const container = document.getElementById('messageList');
            const totalMessages = document.getElementById('totalMessages');
            
            let filteredMessages = messageData;
            
            if (filter !== 'all') {
                filteredMessages = messageData.filter(msg => {
                    if (filter === 'unread') return !msg.isRead;
                    return msg.type === filter;
                });
            }
            
            totalMessages.textContent = filteredMessages.length;
            
            container.innerHTML = filteredMessages.map(message => `
                <div class="notification-item ${!message.isRead ? 'unread' : ''} bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="showMessageDetail(${message.id})">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getMessageTypeClass(message.type)}">
                                    ${getMessageTypeText(message.type)}
                                </span>
                                ${message.priority === 'high' ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">重要</span>' : ''}
                                ${!message.isRead ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">未读</span>' : ''}
                            </div>
                            <h4 class="text-sm font-medium text-gray-900 mb-1">${message.title}</h4>
                            <p class="text-sm text-gray-600 mb-2">${message.content}</p>
                            <p class="text-xs text-gray-500">${message.time}</p>
                        </div>
                        <div class="ml-4">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 加载流程列表
        function loadProcesses() {
            const typeFilter = document.getElementById('processFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const container = document.getElementById('processList');
            const totalProcesses = document.getElementById('totalProcesses');
            
            let filteredProcesses = processData;
            
            if (typeFilter !== 'all') {
                filteredProcesses = filteredProcesses.filter(process => process.type === typeFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredProcesses = filteredProcesses.filter(process => process.status === statusFilter);
            }
            
            totalProcesses.textContent = filteredProcesses.length;
            
            container.innerHTML = filteredProcesses.map(process => `
                <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getProcessTypeClass(process.type)}">
                                    ${getProcessTypeText(process.type)}
                                </span>
                                <span class="status-badge ${getStatusClass(process.status)}">
                                    ${getStatusText(process.status)}
                                </span>
                            </div>
                            <h4 class="text-lg font-medium text-gray-900 mb-1">${process.title}</h4>
                            <p class="text-sm text-gray-600 mb-3">${process.description}</p>
                            
                            <!-- 流程步骤 -->
                            <div class="mb-4">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-sm font-medium text-gray-700">流程进度：</span>
                                    <span class="text-sm text-gray-600">${process.currentStep}/${process.totalSteps}</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    ${process.steps.map((step, index) => `
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium ${getStepClass(index + 1, process.currentStep)}">
                                                ${index + 1}
                                            </div>
                                            <span class="ml-2 text-xs text-gray-600 ${getStepTextClass(index + 1, process.currentStep)}">${step}</span>
                                            ${index < process.steps.length - 1 ? '<div class="w-8 h-0.5 bg-gray-300 mx-2"></div>' : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between text-sm text-gray-500">
                                <div>
                                    <span>申请人：${process.assignee}</span>
                                    <span class="mx-2">|</span>
                                    <span>审批人：${process.approver}</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <span>创建时间：${process.createTime}</span>
                                <button onclick="showProcessDetail(${process.id})" class="text-blue-600 hover:text-blue-800">
                                    查看详情
                                </button>
                                <button onclick="addNewProcess()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 ml-4">
                                    添加流程
                                </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 显示消息详情
        function showMessageDetail(messageId) {
            const message = messageData.find(msg => msg.id === messageId);
            if (!message) return;
            
            // 标记为已读
            message.read = true;
            saveDataToStorage();
            updateMessageStatistics();
            renderMessagesList();
            
            const modal = document.getElementById('messageDetailModal');
            const content = document.getElementById('messageDetailContent');
            
            content.innerHTML = `
                <div class="mb-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getMessageTypeClass(message.type)}">
                            ${getMessageTypeText(message.type)}
                        </span>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">${message.title}</h3>
                    <p class="text-sm text-gray-500 mb-4">${message.timestamp}</p>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-gray-700">${message.content}</p>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 显示流程详情
        function showProcessDetail(processId) {
            const process = processData.find(p => p.id === processId);
            if (!process) return;
            
            const modal = document.getElementById('processDetailModal');
            const content = document.getElementById('processDetailContent');
            
            content.innerHTML = `
                <div class="mb-6">
                    <div class="flex items-center space-x-2 mb-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getProcessTypeClass(process.type)}">
                            ${getProcessTypeText(process.type)}
                        </span>
                        <span class="status-badge ${getStatusClass(process.status)}">
                            ${getStatusText(process.status)}
                        </span>
                    </div>
                    <h3 class="text-xl font-medium text-gray-900 mb-2">${process.title}</h3>
                    <p class="text-gray-600 mb-4">${process.description}</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-2">基本信息</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">申请人：</span>
                                    <span class="text-gray-900">${process.assignee}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">审批人：</span>
                                    <span class="text-gray-900">${process.approver}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">创建时间：</span>
                                    <span class="text-gray-900">${process.createTime}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">更新时间：</span>
                                    <span class="text-gray-900">${process.updateTime}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-2">流程步骤</h4>
                        <div class="space-y-3">
                            ${process.steps.map((step, index) => `
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium ${getStepClass(index + 1, process.currentStep)}">
                                        ${index + 1}
                                    </div>
                                    <div class="ml-3">
                                        <div class="text-sm font-medium ${getStepTextClass(index + 1, process.currentStep)}">${step}</div>
                                        <div class="text-xs text-gray-500">${getStepStatusText(index + 1, process.currentStep)}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 隐藏消息详情
        function hideMessageDetail() {
            document.getElementById('messageDetailModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // 隐藏流程详情
        function hideProcessDetail() {
            document.getElementById('processDetailModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // 全部标记为已读
        function markAllAsRead() {
            messageData.forEach(message => {
                message.isRead = true;
            });
            saveDataToStorage();
            updateStatistics();
            loadMessages();
            alert('所有消息已标记为已读');
        }

        // 添加新消息
        function addNewMessage() {
            const title = prompt('请输入消息标题：');
            if (!title) return;
            
            const content = prompt('请输入消息内容：');
            if (!content) return;
            
            const type = prompt('请选择消息类型（system/process/approval）：');
            if (!['system', 'process', 'approval'].includes(type)) {
                alert('消息类型无效，请选择 system、process 或 approval');
                return;
            }
            
            const newMessage = {
                id: Math.max(...messageData.map(m => m.id)) + 1,
                type: type,
                title: title,
                content: content,
                time: new Date().toLocaleString('zh-CN'),
                isRead: false,
                priority: 'normal'
            };
            
            messageData.unshift(newMessage);
            saveDataToStorage();
            updateStatistics();
            loadMessages();
            alert('消息添加成功！');
        }

        // 添加新流程
        function addNewProcess() {
            const title = prompt('请输入流程标题：');
            if (!title) return;
            
            const description = prompt('请输入流程描述：');
            if (!description) return;
            
            const type = prompt('请选择流程类型（permission/source/content/resource/ownership/development）：');
            if (!['permission', 'source', 'content', 'resource', 'ownership', 'development'].includes(type)) {
                alert('流程类型无效');
                return;
            }
            
            const newProcess = {
                id: Math.max(...processData.map(p => p.id)) + 1,
                type: type,
                title: title,
                description: description,
                status: 'pending',
                currentStep: 1,
                totalSteps: 3,
                steps: ['提交申请', '审核', '审批'],
                createTime: new Date().toLocaleString('zh-CN'),
                updateTime: new Date().toLocaleString('zh-CN'),
                assignee: '当前用户',
                approver: '待分配'
            };
            
            processData.unshift(newProcess);
            saveDataToStorage();
            updateStatistics();
            loadProcesses();
            alert('流程添加成功！');
        }

        // 获取消息类型样式
        function getMessageTypeClass(type) {
            const classes = {
                'system': 'bg-blue-100 text-blue-800',
                'process': 'bg-green-100 text-green-800',
                'approval': 'bg-yellow-100 text-yellow-800'
            };
            return classes[type] || 'bg-gray-100 text-gray-800';
        }

        // 获取消息类型文本
        function getMessageTypeText(type) {
            const texts = {
                'system': '知会通知',
                'process': '流程通知',
                'approval': '审批通知'
            };
            return texts[type] || '其他';
        }

        // 获取流程类型样式
        function getProcessTypeClass(type) {
            const classes = {
                'permission': 'bg-blue-100 text-blue-800',
                'source': 'bg-green-100 text-green-800',
                'content': 'bg-yellow-100 text-yellow-800',
                'resource': 'bg-purple-100 text-purple-800',
                'ownership': 'bg-red-100 text-red-800',
                'development': 'bg-indigo-100 text-indigo-800'
            };
            return classes[type] || 'bg-gray-100 text-gray-800';
        }

        // 获取流程类型文本
        function getProcessTypeText(type) {
            const texts = {
                'permission': '数据资产权限申请',
                'source': '数据来源新建',
                'content': '资产内容变更',
                'resource': '资源变更',
                'ownership': '权属变更',
                'development': '数据资产开发'
            };
            return texts[type] || '其他';
        }

        // 获取状态样式
        function getStatusClass(status) {
            const classes = {
                'pending': 'status-pending',
                'processing': 'status-processing',
                'approved': 'status-approved',
                'rejected': 'status-rejected',
                'completed': 'status-completed'
            };
            return classes[status] || 'status-pending';
        }

        // 获取状态文本
        function getStatusText(status) {
            const texts = {
                'pending': '待处理',
                'processing': '进行中',
                'approved': '已通过',
                'rejected': '已拒绝',
                'completed': '已完成'
            };
            return texts[status] || '未知';
        }

        // 获取步骤样式
        function getStepClass(stepNumber, currentStep) {
            if (stepNumber < currentStep) {
                return 'bg-green-500 text-white';
            } else if (stepNumber === currentStep) {
                return 'bg-blue-500 text-white';
            } else {
                return 'bg-gray-300 text-gray-600';
            }
        }

        // 获取步骤文本样式
        function getStepTextClass(stepNumber, currentStep) {
            if (stepNumber < currentStep) {
                return 'text-green-600';
            } else if (stepNumber === currentStep) {
                return 'text-blue-600 font-medium';
            } else {
                return 'text-gray-500';
            }
        }

        // 获取步骤状态文本
        function getStepStatusText(stepNumber, currentStep) {
            if (stepNumber < currentStep) {
                return '已完成';
            } else if (stepNumber === currentStep) {
                return '进行中';
            } else {
                return '待处理';
            }
        }

        // 点击弹窗外部关闭弹窗
        document.addEventListener('click', function(event) {
            const messageModal = document.getElementById('messageDetailModal');
            const processModal = document.getElementById('processDetailModal');
            
            if (event.target === messageModal) {
                hideMessageDetail();
            }
            if (event.target === processModal) {
                hideProcessDetail();
            }
        });

        // 页面加载时默认显示我的任务页面
        window.addEventListener('DOMContentLoaded', function() {
            // 确保个人中心页面（我的任务）显示，其他隐藏
            document.getElementById('personal-center-page').classList.remove('hidden');
            document.getElementById('messages-center-page').classList.add('hidden');
            const myTasksPage = document.getElementById('my-tasks-page');
            if (myTasksPage) {
                myTasksPage.classList.add('hidden');
            }
            
            // 设置我的任务导航为激活状态
            updateNavigationState('personal');
        });
    </script>
</body>
</html>
